<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.abcmart.bo.product.repository.master.PdProductDao">

    <!--
    	※ 경고
		이 select SQL은  Code Generator를 통하여 생성 되었습니다.
     	기본 쿼리 이고 수시로 변경 될 소지가 있기 떄문에 Generator로 변경 하는 것이 아닌 직접 수정은 하지 마십시요.

    -->

    <sql id="select-columns-alias-a">
		A.prdt_no, A.prdt_type_code, A.site_no, A.chnnl_no, A.prdt_name, A.eng_prdt_name, A.vndr_no, A.vndr_prdt_no_text, A.mmny_prdt_yn, A.brand_no, A.brand_sort_seq, A.org_place_code, A.style_info, A.prdt_color_info, A.mnftr_name, A.std_ctgr_no, A.stdr_ctgr_no, A.cntc_prdt_setup_yn, A.rltn_goods_setup_yn, A.add_optn_setup_yn, A.size_chart_disp_yn, A.size_chart_seq, A.emp_dscnt_yn, A.order_mnfct_yn, A.dprc_except_yn, A.store_pickup_psblt_yn, A.free_dlvy_yn, A.stock_intgr_yn, A.stock_un_intgr_rsn_code, A.stock_mgmt_yn, A.buy_limit_yn, A.min_buy_psblt_qty, A.day_max_buy_psblt_qty, A.max_buy_psblt_qty, A.item_code, A.gender_gbn_code, A.disp_flag_text, A.srch_psblt_yn, A.srch_key_word_text, A.wrhs_alert_yn, A.first_wrhs_day, A.last_wrhs_day, A.sell_start_dtm, A.sell_end_dtm, A.rsv_prdt_yn, A.rsv_dlvy_ymd, A.afflts_send_yn, A.sabangnet_send_yn, A.aconnect_disp_yn, A.disp_yn, A.igrmall_disp_except_yn, A.vndr_suspd_yn, A.aprv_stat_code, A.sell_stat_code, A.use_yn, A.rgster_no, A.rgst_dtm, A.aprver_no, A.aprver_dtm, A.moder_no, A.mod_dtm, A.relis_todo_yn, A.relis_todo_dtm, A.sabangnet_last_send_yn
	  , (SELECT ADD_INFO1 FROM SY_CODE_DETAIL Z WHERE Z.CODE_FIELD = 'TIER_FLAG_CODE' AND Z.CODE_DTL_NAME = A.DISP_FLAG_TEXT) AS TIER_FLAG_CODE_NAME
    </sql>

    <sql id="select-columns-admin-info">
		, ADMIN_APRVER.login_id AS aprver_id
		, ADMIN_APRVER.admin_name AS aprver_name
		, ADMIN_RGSTER.login_id AS rgster_id
		, ADMIN_RGSTER.admin_name AS rgster_name
		, ADMIN_MODER.login_id AS moder_id
		, ADMIN_MODER.admin_name AS moder_name
	</sql>

	<sql id="from-table-sy-admin">
		LEFT OUTER JOIN sy_admin ADMIN_APRVER WITH(NOLOCK) ON A.aprver_no = ADMIN_APRVER.admin_no
		LEFT OUTER JOIN sy_admin ADMIN_RGSTER WITH(NOLOCK) ON A.rgster_no = ADMIN_RGSTER.admin_no
		LEFT OUTER JOIN sy_admin ADMIN_MODER WITH(NOLOCK) ON A.moder_no = ADMIN_MODER.admin_no
	</sql>

    <select id="selectByPrimaryKey" parameterType="Object" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectByPrimaryKey [기본 PK 조회 쿼리] [Generator] */
		SELECT
			<include refid="select-columns" />
		FROM
			pd_product WITH(NOLOCK)
		WHERE
			<include refid="pk-columns" />
    </select>

    <select id="selectProductCount" parameterType="pageable" resultType="java.lang.Integer">
    	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductCountNew [상품 목록 갯수 조회 쿼리] [김진성] */
		SELECT
			<include refid="Paging.totalCount" />
		FROM (
				SELECT A.PRDT_NO
				FROM PD_PRODUCT A WITH(NOLOCK)
				JOIN PD_PRODUCT_PRICE_HISTORY B WITH(NOLOCK) ON A.PRDT_NO = B.PRDT_NO
				JOIN DP_BRAND C WITH(NOLOCK) ON A.BRAND_NO = C.BRAND_NO
				LEFT OUTER JOIN SA_PRODUCT_SALES_RANK D WITH(NOLOCK) ON D.CHNNL_NO ='10000' and  A.PRDT_NO = D.PRDT_NO AND D.TOTAL_TYPE = 'M'<!-- 월기준 --> AND D.TOTAL_DAY = ( SELECT MAX(TOTAL_DAY) FROM SA_PRODUCT_SALES_RANK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO AND Z.TOTAL_TYPE = 'M'<!-- 월기준 --> AND Z.TOTAL_DAY >= DATEADD(DAY, -2, GETDATE()) )
				WHERE GETDATE() BETWEEN B.APPLY_START_DTM AND B.APPLY_END_DTM
                 AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
                             AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION_STOCK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
                 AND A.APRV_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@APRV_STAT_CODE_CONFIRM}'<!-- 승인상태 중 승인완료 -->
				<if test="bean.excludePrdtTypeCodeList != null">
					AND A.prdt_type_code NOT IN<!--  상품유형 중 조회하지 않아야 할 대상. (ex. 사은품,배송비) -->
					<foreach item="item" index="index" collection="bean.excludePrdtTypeCodeList" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if>
				<if test="bean.vndrNo != null and bean.vndrNo != ''">
	 				AND A.vndr_no = #{bean.vndrNo, jdbcType=VARCHAR}<!-- 업체번호 -->
	 			</if>
				<if test="bean.prdtTypeCode != null and bean.prdtTypeCode != ''">
					AND A.prdt_type_code = #{bean.prdtTypeCode, jdbcType=VARCHAR}<!-- 상품유형 -->
				</if>
				<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn != ''">
					AND A.mmny_prdt_yn = #{bean.mmnyPrdtYn, jdbcType=VARCHAR}<!-- 자사상품여부 -->
				</if>
		  		<if test="bean.siteNo != null and bean.siteNo != ''">
		 				AND A.site_no = #{bean.siteNo, jdbcType=VARCHAR}<!-- 사이트번호 -->
		 			</if>
		  		<if test="bean.chnnlNo != null and bean.chnnlNo != ''">
		 			AND A.chnnl_no = #{bean.chnnlNo, jdbcType=VARCHAR}<!-- 채널번호 -->
		 		</if>
		  		<if test="bean.prdtName != null and bean.prdtName != '' and bean.engPrdtName != null and bean.engPrdtName != ''">
		  			AND A.prdt_no IN (
		  				SELECT Z.prdt_no FROM pd_product Z WITH(NOLOCK) WHERE Z.prdt_name LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
		  				UNION ALL
		  				SELECT Z.prdt_no FROM pd_product Z WITH(NOLOCK) WHERE Z.eng_prdt_name LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
		  			)<!-- 상품명 검색 -->
		  		</if>
		  		<if test="bean.styleInfo != null and bean.styleInfo != ''">
		  			AND A.style_info LIKE CONCAT('%', #{bean.styleInfo, jdbcType=VARCHAR}, '%')<!-- 스타일검색 -->
		  		</if>
		  		<if test="bean.prdtColorInfo != null and bean.prdtColorInfo != ''">
		  			AND A.prdt_color_info LIKE CONCAT('%', #{bean.prdtColorInfo, jdbcType=VARCHAR}, '%')<!-- 색상정보 검색 -->
		  		</if>
		  		<if test="bean.srchKeyWordText != null and bean.srchKeyWordText != ''">
		  			AND A.srch_key_word_text LIKE CONCAT('%', #{bean.srchKeyWordText, jdbcType=VARCHAR}, '%')<!-- 상품검색어 검색 -->
		  		</if>
		  		<if test="bean.aprverId != null and bean.aprverId != ''">
		  			AND A.aprver_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.aprverId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
		  		</if>
		  		<if test="bean.aprverName != null and bean.aprverName != ''">
		  			AND A.aprver_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.aprverName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
		  		</if>
		  		<if test="bean.rgsterId != null and bean.rgsterId != ''">
		  			AND A.rgster_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.rgsterId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
		  		</if>
		  		<if test="bean.rgsterName != null and bean.rgsterName != ''">
		  			AND A.rgster_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.rgsterName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
		  		</if>
		  		<if test="bean.moderId != null and bean.moderId != ''">
		  			AND A.moder_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.moderId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
		  		</if>
		  		<if test="bean.moderName != null and bean.moderName != ''">
		  			AND A.moder_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.moderName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
		  		</if>
		  		<if test="bean.prdtCodeType != null and bean.prdtCodeType != '' and bean.prdtCodeList != null">
		  			<choose><!-- 상품코드 검색 -->
		  				<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ONLINE">
		  					AND A.prdt_no IN
			    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
			    			#{item}<!-- 온라인상품코드 검색 -->
			    		</foreach>
		  				</when>
		  				<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ERP">
		  					AND A.vndr_prdt_no_text IN
			    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
			    			#{item}<!-- 기간계상품코드 검색 -->
			    		</foreach>
		  				</when>
		  			</choose>
		  		</if>
		  		<if test="bean.brandNo != null and bean.brandNo != ''">
		  			AND A.brand_no = #{bean.brandNo, jdbcType=VARCHAR}<!-- 브랜드번호 검색 -->
		  		</if>
		  		<if test="bean.brandName != null and bean.brandName != ''">
		  			AND A.brand_no IN (<!-- 브랜드이름 검색 -->
		  				SELECT Z.brand_no FROM dp_brand Z WITH(NOLOCK) WHERE Z.brand_name LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
		  				UNION ALL
		  				SELECT Z.brand_no FROM dp_brand Z WITH(NOLOCK) WHERE Z.brand_en_name LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
		  			)
		        	</if>
		  		<if test="bean.sellStatCodes != null">
		  			AND A.sell_stat_code IN<!-- 판매상태 중 상품판매코드 -->
		   		<foreach item="item" index="index" collection="bean.sellStatCodes" open="(" separator="," close=")">
		   			#{item}
		   		</foreach>
		  		</if>
			<if test="bean.dispYn != null and bean.dispYn != ''">
				 AND A.disp_yn = #{bean.dispYn, jdbcType=CHAR}<!-- 전시여부 검색 -->
			</if>
			<choose>
				<when test="bean.stdCtgrNo3 != null and bean.stdCtgrNo3 != ''">
					AND A.std_ctgr_no = #{bean.stdCtgrNo3, jdbcType=VARCHAR}<!-- 표준카테고리 중 소카테고리선택시 -->
				</when>
				<when test="bean.stdCtgrNo2 != null and bean.stdCtgrNo2 != ''">
					AND A.std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no = #{bean.stdCtgrNo2, jdbcType=VARCHAR} )<!-- 표준카테고리 중 중카테고리선택시 -->
				</when>
				<when test="bean.stdCtgrNo1 != null and bean.stdCtgrNo1 != ''">
					AND A.std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no= #{bean.stdCtgrNo1, jdbcType=VARCHAR} ) )<!-- 표준카테고리 중 대카테고리선택시 --><!-- 표준카테고리 중 대카테고리선택시 -->
				</when>
			</choose>
			<if test='bean.ctgrNo != null and bean.ctgrNo != ""'>
				AND A.stdr_ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}<!-- 전시카테고리(기준카테고리) 검색 -->
			</if>
	  		<if test="bean.periodStartDate != null and bean.periodEndDate != null"><!-- 기간조회 (상품등록일, 상품승인완료일, 상품최종수정일, 판매시작일, 판매종료일, 예상출고일) -->
	  			<choose>
				<when test="bean.periodType == 'aprver-dtm'.toString()"><!-- 최종승인일 -->
					AND A.aprver_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
	  				<when test="bean.periodType == 'sell-start-dtm'.toString()"><!-- 판매시작일 -->
					AND A.sell_start_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<when test="bean.periodType == 'sell-end-dtm'.toString()"><!-- 판매종료일 -->
					AND A.sell_end_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<when test="bean.periodType == 'rsv-dlvy-ymd'.toString()"><!-- 예상출고일 -->
					AND A.rsv_dlvy_ymd BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<when test="bean.periodType == 'mod_dtm'.toString()"><!-- 수정일 -->
					AND A.mod_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<when test="bean.periodType == 'rgst_dtm'.toString()"><!-- 등록일 -->
					AND A.rgst_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<otherwise>
					AND D.total_day BETWEEN CONVERT(DATE, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATE, #{bean.periodEndDate, jdbcType=VARCHAR})<!-- 집계기간 -->
				</otherwise>
	  			</choose>
	  		</if>
	  		<if test="bean.useAdvancedSearch != null and bean.useAdvancedSearch == 'Y'.toString()"><!-- 추가검색 -->
				<if test="bean.genderGbnCode != null and bean.genderGbnCode != ''">
					 AND A.gender_gbn_code = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마 -->
				</if>
				<if test="bean.rsvPrdtYn != null and bean.rsvPrdtYn != ''">
					 AND A.rsv_prdt_yn = #{bean.rsvPrdtYn, jdbcType=CHAR}<!-- 예약상품여부 -->
				</if>
				<if test="bean.freeDlvyYn != null and bean.freeDlvyYn != ''">
					 AND A.free_dlvy_yn = #{bean.freeDlvyYn, jdbcType=CHAR}<!-- 무료배송상품여부 -->
				</if>
				<if test="bean.empDscntYn != null and bean.empDscntYn != ''">
					 AND A.emp_dscnt_yn = #{bean.empDscntYn, jdbcType=CHAR}<!-- 임직원 할인제외여부 -->
				</if>
				<if test="bean.dprcExecptYn != null and bean.dprcExecptYn != ''">
					 AND A.dprc_execpt_yn = #{bean.dprcExecptYn, jdbcType=CHAR}<!-- 감가제외여부 -->
				</if>
				<if test="bean.stockIntgrYn != null and bean.stockIntgrYn != ''">
					 AND A.stock_intgr_yn = #{bean.stockIntgrYn, jdbcType=CHAR}<!-- 통합재고연동여부 -->
				</if>
				<if test="bean.dispFlag != null">
		   			AND disp_flag_text IN<!-- 매장등급 -->
		   			<foreach collection="bean.dispFlag" item="item" open="(" separator="," close=")">
		   				#{item, jdbcType=VARCHAR}
		   			</foreach>
		   		</if>
				<if test="bean.storePickupPsbltYn != null and bean.storePickupPsbltYn != ''">
					 AND A.store_pickup_psblt_yn = #{bean.storePickupPsbltYn, jdbcType=CHAR}<!-- 매장픽업 가능여부 -->
				</if>
				<if test="bean.affltsSendYn != null and bean.affltsSendYn != ''">
					 AND A.afflts_send_yn = #{bean.affltsSendYn, jdbcType=CHAR}<!-- 제휴사 전송대상 -->
				</if>
				<if test="bean.sellPriceStartWith != null and bean.sellPriceStartWith >= 0 and bean.sellPriceEndWith != null and bean.sellPriceEndWith >= 0">
					 AND B.sell_amt BETWEEN #{bean.sellPriceStartWith, jdbcType=INTEGER} AND #{bean.sellPriceEndWith, jdbcType=INTEGER}<!-- 판매가 시작~종료 -->
				</if>
				<if test="bean.restockWithinDays != null and bean.restockMoreThanCount != null and bean.restockWithinDays != 0 and bean.restockMoreThanCount != 0"><!-- 재입고 상품조회를 위한 select절 -->
		   			AND A.last_wrhs_day BETWEEN CONVERT(DATE, DATEADD(DAY, -#{bean.restockWithinDays, jdbcType=INTEGER}, GETDATE())) AND CONVERT(DATE, GETDATE())
		   			AND A.prdt_no IN (
		   				SELECT
		   					Z.prdt_no
		   				FROM
		   					pd_product_option Z WITH(NOLOCK)
		   				WHERE
		   					Z.prdt_no = A.prdt_no
		   					AND Z.sell_stat_code = '${@kr.co.abcmart.constant.CommonCode@SELL_STAT_CODE_SALE}'<!-- 판매상태 중 판매중 -->
		   					AND Z.use_yn = 'Y'
		   				GROUP BY
		   					Z.prdt_no
		   				HAVING
		   					SUM(Z.order_psblt_qty) &gt; #{bean.restockMoreThanCount, jdbcType=INTEGER}
		   			)
		   		</if>
			</if>
			<if test="bean.bestYn != null and bean.bestYn == 'Y'.toString()"><!-- 베스트상품 조회인 경우 -->
 				<if test='bean.genderGbnCode != null and bean.genderGbnCode != ""'>
					AND A.gender_gbn_code = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마검색 -->
				</if>
 				<if test='bean.periodStartDate != null and bean.periodEndDate != null'>
					AND D.total_day BETWEEN CONVERT(DATE, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATE, #{bean.periodEndDate, jdbcType=VARCHAR})<!-- 집계기간 -->
	  			</if>
	 		</if>
			<!-- 상품전시관리 페이지 검색 -->
			<if test="bean.prdtNo != null and bean.prdtNo != ''">
				AND A.prdt_no = #{bean.prdtNo, jdbcType=VARCHAR}
			</if>
			<if test='bean.tierFlagCode != null'>
				AND ISNULL(disp_flag_text, '-') IN<!-- 매장등급 -->
				<foreach collection="bean.tierFlagCode" item="tierFlagCode" open="(" separator="," close=")">
					#{tierFlagCode, jdbcType=VARCHAR}
				</foreach>
			</if>
		) PRODUCT
    </select>

    <select id="selectProductExcelSkuCount" parameterType="pageable" resultType="java.lang.Integer">
    	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductExcelSkuCount [옵션별 상품 엑셀다운로드 카운트 조회] [이동엽] */
    	SELECT <include refid="Paging.totalCount" />
    	  FROM
    	     (
		      SELECT A.PRDT_NO -- 상품코드
			    FROM PD_PRODUCT A WITH(NOLOCK)
			    JOIN PD_PRODUCT_PRICE_HISTORY B WITH(NOLOCK)
			      ON A.PRDT_NO = B.PRDT_NO
			    JOIN DP_BRAND C
			      ON A.BRAND_NO = C.BRAND_NO
			    JOIN PD_PRODUCT_OPTION D
			      ON A.PRDT_NO = D.PRDT_NO
			    JOIN (SELECT PRDT_NO
			               , PRDT_OPTN_NO
			               , SUM(CASE STOCK_GBN_CODE WHEN '10000' THEN STOCK_QTY ELSE 0 END) AS STOCK_AI_QTY -- 온라인
			               , SUM(CASE STOCK_GBN_CODE WHEN '10001' THEN STOCK_QTY ELSE 0 END) AS STOCK_AW_QTY -- 스마트
			               , SUM(CASE STOCK_GBN_CODE WHEN '10002' THEN STOCK_QTY ELSE 0 END) AS STOCK_AS_QTY -- 매장
			            FROM PD_PRODUCT_OPTION_STOCK WITH(NOLOCK)
			           GROUP BY PRDT_NO, PRDT_OPTN_NO
			         ) E
			      ON D.PRDT_NO = E.PRDT_NO
			     AND D.PRDT_OPTN_NO = E.PRDT_OPTN_NO
			    LEFT JOIN VD_VENDOR_DEFAULT_COMMISSION  VVDC WITH(NOLOCK)
		          ON A.VNDR_NO = VVDC.VNDR_NO
		         AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVDC.APPLY_START_YMD AND VVDC.APPLY_END_YMD
		        LEFT JOIN VD_VENDOR_EXCEPTION_COMMISSION VVEC WITH(NOLOCK)
		          ON A.VNDR_NO = VVEC.VNDR_NO
		         AND A.STD_CTGR_NO = VVEC.STD_CTGR_NO
		         AND A.BRAND_NO = VVEC.BRAND_NO
		         AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVEC.APPLY_START_YMD AND VVEC.APPLY_END_YMD
		         AND VVEC.DEL_YN = 'N'
			   WHERE GETDATE() BETWEEN B.APPLY_START_DTM AND B.APPLY_END_DTM
			     AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION_STOCK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
			     AND A.APRV_STAT_CODE = '10004'
			<if test="bean.excludePrdtTypeCodeList != null">
				AND A.prdt_type_code NOT IN<!--  상품유형 중 조회하지 않아야 할 대상. (ex. 사은품,배송비) -->
				<foreach item="item" index="index" collection="bean.excludePrdtTypeCodeList" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
	   		<if test="bean.vndrNo != null and bean.vndrNo != ''">
	  				AND A.vndr_no = #{bean.vndrNo, jdbcType=VARCHAR}<!-- 업체번호 -->
	  			</if>
			<if test="bean.prdtTypeCode != null and bean.prdtTypeCode != ''">
				AND A.prdt_type_code = #{bean.prdtTypeCode, jdbcType=VARCHAR}<!-- 상품유형 -->
			</if>
			<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn != ''">
				AND A.mmny_prdt_yn = #{bean.mmnyPrdtYn, jdbcType=VARCHAR}<!-- 자사상품여부 -->
			</if>
	   		<if test="bean.siteNo != null and bean.siteNo != ''">
	  				AND A.site_no = #{bean.siteNo, jdbcType=VARCHAR}<!-- 사이트번호 -->
	  			</if>
	   		<if test="bean.chnnlNo != null and bean.chnnlNo != ''">
	  				AND A.chnnl_no = #{bean.chnnlNo, jdbcType=VARCHAR}<!-- 채널번호 -->
	  			</if>
	  			<if test="bean.aconnectDispYn != null and bean.aconnectDispYn != ''">
	  				AND A.aconnect_disp_yn = #{bean.aconnectDispYn, jdbcType=VARCHAR}<!-- A-Connect 전시여부 -->
	  			</if>
	   		<if test="bean.prdtName != null and bean.prdtName != '' and bean.engPrdtName != null and bean.engPrdtName != ''">
	   			AND A.prdt_no IN (
	   				SELECT Z.prdt_no FROM pd_product Z WITH(NOLOCK) WHERE Z.prdt_name LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
	   				UNION ALL
	   				SELECT Z.prdt_no FROM pd_product Z WITH(NOLOCK) WHERE Z.eng_prdt_name LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
	   			)<!-- 상품명 검색 -->
	   		</if>
	   		<if test="bean.styleInfo != null and bean.styleInfo != ''">
	   			AND A.style_info LIKE CONCAT('%', #{bean.styleInfo, jdbcType=VARCHAR}, '%')<!-- 스타일검색 -->
	   		</if>
	   		<if test="bean.prdtColorInfo != null and bean.prdtColorInfo != ''">
	   			AND A.prdt_color_info LIKE CONCAT('%', #{bean.prdtColorInfo, jdbcType=VARCHAR}, '%')<!-- 색상정보 검색 -->
	   		</if>
	   		<if test="bean.srchKeyWordText != null and bean.srchKeyWordText != ''">
	   			AND A.srch_key_word_text LIKE CONCAT('%', #{bean.srchKeyWordText, jdbcType=VARCHAR}, '%')<!-- 상품검색어 검색 -->
	   		</if>
	   		<if test="bean.aprverId != null and bean.aprverId != ''">
	   			AND A.aprver_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.aprverId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
	   		</if>
	   		<if test="bean.aprverName != null and bean.aprverName != ''">
	   			AND A.aprver_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.aprverName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
	   		</if>
	   		<if test="bean.rgsterId != null and bean.rgsterId != ''">
	   			AND A.rgster_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.rgsterId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
	   		</if>
	   		<if test="bean.rgsterName != null and bean.rgsterName != ''">
	   			AND A.rgster_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.rgsterName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
	   		</if>
	   		<if test="bean.moderId != null and bean.moderId != ''">
	   			AND A.moder_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.moderId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
	   		</if>
	   		<if test="bean.moderName != null and bean.moderName != ''">
	   			AND A.moder_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.moderName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
	   		</if>
	   		<if test="bean.prdtCodeType != null and bean.prdtCodeType != '' and bean.prdtCodeList != null">
	   			<choose><!-- 상품코드 검색 -->
	   				<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ONLINE">
	   					AND A.prdt_no IN
			    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
			    			#{item}<!-- 온라인상품코드 검색 -->
			    		</foreach>
	   				</when>
	   				<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ERP">
	   					AND A.vndr_prdt_no_text IN
			    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
			    			#{item}<!-- 기간계상품코드 검색 -->
			    		</foreach>
	   				</when>
	   			</choose>
	   		</if>
	   		<if test="bean.brandNo != null and bean.brandNo != ''">
	   			AND A.brand_no = #{bean.brandNo, jdbcType=VARCHAR}<!-- 브랜드번호 검색 -->
	   		</if>
	   		<if test="bean.brandName != null and bean.brandName != ''">
	   			AND A.brand_no IN (<!-- 브랜드이름 검색 -->
	   				SELECT Z.brand_no FROM dp_brand Z WITH(NOLOCK) WHERE Z.brand_name LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
	   				UNION ALL
	   				SELECT Z.brand_no FROM dp_brand Z WITH(NOLOCK) WHERE Z.brand_en_name LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
	   			)
	         	</if>
	   		<if test="bean.sellStatCodes != null">
	   			AND A.sell_stat_code IN<!-- 판매상태 중 상품판매코드 -->
	    		<foreach item="item" index="index" collection="bean.sellStatCodes" open="(" separator="," close=")">
	    			#{item}
	    		</foreach>
	   		</if>
			<if test="bean.dispYn != null and bean.dispYn != ''">
				 AND A.disp_yn = #{bean.dispYn, jdbcType=CHAR}<!-- 전시여부 검색 -->
			</if>
			<choose>
				<when test="bean.stdCtgrNo3 != null and bean.stdCtgrNo3 != ''">
					AND A.std_ctgr_no = #{bean.stdCtgrNo3, jdbcType=VARCHAR}<!-- 표준카테고리 중 소카테고리선택시 -->
				</when>
				<when test="bean.stdCtgrNo2 != null and bean.stdCtgrNo2 != ''">
					AND A.std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no = #{bean.stdCtgrNo2, jdbcType=VARCHAR} )<!-- 표준카테고리 중 중카테고리선택시 -->
				</when>
				<when test="bean.stdCtgrNo1 != null and bean.stdCtgrNo1 != ''">
					AND A.std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WHERE up_std_ctgr_no= #{bean.stdCtgrNo1, jdbcType=VARCHAR} ) )<!-- 표준카테고리 중 대카테고리선택시 --><!-- 표준카테고리 중 대카테고리선택시 -->
				</when>
			</choose>
			<if test='bean.ctgrNo != null and bean.ctgrNo != ""'>
				AND A.stdr_ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}<!-- 전시카테고리(기준카테고리) 검색 -->
			</if>
	   		<if test="bean.periodStartDate != null and bean.periodEndDate != null"><!-- 기간조회 (상품등록일, 상품승인완료일, 상품최종수정일, 판매시작일, 판매종료일, 예상출고일) -->
	   			<choose>
					<when test="bean.periodType == 'aprver-dtm'.toString()"><!-- 최종승인일 -->
						AND A.aprver_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
					</when>
	   				<when test="bean.periodType == 'sell-start-dtm'.toString()"><!-- 판매시작일 -->
						AND A.sell_start_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
					</when>
					<when test="bean.periodType == 'sell-end-dtm'.toString()"><!-- 판매종료일 -->
						AND A.sell_end_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
					</when>
					<when test="bean.periodType == 'rsv-dlvy-ymd'.toString()"><!-- 예상출고일 -->
						AND A.rsv_dlvy_ymd BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
					</when>
					<when test="bean.periodType == 'mod_dtm'.toString()"><!-- 수정일 -->
						AND A.mod_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
					</when>
					<when test="bean.periodType == 'rgst_dtm'.toString()"><!-- 등록일 -->
						AND A.rgst_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
					</when>
					<otherwise>
						AND D.total_day BETWEEN CONVERT(DATE, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATE, #{bean.periodEndDate, jdbcType=VARCHAR})<!-- 집계기간 -->
					</otherwise>
	   			</choose>
	   		</if>
	   		<if test="bean.useAdvancedSearch != null and bean.useAdvancedSearch == 'Y'.toString()"><!-- 추가검색 -->
				<if test="bean.genderGbnCode != null and bean.genderGbnCode != ''">
					 AND A.gender_gbn_code = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마 -->
				</if>
				<if test="bean.rsvPrdtYn != null and bean.rsvPrdtYn != ''">
					 AND A.rsv_prdt_yn = #{bean.rsvPrdtYn, jdbcType=CHAR}<!-- 예약상품여부 -->
				</if>
				<if test="bean.freeDlvyYn != null and bean.freeDlvyYn != ''">
					 AND A.free_dlvy_yn = #{bean.freeDlvyYn, jdbcType=CHAR}<!-- 무료배송상품여부 -->
				</if>
				<if test="bean.empDscntYn != null and bean.empDscntYn != ''">
					 AND A.emp_dscnt_yn = #{bean.empDscntYn, jdbcType=CHAR}<!-- 임직원 할인제외여부 -->
				</if>
				<if test="bean.dprcExecptYn != null and bean.dprcExecptYn != ''">
					 AND A.dprc_execpt_yn = #{bean.dprcExecptYn, jdbcType=CHAR}<!-- 감가제외여부 -->
				</if>
				<if test="bean.stockIntgrYn != null and bean.stockIntgrYn != ''">
					 AND A.stock_intgr_yn = #{bean.stockIntgrYn, jdbcType=CHAR}<!-- 통합재고연동여부 -->
				</if>
				<if test="bean.dispFlag != null">
	    			AND disp_flag_text IN<!-- 매장등급 -->
	    			<foreach collection="bean.dispFlag" item="item" open="(" separator="," close=")">
	    				#{item, jdbcType=VARCHAR}
	    			</foreach>
	    		</if>
				<if test="bean.storePickupPsbltYn != null and bean.storePickupPsbltYn != ''">
					 AND A.store_pickup_psblt_yn = #{bean.storePickupPsbltYn, jdbcType=CHAR}<!-- 매장픽업 가능여부 -->
				</if>
				<if test="bean.affltsSendYn != null and bean.affltsSendYn != ''">
					 AND A.afflts_send_yn = #{bean.affltsSendYn, jdbcType=CHAR}<!-- 제휴사 전송대상 -->
				</if>
				<if test="bean.sabangnetSendYn != null and bean.sabangnetSendYn != ''">
					 AND A.sabangnet_send_yn = #{bean.sabangnetSendYn, jdbcType=CHAR}<!-- 사방넷 전송 여부 -->
				</if>
				<if test="bean.sellPriceStartWith != null and bean.sellPriceStartWith >= 0 and bean.sellPriceEndWith != null and bean.sellPriceEndWith >= 0">
					 AND B.sell_amt BETWEEN #{bean.sellPriceStartWith, jdbcType=INTEGER} AND #{bean.sellPriceEndWith, jdbcType=INTEGER}<!-- 판매가 시작~종료 -->
				</if>
				<if test="bean.restockWithinDays != null and bean.restockMoreThanCount != null and bean.restockWithinDays != 0 and bean.restockMoreThanCount != 0"><!-- 재입고 상품조회를 위한 select절 -->
	    			AND A.last_wrhs_day BETWEEN CONVERT(DATE, DATEADD(DAY, -#{bean.restockWithinDays, jdbcType=INTEGER}, GETDATE())) AND CONVERT(DATE, GETDATE())
	    			AND A.prdt_no IN (
	    				SELECT
	    					Z.prdt_no
	    				FROM
	    					pd_product_option Z WITH(NOLOCK)
	    				WHERE
	    					Z.prdt_no = A.prdt_no
	    					AND Z.sell_stat_code = '${@kr.co.abcmart.constant.CommonCode@SELL_STAT_CODE_SALE}'<!-- 판매상태 중 판매중 -->
	    					AND Z.use_yn = 'Y'
	    				GROUP BY
	    					Z.prdt_no
	    				HAVING
	    					SUM(Z.order_psblt_qty) &gt; #{bean.restockMoreThanCount, jdbcType=INTEGER}
	    			)
	    		</if>
			</if>
			<if test="bean.bestYn != null and bean.bestYn == 'Y'.toString()"><!-- 베스트상품 조회인 경우 -->
	  				<if test='bean.genderGbnCode != null and bean.genderGbnCode != ""'>
				 	AND A.gender_gbn_code = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마검색 -->
				</if>
	  				<if test='bean.periodStartDate != null and bean.periodEndDate != null'>
					AND D.total_day BETWEEN CONVERT(DATE, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATE, #{bean.periodEndDate, jdbcType=VARCHAR})<!-- 집계기간 -->
	   			</if>
	  			</if>
			<!-- 상품전시관리 페이지 검색 -->
			<if test="bean.prdtNo != null and bean.prdtNo != ''">
	   			AND A.prdt_no = #{bean.prdtNo, jdbcType=VARCHAR}
	   		</if>
			<if test='bean.tierFlagCode != null'>
				AND ISNULL(disp_flag_text, '-') IN<!-- 매장등급 -->
				<foreach collection="bean.tierFlagCode" item="tierFlagCode" open="(" separator="," close=")">
					#{tierFlagCode, jdbcType=VARCHAR}
				</foreach>
			</if>
			ORDER BY
			<choose>
				<when test='sortColumn != null and sortColumn != ""'>
					<if test='sortColumn == "mmnyPrdtYn"'>
						A.mmny_prdt_yn
					</if>
					<if test='sortColumn == "vndrPrdtNoText"'>
						A.vndr_prdt_no_text
					</if>
					<if test='sortColumn == "prdtNo"'>
						A.prdt_no
					</if>
					<if test='sortColumn == "prdtName"'>
						A.prdt_name
					</if>
					<if test='sortType == "DESC"'>
				 		DESC
				 	</if>
				</when>
				<otherwise>
					A.MOD_DTM  DESC
				</otherwise>
			</choose>
			<include refid="Paging.mssql" />
    	     ) PRODUCT_LIST
    </select>

    <select id="selectProductExcelSku" parameterType="pageable" resultType="kr.co.abcmart.bo.product.vo.PdProductSkuExcelListVO">
    	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductExcelSku [옵션별 상품 엑셀다운로드 리스트 조회] [이동엽] */
    	SELECT A.PRDT_NO -- 상품코드
	         , (SELECT X.CHNNL_NAME FROM SY_SITE_CHNNL X WHERE X.CHNNL_NO = A.CHNNL_NO) AS CHNNL_NAME -- 채널구분
	         , A.VNDR_PRDT_NO_TEXT -- 업체상품번호
	         , C.BRAND_EN_NAME -- 영문브랜드
	         , A.ENG_PRDT_NAME -- 영문상품명
	         , C.BRAND_NAME -- 한글브랜드명
	         , A.PRDT_NAME -- 한글상품명
	         , A.STYLE_INFO -- 스타일정보
	         , A.PRDT_COLOR_INFO -- 컬러정보
	         , D.PRDT_OPTN_NO -- 옵션 아이디
	         , D.OPTN_NAME -- 옵션명
	         , D.SORT_SEQ -- 노출순서
	         , (E.STOCK_AI_QTY - E.ORDER_AI_COUNT) AS AVAILABLE_STOCK_AI_QTY
	         , (E.STOCK_AW_QTY - E.ORDER_AW_COUNT) AS AVAILABLE_STOCK_AW_QTY
	         , (E.STOCK_AS_QTY - E.ORDER_AS_COUNT) AS AVAILABLE_STOCK_AS_QTY
	         , D.ORDER_PSBLT_QTY -- 주문가능수량
	         , A.SELL_STAT_CODE -- 판매상태
	         , D.USE_YN  -- 전시여부 /* 2020.03.27 C.USE_YN ==> D.USE_YN으로 변경 */
	         , A.STOCK_INTGR_YN -- 연동여부
	         , CASE WHEN A.STOCK_INTGR_YN = 'Y' THEN '-'
	         		ELSE (CASE WHEN A.STOCK_UN_INTGR_RSN_CODE IS NULL THEN '-'
	         				   WHEN A.STOCK_UN_INTGR_RSN_CODE = '' THEN '-'
	         				   ELSE DBO.FN_CODE_VALUE('STOCK_UN_INTGR_RSN_CODE', A.STOCK_UN_INTGR_RSN_CODE)
	         			   END)
	         	END AS STOCK_UN_INTGR_RSN_CODE_NAME
	         , CASE WHEN A.MMNY_PRDT_YN = 'Y' THEN 0 ELSE ISNULL(VVEC.CMSN_RATE, VVDC.DFLT_CMSN_RATE) END AS CMSN_RATE
	      FROM PD_PRODUCT A WITH(NOLOCK)
	      JOIN PD_PRODUCT_PRICE_HISTORY B WITH(NOLOCK)
	        ON A.PRDT_NO = B.PRDT_NO
	      JOIN DP_BRAND C
	        ON A.BRAND_NO = C.BRAND_NO
	      JOIN PD_PRODUCT_OPTION D
	        ON A.PRDT_NO = D.PRDT_NO
	      JOIN (SELECT PRDT_NO
	                 , PRDT_OPTN_NO
	                 , SUM(CASE STOCK_GBN_CODE WHEN '10000' THEN STOCK_QTY ELSE 0 END) AS STOCK_AI_QTY -- 온라인
	                 , SUM(CASE STOCK_GBN_CODE WHEN '10001' THEN STOCK_QTY ELSE 0 END) AS STOCK_AW_QTY -- 스마트
	                 , SUM(CASE STOCK_GBN_CODE WHEN '10002' THEN STOCK_QTY ELSE 0 END) AS STOCK_AS_QTY -- 매장
	                 , SUM(CASE STOCK_GBN_CODE WHEN '10000' THEN ORDER_COUNT ELSE 0 END) AS ORDER_AI_COUNT
      				 , SUM(CASE STOCK_GBN_CODE WHEN '10001' THEN ORDER_COUNT ELSE 0 END) AS ORDER_AW_COUNT
      				 , SUM(CASE STOCK_GBN_CODE WHEN '10002' THEN ORDER_COUNT ELSE 0 END) AS ORDER_AS_COUNT
	              FROM PD_PRODUCT_OPTION_STOCK WITH(NOLOCK)
	             GROUP BY PRDT_NO, PRDT_OPTN_NO
	           ) E
	        ON D.PRDT_NO = E.PRDT_NO
	       AND D.PRDT_OPTN_NO = E.PRDT_OPTN_NO
	        LEFT JOIN VD_VENDOR_DEFAULT_COMMISSION  VVDC WITH(NOLOCK)
	          ON A.VNDR_NO = VVDC.VNDR_NO
	         AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVDC.APPLY_START_YMD AND VVDC.APPLY_END_YMD
	        LEFT JOIN VD_VENDOR_EXCEPTION_COMMISSION VVEC WITH(NOLOCK)
	          ON A.VNDR_NO = VVEC.VNDR_NO
	         AND A.STD_CTGR_NO = VVEC.STD_CTGR_NO
	         AND A.BRAND_NO = VVEC.BRAND_NO
	         AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVEC.APPLY_START_YMD AND VVEC.APPLY_END_YMD
	         AND VVEC.DEL_YN = 'N'
	     WHERE GETDATE() BETWEEN B.APPLY_START_DTM AND B.APPLY_END_DTM
	       AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION_STOCK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
	       AND A.APRV_STAT_CODE = '10004'
		<if test="bean.excludePrdtTypeCodeList != null">
			AND A.prdt_type_code NOT IN<!--  상품유형 중 조회하지 않아야 할 대상. (ex. 사은품,배송비) -->
			<foreach item="item" index="index" collection="bean.excludePrdtTypeCodeList" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
   		<if test="bean.vndrNo != null and bean.vndrNo != ''">
  				AND A.vndr_no = #{bean.vndrNo, jdbcType=VARCHAR}<!-- 업체번호 -->
  			</if>
		<if test="bean.prdtTypeCode != null and bean.prdtTypeCode != ''">
			AND A.prdt_type_code = #{bean.prdtTypeCode, jdbcType=VARCHAR}<!-- 상품유형 -->
		</if>
		<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn != ''">
			AND A.mmny_prdt_yn = #{bean.mmnyPrdtYn, jdbcType=VARCHAR}<!-- 자사상품여부 -->
		</if>
   		<if test="bean.siteNo != null and bean.siteNo != ''">
  				AND A.site_no = #{bean.siteNo, jdbcType=VARCHAR}<!-- 사이트번호 -->
  			</if>
   		<if test="bean.chnnlNo != null and bean.chnnlNo != ''">
  				AND A.chnnl_no = #{bean.chnnlNo, jdbcType=VARCHAR}<!-- 채널번호 -->
  			</if>
  			<if test="bean.aconnectDispYn != null and bean.aconnectDispYn != ''">
  				AND A.aconnect_disp_yn = #{bean.aconnectDispYn, jdbcType=VARCHAR}<!-- A-Connect 전시여부 -->
  			</if>
   		<if test="bean.prdtName != null and bean.prdtName != '' and bean.engPrdtName != null and bean.engPrdtName != ''">
   			AND A.prdt_no IN (
   				SELECT Z.prdt_no FROM pd_product Z WITH(NOLOCK) WHERE Z.prdt_name LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
   				UNION ALL
   				SELECT Z.prdt_no FROM pd_product Z WITH(NOLOCK) WHERE Z.eng_prdt_name LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
   			)<!-- 상품명 검색 -->
   		</if>
   		<if test="bean.styleInfo != null and bean.styleInfo != ''">
   			AND A.style_info LIKE CONCAT('%', #{bean.styleInfo, jdbcType=VARCHAR}, '%')<!-- 스타일검색 -->
   		</if>
   		<if test="bean.prdtColorInfo != null and bean.prdtColorInfo != ''">
   			AND A.prdt_color_info LIKE CONCAT('%', #{bean.prdtColorInfo, jdbcType=VARCHAR}, '%')<!-- 색상정보 검색 -->
   		</if>
   		<if test="bean.srchKeyWordText != null and bean.srchKeyWordText != ''">
   			AND A.srch_key_word_text LIKE CONCAT('%', #{bean.srchKeyWordText, jdbcType=VARCHAR}, '%')<!-- 상품검색어 검색 -->
   		</if>
   		<if test="bean.aprverId != null and bean.aprverId != ''">
   			AND A.aprver_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.aprverId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
   		</if>
   		<if test="bean.aprverName != null and bean.aprverName != ''">
   			AND A.aprver_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.aprverName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
   		</if>
   		<if test="bean.rgsterId != null and bean.rgsterId != ''">
   			AND A.rgster_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.rgsterId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
   		</if>
   		<if test="bean.rgsterName != null and bean.rgsterName != ''">
   			AND A.rgster_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.rgsterName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
   		</if>
   		<if test="bean.moderId != null and bean.moderId != ''">
   			AND A.moder_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.moderId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
   		</if>
   		<if test="bean.moderName != null and bean.moderName != ''">
   			AND A.moder_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.moderName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
   		</if>
   		<if test="bean.prdtCodeType != null and bean.prdtCodeType != '' and bean.prdtCodeList != null">
   			<choose><!-- 상품코드 검색 -->
   				<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ONLINE">
   					AND A.prdt_no IN
		    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
		    			#{item}<!-- 온라인상품코드 검색 -->
		    		</foreach>
   				</when>
   				<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ERP">
   					AND A.vndr_prdt_no_text IN
		    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
		    			#{item}<!-- 기간계상품코드 검색 -->
		    		</foreach>
   				</when>
   			</choose>
   		</if>
   		<if test="bean.brandNo != null and bean.brandNo != ''">
   			AND A.brand_no = #{bean.brandNo, jdbcType=VARCHAR}<!-- 브랜드번호 검색 -->
   		</if>
   		<if test="bean.brandName != null and bean.brandName != ''">
   			AND A.brand_no IN (<!-- 브랜드이름 검색 -->
   				SELECT Z.brand_no FROM dp_brand Z WITH(NOLOCK) WHERE Z.brand_name LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
   				UNION ALL
   				SELECT Z.brand_no FROM dp_brand Z WITH(NOLOCK) WHERE Z.brand_en_name LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
   			)
         	</if>
   		<if test="bean.sellStatCodes != null">
   			AND A.sell_stat_code IN<!-- 판매상태 중 상품판매코드 -->
    		<foreach item="item" index="index" collection="bean.sellStatCodes" open="(" separator="," close=")">
    			#{item}
    		</foreach>
   		</if>
		<if test="bean.dispYn != null and bean.dispYn != ''">
			 AND A.disp_yn = #{bean.dispYn, jdbcType=CHAR}<!-- 전시여부 검색 -->
		</if>
		<choose>
			<when test="bean.stdCtgrNo3 != null and bean.stdCtgrNo3 != ''">
				AND A.std_ctgr_no = #{bean.stdCtgrNo3, jdbcType=VARCHAR}<!-- 표준카테고리 중 소카테고리선택시 -->
			</when>
			<when test="bean.stdCtgrNo2 != null and bean.stdCtgrNo2 != ''">
				AND A.std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no = #{bean.stdCtgrNo2, jdbcType=VARCHAR} )<!-- 표준카테고리 중 중카테고리선택시 -->
			</when>
			<when test="bean.stdCtgrNo1 != null and bean.stdCtgrNo1 != ''">
				AND A.std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WHERE up_std_ctgr_no= #{bean.stdCtgrNo1, jdbcType=VARCHAR} ) )<!-- 표준카테고리 중 대카테고리선택시 --><!-- 표준카테고리 중 대카테고리선택시 -->
			</when>
		</choose>
		<if test='bean.ctgrNo != null and bean.ctgrNo != ""'>
			AND A.stdr_ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}<!-- 전시카테고리(기준카테고리) 검색 -->
		</if>
   		<if test="bean.periodStartDate != null and bean.periodEndDate != null"><!-- 기간조회 (상품등록일, 상품승인완료일, 상품최종수정일, 판매시작일, 판매종료일, 예상출고일) -->
   			<choose>
				<when test="bean.periodType == 'aprver-dtm'.toString()"><!-- 최종승인일 -->
					AND A.aprver_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
   				<when test="bean.periodType == 'sell-start-dtm'.toString()"><!-- 판매시작일 -->
					AND A.sell_start_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<when test="bean.periodType == 'sell-end-dtm'.toString()"><!-- 판매종료일 -->
					AND A.sell_end_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<when test="bean.periodType == 'rsv-dlvy-ymd'.toString()"><!-- 예상출고일 -->
					AND A.rsv_dlvy_ymd BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<when test="bean.periodType == 'mod_dtm'.toString()"><!-- 수정일 -->
					AND A.mod_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<when test="bean.periodType == 'rgst_dtm'.toString()"><!-- 등록일 -->
					AND A.rgst_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
				</when>
				<otherwise>
					AND D.total_day BETWEEN CONVERT(DATE, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATE, #{bean.periodEndDate, jdbcType=VARCHAR})<!-- 집계기간 -->
				</otherwise>
   			</choose>
   		</if>
   		<if test="bean.useAdvancedSearch != null and bean.useAdvancedSearch == 'Y'.toString()"><!-- 추가검색 -->
			<if test="bean.genderGbnCode != null and bean.genderGbnCode != ''">
				 AND A.gender_gbn_code = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마 -->
			</if>
			<if test="bean.rsvPrdtYn != null and bean.rsvPrdtYn != ''">
				 AND A.rsv_prdt_yn = #{bean.rsvPrdtYn, jdbcType=CHAR}<!-- 예약상품여부 -->
			</if>
			<if test="bean.freeDlvyYn != null and bean.freeDlvyYn != ''">
				 AND A.free_dlvy_yn = #{bean.freeDlvyYn, jdbcType=CHAR}<!-- 무료배송상품여부 -->
			</if>
			<if test="bean.empDscntYn != null and bean.empDscntYn != ''">
				 AND A.emp_dscnt_yn = #{bean.empDscntYn, jdbcType=CHAR}<!-- 임직원 할인제외여부 -->
			</if>
			<if test="bean.dprcExecptYn != null and bean.dprcExecptYn != ''">
				 AND A.dprc_execpt_yn = #{bean.dprcExecptYn, jdbcType=CHAR}<!-- 감가제외여부 -->
			</if>
			<if test="bean.stockIntgrYn != null and bean.stockIntgrYn != ''">
				 AND A.stock_intgr_yn = #{bean.stockIntgrYn, jdbcType=CHAR}<!-- 통합재고연동여부 -->
			</if>
			<if test="bean.dispFlag != null">
    			AND disp_flag_text IN<!-- 매장등급 -->
    			<foreach collection="bean.dispFlag" item="item" open="(" separator="," close=")">
    				#{item, jdbcType=VARCHAR}
    			</foreach>
    		</if>
			<if test="bean.storePickupPsbltYn != null and bean.storePickupPsbltYn != ''">
				 AND A.store_pickup_psblt_yn = #{bean.storePickupPsbltYn, jdbcType=CHAR}<!-- 매장픽업 가능여부 -->
			</if>
			<if test="bean.affltsSendYn != null and bean.affltsSendYn != ''">
				 AND A.afflts_send_yn = #{bean.affltsSendYn, jdbcType=CHAR}<!-- 제휴사 전송대상 -->
			</if>
			<if test="bean.sabangnetSendYn != null and bean.sabangnetSendYn != ''">
				 AND A.sabangnet_send_yn = #{bean.sabangnetSendYn, jdbcType=CHAR}<!-- 사방넷 전송 여부 -->
			</if>
			<if test="bean.sellPriceStartWith != null and bean.sellPriceStartWith >= 0 and bean.sellPriceEndWith != null and bean.sellPriceEndWith >= 0">
				 AND B.sell_amt BETWEEN #{bean.sellPriceStartWith, jdbcType=INTEGER} AND #{bean.sellPriceEndWith, jdbcType=INTEGER}<!-- 판매가 시작~종료 -->
			</if>
			<if test="bean.restockWithinDays != null and bean.restockMoreThanCount != null and bean.restockWithinDays != 0 and bean.restockMoreThanCount != 0"><!-- 재입고 상품조회를 위한 select절 -->
    			AND A.last_wrhs_day BETWEEN CONVERT(DATE, DATEADD(DAY, -#{bean.restockWithinDays, jdbcType=INTEGER}, GETDATE())) AND CONVERT(DATE, GETDATE())
    			AND A.prdt_no IN (
    				SELECT
    					Z.prdt_no
    				FROM
    					pd_product_option Z WITH(NOLOCK)
    				WHERE
    					Z.prdt_no = A.prdt_no
    					AND Z.sell_stat_code = '${@kr.co.abcmart.constant.CommonCode@SELL_STAT_CODE_SALE}'<!-- 판매상태 중 판매중 -->
    					AND Z.use_yn = 'Y'
    				GROUP BY
    					Z.prdt_no
    				HAVING
    					SUM(Z.order_psblt_qty) &gt; #{bean.restockMoreThanCount, jdbcType=INTEGER}
    			)
    		</if>
		</if>
		<if test="bean.bestYn != null and bean.bestYn == 'Y'.toString()"><!-- 베스트상품 조회인 경우 -->
  				<if test='bean.genderGbnCode != null and bean.genderGbnCode != ""'>
			 	AND A.gender_gbn_code = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마검색 -->
			</if>
  				<if test='bean.periodStartDate != null and bean.periodEndDate != null'>
				AND D.total_day BETWEEN CONVERT(DATE, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATE, #{bean.periodEndDate, jdbcType=VARCHAR})<!-- 집계기간 -->
   			</if>
  			</if>
		<!-- 상품전시관리 페이지 검색 -->
		<if test="bean.prdtNo != null and bean.prdtNo != ''">
   			AND A.prdt_no = #{bean.prdtNo, jdbcType=VARCHAR}
   		</if>
		<if test='bean.tierFlagCode != null'>
			AND ISNULL(disp_flag_text, '-') IN<!-- 매장등급 -->
			<foreach collection="bean.tierFlagCode" item="tierFlagCode" open="(" separator="," close=")">
				#{tierFlagCode, jdbcType=VARCHAR}
			</foreach>
		</if>
		ORDER BY
		<choose>
			<when test='sortColumn != null and sortColumn != ""'>
				<if test='sortColumn == "mmnyPrdtYn"'>
					A.mmny_prdt_yn
				</if>
				<if test='sortColumn == "vndrPrdtNoText"'>
					A.vndr_prdt_no_text
				</if>
				<if test='sortColumn == "prdtNo"'>
					A.prdt_no
				</if>
				<if test='sortColumn == "prdtName"'>
					A.prdt_name
				</if>
				<if test='sortType == "DESC"'>
			 		DESC
			 	</if>
			</when>
			<otherwise>
				A.MOD_DTM  DESC
			</otherwise>
		</choose>
		<include refid="Paging.mssql" />
    </select>

    <select id="selectProduct" parameterType="pageable" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
    	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductNew [상품 목록 조회 쿼리] [김진성] */
    	SELECT PRODUCT_LIST.PRDT_NO, PRODUCT_LIST.PRDT_TYPE_CODE, PRODUCT_LIST.SITE_NO, PRODUCT_LIST.CHNNL_NO, PRODUCT_LIST.PRDT_NAME,
			PRODUCT_LIST.ENG_PRDT_NAME, PRODUCT_LIST.VNDR_NO, PRODUCT_LIST.VNDR_PRDT_NO_TEXT, PRODUCT_LIST.MMNY_PRDT_YN, PRODUCT_LIST.BRAND_NO,
			PRODUCT_LIST.BRAND_SORT_SEQ, PRODUCT_LIST.ORG_PLACE_CODE, PRODUCT_LIST.STYLE_INFO, PRODUCT_LIST.PRDT_COLOR_INFO, PRODUCT_LIST.MNFTR_NAME,
			PRODUCT_LIST.STD_CTGR_NO, PRODUCT_LIST.STDR_CTGR_NO, PRODUCT_LIST.CNTC_PRDT_SETUP_YN, PRODUCT_LIST.RLTN_GOODS_SETUP_YN, PRODUCT_LIST.ADD_OPTN_SETUP_YN,
			PRODUCT_LIST.SIZE_CHART_DISP_YN, PRODUCT_LIST.SIZE_CHART_SEQ, PRODUCT_LIST.EMP_DSCNT_YN, PRODUCT_LIST.ORDER_MNFCT_YN, PRODUCT_LIST.DPRC_EXCEPT_YN,
			PRODUCT_LIST.STORE_PICKUP_PSBLT_YN, PRODUCT_LIST.FREE_DLVY_YN, PRODUCT_LIST.STOCK_INTGR_YN, PRODUCT_LIST.STOCK_UN_INTGR_RSN_CODE, PRODUCT_LIST.STOCK_MGMT_YN,
			PRODUCT_LIST.BUY_LIMIT_YN, PRODUCT_LIST.MIN_BUY_PSBLT_QTY, PRODUCT_LIST.DAY_MAX_BUY_PSBLT_QTY, PRODUCT_LIST.MAX_BUY_PSBLT_QTY, PRODUCT_LIST.ITEM_CODE,
			PRODUCT_LIST.GENDER_GBN_CODE, PRODUCT_LIST.DISP_FLAG_TEXT, PRODUCT_LIST.SRCH_PSBLT_YN, PRODUCT_LIST.SRCH_KEY_WORD_TEXT, PRODUCT_LIST.WRHS_ALERT_YN,
			PRODUCT_LIST.SELL_START_DTM, PRODUCT_LIST.SELL_END_DTM, PRODUCT_LIST.RSV_PRDT_YN, PRODUCT_LIST.RSV_DLVY_YMD, PRODUCT_LIST.AFFLTS_SEND_YN,
			PRODUCT_LIST.SABANGNET_SEND_YN, PRODUCT_LIST.ACONNECT_DISP_YN, PRODUCT_LIST.DISP_YN, PRODUCT_LIST.IGRMALL_DISP_EXCEPT_YN, PRODUCT_LIST.VNDR_SUSPD_YN,
			PRODUCT_LIST.APRV_STAT_CODE, PRODUCT_LIST.SELL_STAT_CODE, PRODUCT_LIST.USE_YN, PRODUCT_LIST.RGSTER_NO, PRODUCT_LIST.RGST_DTM,
			PRODUCT_LIST.APRVER_NO, PRODUCT_LIST.APRVER_DTM, PRODUCT_LIST.MODER_NO, PRODUCT_LIST.MOD_DTM, PRODUCT_LIST.NORMAL_AMT,
			PRODUCT_LIST.SELL_AMT, PRODUCT_LIST.ERP_DSCNT_RATE, PRODUCT_LIST.ONLN_DSCNT_RATE, PRODUCT_LIST.EMP_DSCNT_RATE, PRODUCT_LIST.BRAND_NAME,
			PRODUCT_LIST.BRAND_EN_NAME, PRODUCT_LIST.TITLE_IMAGE_NAME, PRODUCT_LIST.TITLE_IMAGE_PATH_TEXT, PRODUCT_LIST.TITLE_IMAGE_URL, PRODUCT_LIST.TITLE_IMAGE_ALTRN_TEXT,
			dbo.FN_STD_CTGR_NAME_INLINE(PRODUCT_LIST.STD_CTGR_NO) AS STD_CTGR_NAME, dbo.FN_DP_CTGR_NAME_INLINE(PRODUCT_LIST.STDR_CTGR_NO) AS STDR_CTGR_NAME, PRODUCT_LIST.SITE_NAME, PRODUCT_LIST.CHNNL_NAME, PRODUCT_LIST.VNDR_NAME,
			PRODUCT_LIST.DFLT_CMSN_RATE,
			PRODUCT_LIST.DISPLAY_PRODUCT_PRICE,
			FLOOR( ( PRODUCT_LIST.NORMAL_AMT - PRODUCT_LIST.DISPLAY_PRODUCT_PRICE ) / (PRODUCT_LIST.NORMAL_AMT * 1.0) * 100.0 ) AS DISPLAY_DISCOUNT_RATE,
			PRODUCT_LIST.ONLN_SELL_AMT,
			PRODUCT_LIST.ERP_SELL_AMT,
			PRODUCT_LIST.APRVER_ADMIN,
			PRODUCT_LIST.RGSTER_ADMIN,
			PRODUCT_LIST.MODER_ADMIN,
			PRODUCT_LIST.STOCK_INFO,
			PRODUCT_LIST.LAST_WRHS_DAY,
			CASE WHEN PRODUCT_LIST.MMNY_PRDT_YN = 'Y' THEN 0 ELSE PRODUCT_LIST.CMSN_RATE END VNDR_CMSN_RATE
			<!-- DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.APRVER_ADMIN, 1, '^') AS APRVER_ID,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.APRVER_ADMIN, 2, '^') AS APRVER_NAME,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.RGSTER_ADMIN, 1, '^') AS RGSTER_ID,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.RGSTER_ADMIN, 2, '^') AS RGSTER_NAME,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.MODER_ADMIN, 1, '^') AS MODER_ID,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.MODER_ADMIN, 2, '^') AS MODER_NAME,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 1, '^')) AS ORDER_PSBLT_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 2, '^')) AS TOTAL_STOCK_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 3, '^')) AS TOTAL_ORDER_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 4, '^')) AS STOCK_AI_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 5, '^')) AS STOCK_AW_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 6, '^')) AS STOCK_AS_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 7, '^')) AS STOCK_VD_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 8, '^')) AS AVAIABLE_STOCK_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 9, '^')) AS USE_YN_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 10, '^')) AS TOTAL_OPTION_COUNT-->
			<!-- 옵션전체갯수 -->

			<if test="bean.searchForAppliedPromotion == true"><!-- 연계된 프로모션 조회 여부 -->
			,STUFF((
				SELECT
					', ' + CONCAT(PROMO.PROMO_NAME, '(', PROMO.PROMO_NO, ')')
				FROM
					pr_promotion_target_product PROMO_PRODUCT WITH(NOLOCK)
					LEFT OUTER JOIN pr_promotion PROMO WITH(NOLOCK) ON PROMO_PRODUCT.PROMO_NO = PROMO.PROMO_NO
				WHERE
					PROMO_PRODUCT.prdt_no = PRODUCT_LIST.PRDT_NO
					AND GETDATE() &gt;= PROMO.promo_start_dtm
					AND GETDATE() &lt;= PROMO.promo_end_dtm
					AND PROMO.use_yn = 'Y'
				FOR XML PATH('')), 1, 1, '') AS APPLIED_PROMOTION_INFO
			</if>
			<if test="bean.searchPromoInfo != '' and bean.searchPromoInfo != ''">
			,STUFF((
				SELECT
					CONCAT(',', PPTP.promo_no)
				FROM
					pr_promotion_target_product PPTP WITH(NOLOCK)
					INNER JOIN pr_promotion PP WITH(NOLOCK) ON PP.promo_no = PPTP.promo_no
					AND PP.promo_type_code != '${@kr.co.abcmart.constant.CommonCode@PROMO_TYPE_CODE_GIFT_PAYMENT}'
					AND PPTP.prdt_no = PRODUCT_LIST.prdt_no
					AND PPTP.promo_no != #{bean.searchPromoInfo, jdbcType=VARCHAR}
					AND
					(
						(PP.promo_start_dtm &lt;= getDate() AND PP.promo_end_dtm &gt;= getDate()) OR
						getDate() &lt; PP.promo_start_dtm
					)
					AND PP.use_yn = 'Y'
				FOR XML PATH('')
			),1, 1,'') AS dupl_promo_no
			</if>
		FROM (
               SELECT PRODUCT.*,
               			DBO.FN_PRDT_PROMO_PRICE(PRODUCT.PRDT_NO) AS DISPLAY_PRODUCT_PRICE,
                      ISNULL(PRODUCT_IMAGE.IMAGE_NAME, '') AS TITLE_IMAGE_NAME, ISNULL(PRODUCT_IMAGE.IMAGE_PATH_TEXT, '') AS TITLE_IMAGE_PATH_TEXT, ISNULL(PRODUCT_IMAGE.IMAGE_URL, '') AS TITLE_IMAGE_URL, ISNULL(PRODUCT_IMAGE.ALTRN_TEXT, '') AS TITLE_IMAGE_ALTRN_TEXT,
                      STANDARD_CATEGORY.STD_CTGR_NAME,
                      CATEGORY.CTGR_NAME AS STDR_CTGR_NAME,
                      SITE.SITE_NAME,
                      SITE_CHNNL.CHNNL_NAME,
                      VENDOR.VNDR_NAME,
                      VENDOR_COMMISION.DFLT_CMSN_RATE,
                      ISNULL(VVEC.CMSN_RATE,VENDOR_COMMISION.DFLT_CMSN_RATE) AS CMSN_RATE,
                      (
                              SELECT CONCAT(Z.LOGIN_ID, '^', Z.ADMIN_NAME)
                                FROM SY_ADMIN Z WITH(NOLOCK)
                               WHERE Z.ADMIN_NO = PRODUCT.APRVER_NO
                      ) AS APRVER_ADMIN,
                      (
                              SELECT CONCAT(Z.LOGIN_ID, '^', Z.ADMIN_NAME)
                                FROM SY_ADMIN Z WITH(NOLOCK)
                               WHERE Z.ADMIN_NO = PRODUCT.RGSTER_NO
                      ) AS RGSTER_ADMIN,
                      (
                              SELECT CONCAT(Z.LOGIN_ID, '^', Z.ADMIN_NAME)
                                FROM SY_ADMIN Z WITH(NOLOCK)
                               WHERE Z.ADMIN_NO = PRODUCT.MODER_NO
                      ) AS MODER_ADMIN,
                      CASE PRODUCT.MMNY_PRDT_YN WHEN 'Y' THEN -- 자사 상품
                                                              CASE PRODUCT.STOCK_INTGR_YN WHEN 'Y' THEN ( --재고 통함 여부
                                                                                                       SELECT CONCAT(
                                                                                                                       MIN(X.ORDER_PSBLT_QTY)
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_STOCK_QTY)
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_ORDER_QTY)
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10000' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10001' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10002' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))
                                                                                                                     , '^0'
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(Y.STOCK_QTY - Y.ORDER_COUNT))
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE WHEN X.USE_YN = 'Y' AND X.ORDER_PSBLT_QTY &gt; 0 THEN 1 ELSE 0 END) / 3)
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 옵션전체갯수. 가용율 구하는데 사용됨 -->
                                                                                                              )
                                                                                                         FROM PD_PRODUCT_OPTION X WITH(NOLOCK)
                                                                                                         JOIN PD_PRODUCT_OPTION_STOCK Y WITH(NOLOCK) ON X.PRDT_NO = Y.PRDT_NO AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
                                                                                                        WHERE X.PRDT_NO = PRODUCT.PRDT_NO
                                                                                                          --AND X.SELL_STAT_CODE = '10001'
                                                                                                          --AND X.USE_YN = 'Y'
                                                                                                        GROUP BY X.PRDT_NO
                                                                                                       )
                                                                                         ELSE         ( --재고 통함 여부
                                                                                                       SELECT CONCAT(
                                                                                                                       MIN(X.ORDER_PSBLT_QTY)
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_STOCK_QTY)
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_ORDER_QTY)
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10000' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))
                                                                                                                     , '^0^0^0'
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(Y.STOCK_QTY - Y.ORDER_COUNT))
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE WHEN X.USE_YN = 'Y' AND X.ORDER_PSBLT_QTY &gt; 0 THEN 1 ELSE 0 END) / 3)<!-- 판매가능한 옵션 갯수 -->
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 옵션전체갯수. 가용율 구하는데 사용됨 -->
                                                                                                              )
                                                                                                         FROM PD_PRODUCT_OPTION X WITH(NOLOCK)
                                                                                                         JOIN PD_PRODUCT_OPTION_STOCK Y WITH(NOLOCK) ON X.PRDT_NO = Y.PRDT_NO AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
                                                                                                        WHERE X.PRDT_NO = PRODUCT.PRDT_NO
                                                                                                          --AND X.SELL_STAT_CODE = '10001'
                                                                                                          --AND X.USE_YN = 'Y'
                                                                                                        GROUP BY X.PRDT_NO
                                                                                                       )
                                                              END
                                                WHEN 'N' THEN
                                                              CASE PRODUCT.STOCK_MGMT_YN WHEN 'Y' THEN (
                                                                                                       SELECT CONCAT(
                                                                                                                       MIN(X.ORDER_PSBLT_QTY)<!-- 주문가능수량 -->
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_STOCK_QTY)<!-- 총 재고수량 -->
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_ORDER_QTY)<!-- 총 주문수량 -->
                                                                                                                     , '^0^0^0^'<!-- AI/AW/AS 재고량 -->
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10003' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))<!-- VD 재고량 -->
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(Y.STOCK_QTY - Y.ORDER_COUNT))<!-- 활용가능한 재고량 -->
                                                                                                                     , '^'
                                                                                                                     --, CONVERT(VARCHAR(10), SUM(CASE X.USE_YN WHEN 'Y' THEN 1 ELSE 0 END) / COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 전시중인옵션갯수. 입점은 옵션번호가 한개씩이므로 나눗셈 제거 -->
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE WHEN X.USE_YN = 'Y' AND X.ORDER_PSBLT_QTY &gt; 0 THEN 1 ELSE 0 END))<!-- 판매가능한 옵션 갯수 -->
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 옵션전체갯수. 가용율 구하는데 사용됨 -->
                                                                                                              )
                                                                                                         FROM PD_PRODUCT_OPTION X WITH(NOLOCK)
                                                                                                         JOIN PD_PRODUCT_OPTION_STOCK Y WITH(NOLOCK) ON X.PRDT_NO = Y.PRDT_NO AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
                                                                                                        WHERE X.PRDT_NO = PRODUCT.PRDT_NO
                                                                                                        GROUP BY X.PRDT_NO
                                                                                                       )
                                                                                         ELSE          (
                                                                                                       SELECT CONCAT(
                                                                                                                       '9999^9999^9999^0^0^0^9999^9999^'
                                                                                                                     --, CONVERT(VARCHAR(10), SUM(CASE X.USE_YN WHEN 'Y' THEN 1 ELSE 0 END) / COUNT(DISTINCT X.PRDT_OPTN_NO))
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE X.USE_YN WHEN 'Y' THEN 1 ELSE 0 END))<!-- 판매가능한 옵션 갯수 -->
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 옵션전체갯수. 가용율 구하는데 사용됨 -->
                                                                                                              )
                                                                                                         FROM PD_PRODUCT_OPTION X WITH(NOLOCK)
                                                                                                         JOIN PD_PRODUCT_OPTION_STOCK Y WITH(NOLOCK) ON X.PRDT_NO = Y.PRDT_NO AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
                                                                                                        WHERE X.PRDT_NO = PRODUCT.PRDT_NO
                                                                                                        GROUP BY X.PRDT_NO
                                                                                                       )
                                                              END
                      END AS STOCK_INFO
                 FROM (
                              SELECT A.PRDT_NO, A.PRDT_TYPE_CODE, A.SITE_NO, A.CHNNL_NO, A.PRDT_NAME, A.ENG_PRDT_NAME, A.VNDR_NO, A.VNDR_PRDT_NO_TEXT, A.MMNY_PRDT_YN, A.BRAND_NO, A.BRAND_SORT_SEQ,
                                     A.ORG_PLACE_CODE, A.STYLE_INFO, A.PRDT_COLOR_INFO, A.MNFTR_NAME, A.STD_CTGR_NO, A.STDR_CTGR_NO, A.CNTC_PRDT_SETUP_YN, A.RLTN_GOODS_SETUP_YN, A.ADD_OPTN_SETUP_YN, A.SIZE_CHART_DISP_YN,
                                     A.SIZE_CHART_SEQ, A.EMP_DSCNT_YN, A.ORDER_MNFCT_YN, A.DPRC_EXCEPT_YN, A.STORE_PICKUP_PSBLT_YN, A.FREE_DLVY_YN, A.STOCK_INTGR_YN, A.STOCK_UN_INTGR_RSN_CODE, A.STOCK_MGMT_YN, A.BUY_LIMIT_YN,
                                     A.MIN_BUY_PSBLT_QTY, A.DAY_MAX_BUY_PSBLT_QTY, A.MAX_BUY_PSBLT_QTY, A.ITEM_CODE, A.GENDER_GBN_CODE, ISNULL(A.DISP_FLAG_TEXT, '-') AS DISP_FLAG_TEXT, A.SRCH_PSBLT_YN, A.SRCH_KEY_WORD_TEXT, A.WRHS_ALERT_YN, A.SELL_START_DTM,
                                     A.SELL_END_DTM, A.RSV_PRDT_YN, A.RSV_DLVY_YMD, A.AFFLTS_SEND_YN, A.SABANGNET_SEND_YN, A.ACONNECT_DISP_YN, A.DISP_YN, A.IGRMALL_DISP_EXCEPT_YN, A.VNDR_SUSPD_YN, A.APRV_STAT_CODE,
                                     A.SELL_STAT_CODE, A.USE_YN, A.RGSTER_NO, A.RGST_DTM, A.APRVER_NO, A.APRVER_DTM, A.MODER_NO, A.MOD_DTM, A.LAST_WRHS_DAY,
                                     B.NORMAL_AMT, B.SELL_AMT, B.ERP_DSCNT_RATE, B.ONLN_DSCNT_RATE, B.EMP_DSCNT_RATE, B.ONLN_SELL_AMT, B.ERP_SELL_AMT,
                                     C.BRAND_NAME, C.BRAND_EN_NAME 
                                FROM PD_PRODUCT A WITH(NOLOCK)
                                JOIN PD_PRODUCT_PRICE_HISTORY B WITH(NOLOCK) ON A.PRDT_NO = B.PRDT_NO
                                JOIN DP_BRAND C WITH(NOLOCK) ON A.BRAND_NO = C.BRAND_NO
                               LEFT OUTER JOIN SA_PRODUCT_SALES_RANK D WITH(NOLOCK) ON D.CHNNL_NO ='10000' and A.PRDT_NO = D.PRDT_NO AND D.TOTAL_TYPE = 'M'<!-- 월기준 --> AND D.TOTAL_DAY = ( SELECT MAX(TOTAL_DAY) FROM SA_PRODUCT_SALES_RANK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO AND Z.TOTAL_TYPE = 'M'<!-- 월기준 --> AND Z.TOTAL_DAY >= DATEADD(DAY, -2, GETDATE()) )
                               WHERE GETDATE() BETWEEN B.APPLY_START_DTM AND B.APPLY_END_DTM
                                 AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)

                                             AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION_STOCK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
                                 AND A.APRV_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@APRV_STAT_CODE_CONFIRM}'<!-- 승인상태 중 승인완료 -->
								<if test="bean.excludePrdtTypeCodeList != null">
									AND A.prdt_type_code NOT IN<!--  상품유형 중 조회하지 않아야 할 대상. (ex. 사은품,배송비) -->
									<foreach item="item" index="index" collection="bean.excludePrdtTypeCodeList" open="(" separator="," close=")">
										#{item}
									</foreach>
								</if>
					    		<if test="bean.vndrNo != null and bean.vndrNo != ''">
					   				AND A.vndr_no = #{bean.vndrNo, jdbcType=VARCHAR}<!-- 업체번호 -->
					   			</if>
								<if test="bean.prdtTypeCode != null and bean.prdtTypeCode != ''">
									AND A.prdt_type_code = #{bean.prdtTypeCode, jdbcType=VARCHAR}<!-- 상품유형 -->
								</if>
								<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn != ''">
									AND A.mmny_prdt_yn = #{bean.mmnyPrdtYn, jdbcType=VARCHAR}<!-- 자사상품여부 -->
								</if>
					    		<if test="bean.siteNo != null and bean.siteNo != ''">
					   				AND A.site_no = #{bean.siteNo, jdbcType=VARCHAR}<!-- 사이트번호 -->
					   			</if>
					    		<if test="bean.chnnlNo != null and bean.chnnlNo != ''">
					   				AND A.chnnl_no = #{bean.chnnlNo, jdbcType=VARCHAR}<!-- 채널번호 -->
					   			</if>
					   			<if test="bean.aconnectDispYn != null and bean.aconnectDispYn != ''">
					   				AND A.aconnect_disp_yn = #{bean.aconnectDispYn, jdbcType=VARCHAR}<!-- A-Connect 전시여부 -->
					   			</if>
					    		<if test="bean.prdtName != null and bean.prdtName != '' and bean.engPrdtName != null and bean.engPrdtName != ''">
					    			AND A.prdt_no IN (
					    				SELECT Z.prdt_no FROM pd_product Z WITH(NOLOCK) WHERE Z.prdt_name LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
					    				UNION ALL
					    				SELECT Z.prdt_no FROM pd_product Z WITH(NOLOCK) WHERE Z.eng_prdt_name LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
					    			)<!-- 상품명 검색 -->
					    		</if>
					    		<if test="bean.styleInfo != null and bean.styleInfo != ''">
					    			AND A.style_info LIKE CONCAT('%', #{bean.styleInfo, jdbcType=VARCHAR}, '%')<!-- 스타일검색 -->
					    		</if>
					    		<if test="bean.prdtColorInfo != null and bean.prdtColorInfo != ''">
					    			AND A.prdt_color_info LIKE CONCAT('%', #{bean.prdtColorInfo, jdbcType=VARCHAR}, '%')<!-- 색상정보 검색 -->
					    		</if>
					    		<if test="bean.srchKeyWordText != null and bean.srchKeyWordText != ''">
					    			AND A.srch_key_word_text LIKE CONCAT('%', #{bean.srchKeyWordText, jdbcType=VARCHAR}, '%')<!-- 상품검색어 검색 -->
					    		</if>
					    		<if test="bean.aprverId != null and bean.aprverId != ''">
					    			AND A.aprver_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.aprverId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
					    		</if>
					    		<if test="bean.aprverName != null and bean.aprverName != ''">
					    			AND A.aprver_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.aprverName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
					    		</if>
					    		<if test="bean.rgsterId != null and bean.rgsterId != ''">
					    			AND A.rgster_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.rgsterId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
					    		</if>
					    		<if test="bean.rgsterName != null and bean.rgsterName != ''">
					    			AND A.rgster_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.rgsterName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
					    		</if>
					    		<if test="bean.moderId != null and bean.moderId != ''">
					    			AND A.moder_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.login_id = #{bean.moderId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
					    		</if>
					    		<if test="bean.moderName != null and bean.moderName != ''">
					    			AND A.moder_no IN ( SELECT Z.admin_no FROM sy_admin Z WITH(NOLOCK) WHERE Z.admin_name = #{bean.moderName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
					    		</if>
					    		<if test="bean.prdtCodeType != null and bean.prdtCodeType != '' and bean.prdtCodeList != null">
					    			<choose><!-- 상품코드 검색 -->
					    				<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ONLINE">
					    					AND A.prdt_no IN
								    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
								    			#{item}<!-- 온라인상품코드 검색 -->
								    		</foreach>
					    				</when>
					    				<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ERP">
					    					AND A.vndr_prdt_no_text IN
								    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
								    			#{item}<!-- 기간계상품코드 검색 -->
								    		</foreach>
					    				</when>
					    			</choose>
					    		</if>
					    		<if test="bean.brandNo != null and bean.brandNo != ''">
					    			AND A.brand_no = #{bean.brandNo, jdbcType=VARCHAR}<!-- 브랜드번호 검색 -->
					    		</if>
					    		<if test="bean.brandName != null and bean.brandName != ''">
					    			AND A.brand_no IN (<!-- 브랜드이름 검색 -->
					    				SELECT Z.brand_no FROM dp_brand Z WITH(NOLOCK) WHERE Z.brand_name LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
					    				UNION ALL
					    				SELECT Z.brand_no FROM dp_brand Z WITH(NOLOCK) WHERE Z.brand_en_name LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
					    			)
					          	</if>
					    		<if test="bean.sellStatCodes != null">
					    			AND A.sell_stat_code IN<!-- 판매상태 중 상품판매코드 -->
						    		<foreach item="item" index="index" collection="bean.sellStatCodes" open="(" separator="," close=")">
						    			#{item}
						    		</foreach>
					    		</if>
								<if test="bean.dispYn != null and bean.dispYn != ''">
									 AND A.disp_yn = #{bean.dispYn, jdbcType=CHAR}<!-- 전시여부 검색 -->
								</if>
								<choose>
									<when test="bean.stdCtgrNo3 != null and bean.stdCtgrNo3 != ''">
										AND A.std_ctgr_no = #{bean.stdCtgrNo3, jdbcType=VARCHAR}<!-- 표준카테고리 중 소카테고리선택시 -->
									</when>
									<when test="bean.stdCtgrNo2 != null and bean.stdCtgrNo2 != ''">
										AND A.std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no = #{bean.stdCtgrNo2, jdbcType=VARCHAR} )<!-- 표준카테고리 중 중카테고리선택시 -->
									</when>
									<when test="bean.stdCtgrNo1 != null and bean.stdCtgrNo1 != ''">
										AND A.std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WITH(NOLOCK) WHERE up_std_ctgr_no IN ( SELECT std_ctgr_no FROM sy_standard_category WHERE up_std_ctgr_no= #{bean.stdCtgrNo1, jdbcType=VARCHAR} ) )<!-- 표준카테고리 중 대카테고리선택시 --><!-- 표준카테고리 중 대카테고리선택시 -->
									</when>
								</choose>
								<if test='bean.ctgrNo != null and bean.ctgrNo != ""'>
									AND A.stdr_ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}<!-- 전시카테고리(기준카테고리) 검색 -->
								</if>
					    		<if test="bean.periodStartDate != null and bean.periodEndDate != null"><!-- 기간조회 (상품등록일, 상품승인완료일, 상품최종수정일, 판매시작일, 판매종료일, 예상출고일) -->
					    			<choose>
										<when test="bean.periodType == 'aprver-dtm'.toString()"><!-- 최종승인일 -->
											AND A.aprver_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
										</when>
					    				<when test="bean.periodType == 'sell-start-dtm'.toString()"><!-- 판매시작일 -->
											AND A.sell_start_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
										</when>
										<when test="bean.periodType == 'sell-end-dtm'.toString()"><!-- 판매종료일 -->
											AND A.sell_end_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
										</when>
										<when test="bean.periodType == 'rsv-dlvy-ymd'.toString()"><!-- 예상출고일 -->
											AND A.rsv_dlvy_ymd BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
										</when>
										<when test="bean.periodType == 'mod_dtm'.toString()"><!-- 수정일 -->
											AND A.mod_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
										</when>
										<when test="bean.periodType == 'rgst_dtm'.toString()"><!-- 등록일 -->
											AND A.rgst_dtm BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
										</when>
										<otherwise>
											AND D.total_day BETWEEN CONVERT(DATE, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATE, #{bean.periodEndDate, jdbcType=VARCHAR})<!-- 집계기간 -->
										</otherwise>
					    			</choose>
					    		</if>
					    		<if test="bean.useAdvancedSearch != null and bean.useAdvancedSearch == 'Y'.toString()"><!-- 추가검색 -->
									<if test="bean.genderGbnCode != null and bean.genderGbnCode != ''">
										 AND A.gender_gbn_code = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마 -->
									</if>
									<if test="bean.rsvPrdtYn != null and bean.rsvPrdtYn != ''">
										 AND A.rsv_prdt_yn = #{bean.rsvPrdtYn, jdbcType=CHAR}<!-- 예약상품여부 -->
									</if>
									<if test="bean.freeDlvyYn != null and bean.freeDlvyYn != ''">
										 AND A.free_dlvy_yn = #{bean.freeDlvyYn, jdbcType=CHAR}<!-- 무료배송상품여부 -->
									</if>
									<if test="bean.empDscntYn != null and bean.empDscntYn != ''">
										 AND A.emp_dscnt_yn = #{bean.empDscntYn, jdbcType=CHAR}<!-- 임직원 할인제외여부 -->
									</if>
									<if test="bean.dprcExecptYn != null and bean.dprcExecptYn != ''">
										 AND A.dprc_execpt_yn = #{bean.dprcExecptYn, jdbcType=CHAR}<!-- 감가제외여부 -->
									</if>
									<if test="bean.stockIntgrYn != null and bean.stockIntgrYn != ''">
										 AND A.stock_intgr_yn = #{bean.stockIntgrYn, jdbcType=CHAR}<!-- 통합재고연동여부 -->
									</if>
									<if test="bean.dispFlag != null">
						    			AND disp_flag_text IN<!-- 매장등급 -->
						    			<foreach collection="bean.dispFlag" item="item" open="(" separator="," close=")">
						    				#{item, jdbcType=VARCHAR}
						    			</foreach>
						    		</if>
									<if test="bean.storePickupPsbltYn != null and bean.storePickupPsbltYn != ''">
										 AND A.store_pickup_psblt_yn = #{bean.storePickupPsbltYn, jdbcType=CHAR}<!-- 매장픽업 가능여부 -->
									</if>
									<if test="bean.affltsSendYn != null and bean.affltsSendYn != ''">
										 AND A.afflts_send_yn = #{bean.affltsSendYn, jdbcType=CHAR}<!-- 제휴사 전송대상 -->
									</if>
									<if test="bean.sabangnetSendYn != null and bean.sabangnetSendYn != ''">
										 AND A.sabangnet_send_yn = #{bean.sabangnetSendYn, jdbcType=CHAR}<!-- 사방넷 전송 여부 -->
									</if>
									<if test="bean.sellPriceStartWith != null and bean.sellPriceStartWith >= 0 and bean.sellPriceEndWith != null and bean.sellPriceEndWith >= 0">
										 AND B.sell_amt BETWEEN #{bean.sellPriceStartWith, jdbcType=INTEGER} AND #{bean.sellPriceEndWith, jdbcType=INTEGER}<!-- 판매가 시작~종료 -->
									</if>
									<if test="bean.restockWithinDays != null and bean.restockMoreThanCount != null and bean.restockWithinDays != 0 and bean.restockMoreThanCount != 0"><!-- 재입고 상품조회를 위한 select절 -->
						    			AND A.last_wrhs_day BETWEEN CONVERT(DATE, DATEADD(DAY, -#{bean.restockWithinDays, jdbcType=INTEGER}, GETDATE())) AND CONVERT(DATE, GETDATE())
						    			AND A.prdt_no IN (
						    				SELECT
						    					Z.prdt_no
						    				FROM
						    					pd_product_option Z WITH(NOLOCK)
						    				WHERE
						    					Z.prdt_no = A.prdt_no
						    					AND Z.sell_stat_code = '${@kr.co.abcmart.constant.CommonCode@SELL_STAT_CODE_SALE}'<!-- 판매상태 중 판매중 -->
						    					AND Z.use_yn = 'Y'
						    				GROUP BY
						    					Z.prdt_no
						    				HAVING
						    					SUM(Z.order_psblt_qty) &gt; #{bean.restockMoreThanCount, jdbcType=INTEGER}
						    			)
						    		</if>
								</if>
								<if test="bean.bestYn != null and bean.bestYn == 'Y'.toString()"><!-- 베스트상품 조회인 경우 -->
					   				<if test='bean.genderGbnCode != null and bean.genderGbnCode != ""'>
									 	AND A.gender_gbn_code = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마검색 -->
									</if>
					   				<if test='bean.periodStartDate != null and bean.periodEndDate != null'>
										AND D.total_day BETWEEN CONVERT(DATE, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATE, #{bean.periodEndDate, jdbcType=VARCHAR})<!-- 집계기간 -->
						   			</if>
					   			</if>
								<!-- 상품전시관리 페이지 검색 -->
								<if test="bean.prdtNo != null and bean.prdtNo != ''">
					    			AND A.prdt_no = #{bean.prdtNo, jdbcType=VARCHAR}
					    		</if>
								<if test='bean.tierFlagCode != null'>
									AND ISNULL(disp_flag_text, '-') IN<!-- 매장등급 -->
									<foreach collection="bean.tierFlagCode" item="tierFlagCode" open="(" separator="," close=")">
										#{tierFlagCode, jdbcType=VARCHAR}
									</foreach>
								</if>
                               ORDER BY
						    	<choose>
									<when test='sortColumn != null and sortColumn != ""'>
										<if test='sortColumn == "mmnyPrdtYn"'>
											A.mmny_prdt_yn
										</if>
										<if test='sortColumn == "vndrPrdtNoText"'>
											A.vndr_prdt_no_text
										</if>
										<if test='sortColumn == "prdtNo"'>
											A.prdt_no
										</if>
										<if test='sortColumn == "prdtName"'>
											A.prdt_name
										</if>
										<!--
										<if test='sortColumn == "avaiableStockQty"'>
											AVAIABLE_STOCK_QTY
										</if>
										<if test='sortColumn == "orderPsbltQty"'>
											ORDER_PSBLT_QTY
										</if>
										 -->
										<if test='sortType == "DESC"'>
									 		DESC
									 	</if>
									</when>
									<otherwise>
										A.MOD_DTM  DESC
									</otherwise>
								</choose>
                               <include refid="Paging.mssql" />
                      ) PRODUCT
			LEFT OUTER JOIN PD_PRODUCT_RELATION_FILE PRODUCT_IMAGE WITH(NOLOCK) ON PRODUCT.PRDT_NO = PRODUCT_IMAGE.PRDT_NO
                                                                                    AND PRODUCT_IMAGE.PRDT_RLTN_FILE_SEQ = 1
                                                                                    AND PRODUCT_IMAGE.DISP_POSTN_TYPE = 'P'
                                                                                    AND PRODUCT_IMAGE.FILE_TYPE = 'I'
			LEFT OUTER JOIN SY_STANDARD_CATEGORY STANDARD_CATEGORY WITH(NOLOCK) ON STANDARD_CATEGORY.STD_CTGR_NO = PRODUCT.STD_CTGR_NO
			LEFT OUTER JOIN DP_CATEGORY CATEGORY WITH(NOLOCK) ON PRODUCT.STDR_CTGR_NO = CATEGORY.CTGR_NO
			LEFT OUTER JOIN SY_SITE SITE WITH(NOLOCK) ON PRODUCT.SITE_NO = SITE.SITE_NO
			LEFT OUTER JOIN SY_SITE_CHNNL SITE_CHNNL WITH(NOLOCK) ON PRODUCT.CHNNL_NO = SITE_CHNNL.CHNNL_NO
			LEFT OUTER JOIN VD_VENDOR VENDOR WITH(NOLOCK) ON PRODUCT.VNDR_NO = VENDOR.VNDR_NO
			LEFT OUTER JOIN VD_VENDOR_DEFAULT_COMMISSION VENDOR_COMMISION WITH(NOLOCK) 
			  ON PRODUCT.VNDR_NO = VENDOR_COMMISION.VNDR_NO
             AND GETDATE() BETWEEN VENDOR_COMMISION.APPLY_START_YMD AND VENDOR_COMMISION.APPLY_END_YMD
            LEFT JOIN VD_VENDOR_EXCEPTION_COMMISSION VVEC WITH(NOLOCK)
              ON PRODUCT.VNDR_NO = VVEC.VNDR_NO
			 AND PRODUCT.STD_CTGR_NO = VVEC.STD_CTGR_NO
			 AND PRODUCT.BRAND_NO = VVEC.BRAND_NO
			 AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVEC.APPLY_START_YMD AND VVEC.APPLY_END_YMD
			 AND VVEC.DEL_YN = 'N'
		) PRODUCT_LIST
    </select>

    <select id="selectProductByMapped" parameterType="pageable" resultType="kr.co.abcmart.bo.product.model.master.PdProductMapped">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductByMapped [매핑테이블 기준 상품 다건 조회 쿼리] [김세훈] */
		<!-- 동적 테이블 매핑에 따른 asterisk 사용 -->
		SELECT
			A.*,
			PRODUCT_LIST.PRDT_NO, PRODUCT_LIST.PRDT_TYPE_CODE, PRODUCT_LIST.SITE_NO, PRODUCT_LIST.CHNNL_NO, PRODUCT_LIST.PRDT_NAME,
			PRODUCT_LIST.ENG_PRDT_NAME, PRODUCT_LIST.VNDR_NO, PRODUCT_LIST.VNDR_PRDT_NO_TEXT, PRODUCT_LIST.MMNY_PRDT_YN, PRODUCT_LIST.BRAND_NO,
			PRODUCT_LIST.BRAND_SORT_SEQ, PRODUCT_LIST.ORG_PLACE_CODE, PRODUCT_LIST.STYLE_INFO, PRODUCT_LIST.PRDT_COLOR_INFO, PRODUCT_LIST.MNFTR_NAME,
			PRODUCT_LIST.STD_CTGR_NO, PRODUCT_LIST.STDR_CTGR_NO, PRODUCT_LIST.CNTC_PRDT_SETUP_YN, PRODUCT_LIST.RLTN_GOODS_SETUP_YN, PRODUCT_LIST.ADD_OPTN_SETUP_YN,
			PRODUCT_LIST.SIZE_CHART_DISP_YN, PRODUCT_LIST.SIZE_CHART_SEQ, PRODUCT_LIST.EMP_DSCNT_YN, PRODUCT_LIST.ORDER_MNFCT_YN, PRODUCT_LIST.DPRC_EXCEPT_YN,
			PRODUCT_LIST.STORE_PICKUP_PSBLT_YN, PRODUCT_LIST.FREE_DLVY_YN, PRODUCT_LIST.STOCK_INTGR_YN, PRODUCT_LIST.STOCK_UN_INTGR_RSN_CODE, PRODUCT_LIST.STOCK_MGMT_YN,
			PRODUCT_LIST.BUY_LIMIT_YN, PRODUCT_LIST.MIN_BUY_PSBLT_QTY, PRODUCT_LIST.DAY_MAX_BUY_PSBLT_QTY, PRODUCT_LIST.MAX_BUY_PSBLT_QTY, PRODUCT_LIST.ITEM_CODE,
			PRODUCT_LIST.GENDER_GBN_CODE, PRODUCT_LIST.DISP_FLAG_TEXT, PRODUCT_LIST.SRCH_PSBLT_YN, PRODUCT_LIST.SRCH_KEY_WORD_TEXT, PRODUCT_LIST.WRHS_ALERT_YN,
			PRODUCT_LIST.SELL_START_DTM, PRODUCT_LIST.SELL_END_DTM, PRODUCT_LIST.RSV_PRDT_YN, PRODUCT_LIST.RSV_DLVY_YMD, PRODUCT_LIST.AFFLTS_SEND_YN,
			PRODUCT_LIST.SABANGNET_SEND_YN, PRODUCT_LIST.ACONNECT_DISP_YN, PRODUCT_LIST.DISP_YN, PRODUCT_LIST.IGRMALL_DISP_EXCEPT_YN, PRODUCT_LIST.VNDR_SUSPD_YN,
			PRODUCT_LIST.APRV_STAT_CODE, PRODUCT_LIST.SELL_STAT_CODE, PRODUCT_LIST.USE_YN, PRODUCT_LIST.RGSTER_NO, PRODUCT_LIST.RGST_DTM,
			PRODUCT_LIST.APRVER_NO, PRODUCT_LIST.APRVER_DTM, PRODUCT_LIST.MODER_NO, PRODUCT_LIST.MOD_DTM, PRODUCT_LIST.NORMAL_AMT,
			PRODUCT_LIST.SELL_AMT, PRODUCT_LIST.ERP_DSCNT_RATE, PRODUCT_LIST.ONLN_DSCNT_RATE, PRODUCT_LIST.EMP_DSCNT_RATE, PRODUCT_LIST.BRAND_NAME,
			PRODUCT_LIST.BRAND_EN_NAME, PRODUCT_LIST.TITLE_IMAGE_NAME, PRODUCT_LIST.TITLE_IMAGE_PATH_TEXT, PRODUCT_LIST.TITLE_IMAGE_URL, PRODUCT_LIST.TITLE_IMAGE_ALTRN_TEXT,
			PRODUCT_LIST.STD_CTGR_NAME, PRODUCT_LIST.STDR_CTGR_NAME, PRODUCT_LIST.SITE_NAME, PRODUCT_LIST.CHNNL_NAME, PRODUCT_LIST.VNDR_NAME,
			PRODUCT_LIST.DFLT_CMSN_RATE, DBO.FN_PRDT_PROMO_PRICE(PRODUCT_LIST.PRDT_NO) AS DISPLAY_PRODUCT_PRICE,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.APRVER_ADMIN, 1, '^') AS APRVER_ID,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.APRVER_ADMIN, 2, '^') AS APRVER_NAME,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.RGSTER_ADMIN, 1, '^') AS RGSTER_ID,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.RGSTER_ADMIN, 2, '^') AS RGSTER_NAME,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.MODER_ADMIN, 1, '^') AS MODER_ID,
			DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.MODER_ADMIN, 2, '^') AS MODER_NAME,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 1, '^')) AS ORDER_PSBLT_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 2, '^')) AS TOTAL_STOCK_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 3, '^')) AS TOTAL_ORDER_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 4, '^')) AS STOCK_AI_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 5, '^')) AS STOCK_AW_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 6, '^')) AS STOCK_AS_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 7, '^')) AS STOCK_VD_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 8, '^')) AS AVAIABLE_STOCK_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 9, '^')) AS USE_YN_QTY,
			CONVERT(INT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT_LIST.STOCK_INFO, 10, '^')) AS TOTAL_OPTION_COUNT<!-- 옵션전체갯수 -->
			<if test='bean.conditionColumnName != null and bean.conditionColumnName == "promo_no" '><!-- 프로모션 테이블이 매핑일 경우, 해당상품에 프로모션이 걸려있는 번호 조회 -->
				,STUFF((SELECT CONCAT(',', PPTP.promo_no) FROM pr_promotion_target_product PPTP WITH(NOLOCK)
						INNER JOIN pr_promotion PP WITH(NOLOCK)
									ON PP.promo_no = PPTP.promo_no
									AND PP.promo_start_dtm <![CDATA[<=]]> getDate() AND PP.promo_end_dtm <![CDATA[>=]]> getDate()
									AND PP.promo_type_code != '${@kr.co.abcmart.constant.CommonCode@PROMO_TYPE_CODE_GIFT_PAYMENT}'
									AND PP.use_yn = 'Y'
						WHERE PPTP.prdt_no = PRODUCT_LIST.prdt_no AND PPTP.promo_no != #{bean.conditionColumnValue, jdbcType=VARCHAR}
						FOR XML PATH('')),1, 1,'') AS dupl_promo_no
			</if>
			<if test="bean.searchForAppliedPromotion == true"><!-- 연계된 프로모션 조회 여부 -->
			, STUFF((
				SELECT
					', ' + CONCAT(PROMO.PROMO_NAME, '(', PROMO.PROMO_NO, ')')
				FROM
					pr_promotion_target_product PROMO_PRODUCT WITH(NOLOCK)
					LEFT OUTER JOIN pr_promotion PROMO WITH(NOLOCK) ON PROMO_PRODUCT.PROMO_NO = PROMO.PROMO_NO
				WHERE
					PROMO_PRODUCT.prdt_no = PRODUCT_LIST.PRDT_NO
					AND GETDATE() &gt;= PROMO.promo_start_dtm
					AND GETDATE() &lt;= PROMO.promo_end_dtm
					AND PROMO.use_yn = 'Y'
				FOR XML PATH('')), 1, 1, '') AS APPLIED_PROMOTION_INFO
			</if>
		FROM
			${bean.mappingTableName} A WITH(NOLOCK)
			INNER JOIN (
				SELECT PRODUCT.*,
                      ISNULL(PRODUCT_IMAGE.IMAGE_NAME, '') AS TITLE_IMAGE_NAME, ISNULL(PRODUCT_IMAGE.IMAGE_PATH_TEXT, '') AS TITLE_IMAGE_PATH_TEXT, ISNULL(PRODUCT_IMAGE.IMAGE_URL, '') AS TITLE_IMAGE_URL, ISNULL(PRODUCT_IMAGE.ALTRN_TEXT, '') AS TITLE_IMAGE_ALTRN_TEXT,
                      STANDARD_CATEGORY.STD_CTGR_NAME,
                      CATEGORY.CTGR_NAME AS STDR_CTGR_NAME,
                      SITE.SITE_NAME,
                      SITE_CHNNL.CHNNL_NAME,
                      VENDOR.VNDR_NAME,
                      VENDOR_COMMISION.DFLT_CMSN_RATE,
                      (
                              SELECT CONCAT(Z.LOGIN_ID, '^', Z.ADMIN_NAME)
                                FROM SY_ADMIN Z WITH(NOLOCK)
                               WHERE Z.ADMIN_NO = PRODUCT.APRVER_NO
                      ) AS APRVER_ADMIN,
                      (
                              SELECT CONCAT(Z.LOGIN_ID, '^', Z.ADMIN_NAME)
                                FROM SY_ADMIN Z WITH(NOLOCK)
                               WHERE Z.ADMIN_NO = PRODUCT.RGSTER_NO
                      ) AS RGSTER_ADMIN,
                      (
                              SELECT CONCAT(Z.LOGIN_ID, '^', Z.ADMIN_NAME)
                                FROM SY_ADMIN Z WITH(NOLOCK)
                               WHERE Z.ADMIN_NO = PRODUCT.MODER_NO
                      ) AS MODER_ADMIN,
                      CASE PRODUCT.MMNY_PRDT_YN WHEN 'Y' THEN -- 자사 상품
                                                              CASE PRODUCT.STOCK_INTGR_YN WHEN 'Y' THEN ( --재고 통함 여부
                                                                                                       SELECT CONCAT(
                                                                                                                       SUM(X.ORDER_PSBLT_QTY) / 3
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_STOCK_QTY)
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_ORDER_QTY)
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10000' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10001' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10002' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))
                                                                                                                     , '^0'
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(Y.STOCK_QTY - Y.ORDER_COUNT))
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE WHEN X.USE_YN = 'Y' AND X.ORDER_PSBLT_QTY &gt; 0 THEN 1 ELSE 0 END) / 3)
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 옵션전체갯수. 가용율 구하는데 사용됨 -->
                                                                                                              )
                                                                                                         FROM PD_PRODUCT_OPTION X WITH(NOLOCK)
                                                                                                         JOIN PD_PRODUCT_OPTION_STOCK Y WITH(NOLOCK) ON X.PRDT_NO = Y.PRDT_NO AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
                                                                                                        WHERE X.PRDT_NO = PRODUCT.PRDT_NO
                                                                                                          	--AND X.SELL_STAT_CODE = '10001'<!-- 판매중 -->
                                                                                                          	--AND X.USE_YN = 'Y'<!-- 사용(전시)여부 -->
                                                                                                        GROUP BY X.PRDT_NO
                                                                                                       )
                                                                                         ELSE         ( --재고 통함 여부
                                                                                                       SELECT CONCAT(
                                                                                                                       SUM(X.ORDER_PSBLT_QTY)
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_STOCK_QTY)
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_ORDER_QTY)
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10000' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))
                                                                                                                     , '^0^0^0'
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(Y.STOCK_QTY - Y.ORDER_COUNT))
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE WHEN X.USE_YN = 'Y' AND X.ORDER_PSBLT_QTY &gt; 0 THEN 1 ELSE 0 END))<!-- 판매가능한 옵션 갯수 -->
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 옵션전체갯수. 가용율 구하는데 사용됨 -->
                                                                                                              )
                                                                                                         FROM PD_PRODUCT_OPTION X WITH(NOLOCK)
                                                                                                         JOIN PD_PRODUCT_OPTION_STOCK Y WITH(NOLOCK) ON X.PRDT_NO = Y.PRDT_NO AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
                                                                                                        WHERE X.PRDT_NO = PRODUCT.PRDT_NO
                                                                                                        	AND Y.STOCK_GBN_CODE = '10000'<!-- AI(온라인) 재고 -->
                                                                                                          	--AND X.SELL_STAT_CODE = '10001'<!-- 판매중 -->
                                                                                                          	--AND X.USE_YN = 'Y'<!-- 사용(전시)여부 -->
                                                                                                        GROUP BY X.PRDT_NO
                                                                                                       )
                                                              END
                                                WHEN 'N' THEN
                                                              CASE PRODUCT.STOCK_MGMT_YN WHEN 'Y' THEN (
                                                                                                       SELECT CONCAT(
                                                                                                                       SUM(X.ORDER_PSBLT_QTY)<!-- 주문가능수량 -->
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_STOCK_QTY)<!-- 총 재고수량 -->
                                                                                                                     , '^'
                                                                                                                     , MIN(X.TOTAL_ORDER_QTY)<!-- 총 주문수량 -->
                                                                                                                     , '^0^0^0^'<!-- AI/AW/AS 재고량 -->
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE Y.STOCK_GBN_CODE WHEN '10003' THEN Y.STOCK_QTY - Y.ORDER_COUNT ELSE 0 END))<!-- VD 재고량 -->
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), SUM(Y.STOCK_QTY - Y.ORDER_COUNT))<!-- 활용가능한 재고량 -->
                                                                                                                     , '^'
                                                                                                                     --, CONVERT(VARCHAR(10), SUM(CASE X.USE_YN WHEN 'Y' THEN 1 ELSE 0 END) / COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 전시중인옵션갯수. 입점은 옵션번호가 한개씩이므로 나눗셈 제거 -->
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE WHEN X.USE_YN = 'Y' AND X.ORDER_PSBLT_QTY &gt; 0 THEN 1 ELSE 0 END))<!-- 판매가능한 옵션 갯수 -->
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 옵션전체갯수. 가용율 구하는데 사용됨 -->
                                                                                                              )
                                                                                                         FROM PD_PRODUCT_OPTION X WITH(NOLOCK)
                                                                                                         JOIN PD_PRODUCT_OPTION_STOCK Y WITH(NOLOCK) ON X.PRDT_NO = Y.PRDT_NO AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
                                                                                                        WHERE X.PRDT_NO = PRODUCT.PRDT_NO
                                                                                                        GROUP BY X.PRDT_NO
                                                                                                       )
                                                                                         ELSE          (
                                                                                                       SELECT CONCAT(
                                                                                                                       '9999^9999^9999^0^0^0^9999^9999^'
                                                                                                                     --, CONVERT(VARCHAR(10), SUM(CASE X.USE_YN WHEN 'Y' THEN 1 ELSE 0 END) / COUNT(DISTINCT X.PRDT_OPTN_NO))
                                                                                                                     , CONVERT(VARCHAR(10), SUM(CASE X.USE_YN WHEN 'Y' THEN 1 ELSE 0 END))<!-- 판매가능한 옵션 갯수 -->
                                                                                                                     , '^'
                                                                                                                     , CONVERT(VARCHAR(10), COUNT(DISTINCT X.PRDT_OPTN_NO))<!-- 옵션전체갯수. 가용율 구하는데 사용됨 -->
                                                                                                              )
                                                                                                         FROM PD_PRODUCT_OPTION X WITH(NOLOCK)
                                                                                                         JOIN PD_PRODUCT_OPTION_STOCK Y WITH(NOLOCK) ON X.PRDT_NO = Y.PRDT_NO AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
                                                                                                        WHERE X.PRDT_NO = PRODUCT.PRDT_NO
                                                                                                        GROUP BY X.PRDT_NO
                                                                                                       )
                                                              END
                      END AS STOCK_INFO
                 FROM (
                              SELECT A.PRDT_NO, A.PRDT_TYPE_CODE, A.SITE_NO, A.CHNNL_NO, A.PRDT_NAME, A.ENG_PRDT_NAME, A.VNDR_NO, A.VNDR_PRDT_NO_TEXT, A.MMNY_PRDT_YN, A.BRAND_NO, A.BRAND_SORT_SEQ,
                                     A.ORG_PLACE_CODE, A.STYLE_INFO, A.PRDT_COLOR_INFO, A.MNFTR_NAME, A.STD_CTGR_NO, A.STDR_CTGR_NO, A.CNTC_PRDT_SETUP_YN, A.RLTN_GOODS_SETUP_YN, A.ADD_OPTN_SETUP_YN, A.SIZE_CHART_DISP_YN,
                                     A.SIZE_CHART_SEQ, A.EMP_DSCNT_YN, A.ORDER_MNFCT_YN, A.DPRC_EXCEPT_YN, A.STORE_PICKUP_PSBLT_YN, A.FREE_DLVY_YN, A.STOCK_INTGR_YN, A.STOCK_UN_INTGR_RSN_CODE, A.STOCK_MGMT_YN, A.BUY_LIMIT_YN,
                                     A.MIN_BUY_PSBLT_QTY, A.DAY_MAX_BUY_PSBLT_QTY, A.MAX_BUY_PSBLT_QTY, A.ITEM_CODE, A.GENDER_GBN_CODE, A.DISP_FLAG_TEXT, A.SRCH_PSBLT_YN, A.SRCH_KEY_WORD_TEXT, A.WRHS_ALERT_YN, A.SELL_START_DTM,
                                     A.SELL_END_DTM, A.RSV_PRDT_YN, A.RSV_DLVY_YMD, A.AFFLTS_SEND_YN, A.SABANGNET_SEND_YN, A.ACONNECT_DISP_YN, A.DISP_YN, A.IGRMALL_DISP_EXCEPT_YN, A.VNDR_SUSPD_YN, A.APRV_STAT_CODE,
                                     A.SELL_STAT_CODE, A.USE_YN, A.RGSTER_NO, A.RGST_DTM, A.APRVER_NO, A.APRVER_DTM, A.MODER_NO, A.MOD_DTM,
                                     B.NORMAL_AMT, B.SELL_AMT, B.ERP_DSCNT_RATE, B.ONLN_DSCNT_RATE, B.EMP_DSCNT_RATE,
                                     C.BRAND_NAME, C.BRAND_EN_NAME
                                FROM PD_PRODUCT A WITH(NOLOCK)
                                JOIN PD_PRODUCT_PRICE_HISTORY B WITH(NOLOCK) ON A.PRDT_NO = B.PRDT_NO
                                JOIN DP_BRAND C WITH(NOLOCK) ON A.BRAND_NO = C.BRAND_NO
                               LEFT OUTER JOIN SA_PRODUCT_SALES_RANK D WITH(NOLOCK) ON A.PRDT_NO = D.PRDT_NO AND D.TOTAL_TYPE = 'M'<!-- 월기준 --> AND D.TOTAL_DAY = ( SELECT MAX(TOTAL_DAY) FROM SA_PRODUCT_SALES_RANK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO AND Z.TOTAL_TYPE = 'M'<!-- 월기준 --> AND Z.TOTAL_DAY >= DATEADD(DAY, -2, GETDATE()) )
                               WHERE GETDATE() BETWEEN B.APPLY_START_DTM AND B.APPLY_END_DTM
                                 AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO AND Z.USE_YN = 'Y')
                                             AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION_STOCK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
                                 AND A.APRV_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@APRV_STAT_CODE_CONFIRM}'<!-- 승인상태 중 승인완료 -->
					) PRODUCT
					LEFT OUTER JOIN PD_PRODUCT_RELATION_FILE PRODUCT_IMAGE WITH(NOLOCK) ON PRODUCT.PRDT_NO = PRODUCT_IMAGE.PRDT_NO AND PRODUCT_IMAGE.PRDT_RLTN_FILE_SEQ = 1 AND PRODUCT_IMAGE.DISP_POSTN_TYPE = 'P' AND PRODUCT_IMAGE.FILE_TYPE = 'I'
					LEFT OUTER JOIN SY_STANDARD_CATEGORY STANDARD_CATEGORY WITH(NOLOCK) ON STANDARD_CATEGORY.STD_CTGR_NO = PRODUCT.STD_CTGR_NO
					LEFT OUTER JOIN DP_CATEGORY CATEGORY WITH(NOLOCK) ON PRODUCT.STDR_CTGR_NO = CATEGORY.CTGR_NO
					LEFT OUTER JOIN SY_SITE SITE WITH(NOLOCK) ON PRODUCT.SITE_NO = SITE.SITE_NO
					LEFT OUTER JOIN SY_SITE_CHNNL SITE_CHNNL WITH(NOLOCK) ON PRODUCT.CHNNL_NO = SITE_CHNNL.CHNNL_NO
					LEFT OUTER JOIN VD_VENDOR VENDOR WITH(NOLOCK) ON PRODUCT.VNDR_NO = VENDOR.VNDR_NO
					LEFT OUTER JOIN VD_VENDOR_DEFAULT_COMMISSION VENDOR_COMMISION WITH(NOLOCK) ON PRODUCT.VNDR_NO = VENDOR_COMMISION.VNDR_NO AND GETDATE() BETWEEN VENDOR_COMMISION.APPLY_START_YMD AND VENDOR_COMMISION.APPLY_END_YMD
			) PRODUCT_LIST ON A.prdt_no = PRODUCT_LIST.prdt_no
		WHERE
			A.${bean.conditionColumnName} = #{bean.conditionColumnValue, jdbcType=VARCHAR}
		<if test="bean.conditionColumnValue1 != null and bean.conditionColumnValue1 != ''">
		    AND A.${bean.conditionColumnName1} = #{bean.conditionColumnValue1, jdbcType=VARCHAR}
		</if>
		ORDER BY
			A.${bean.sortColumnName} ${bean.sortType}
		<include refid="Paging.mssql" />
    </select>

    <select id="selectProductCountByMapped" parameterType="pageable" resultType="java.lang.Integer">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductCountByMapped [매핑테이블 기준 상품 갯수 조회 쿼리] [김세훈] */
		SELECT
			<include refid="Paging.totalCount" />
		FROM
			${bean.mappingTableName} A WITH(NOLOCK)
		WHERE
			A.${bean.conditionColumnName} = #{bean.conditionColumnValue, jdbcType=VARCHAR}
    </select>

    <select id="selectByCtgrNo" parameterType="pageable" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectByCtgrNo [전시카테고리번호에 대한 상품목록 조회 쿼리] [김세훈] */
		<!-- 부가적인 정보를 조회함에 있어 외부조인을 사용함 -->
		SELECT
			<include refid="select-columns-alias-a" />
			<include refid="select-columns-admin-info" />
		FROM
			dp_category_product C WITH(NOLOCK) ON A.prdt_no = C.ctgr_no
			INNER JOIN pd_product A WITH(NOLOCK)
			<include refid="from-table-sy-admin" />
			<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn == 'Y'.toString()">
				LEFT OUTER JOIN vd_vendor B WITH(NOLOCK) ON A.vndr_no = B.vndr_no
			</if>
		WHERE
			C.ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}
		ORDER BY
			C.prdt_no DESC
		<include refid="Paging.mssql" />
    </select>

    <select id="selectCountByCtgrNo" parameterType="pageable" resultType="java.lang.Integer">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectByCtgrNo [전시카테고리번호에 대한 상품목록 전체 갯수 조회 쿼리] [김세훈] */
		SELECT
			<include refid="Paging.totalCount" />
		FROM
			dp_category_product C WITH(NOLOCK)
		WHERE
			C.ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}
    </select>

    <select id="selectFreegiftVndrPrdtNoText" resultType="String">
    	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectFreegiftVndrPrdtNoText [사은품 중간계용 SEQ 조회 쿼리] [황성준] */
		SELECT NEXT VALUE FOR SEQ_PD_PRODUCT_FREE_GIFT_NO
    </select>

    <select id="selectKey" resultType="String">
    	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectKey [업체상품의 상품번호 채번] [최경호] */
		SELECT NEXT VALUE FOR seq_pd_product_prdt_no
    </select>

    <insert id="insertWithSelectKey" parameterType="kr.co.abcmart.bo.product.model.master.PdProduct">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.insertWithSelectKey [상품 등록 쿼리] [김세훈] */
		INSERT INTO pd_product
			( prdt_no, prdt_type_code, site_no, chnnl_no, prdt_name, eng_prdt_name, vndr_no, vndr_prdt_no_text, mmny_prdt_yn, brand_no, brand_sort_seq, org_place_code, style_info, prdt_color_info, mnftr_name, std_ctgr_no, stdr_ctgr_no, cntc_prdt_setup_yn, rltn_goods_setup_yn, add_optn_setup_yn, size_chart_disp_yn, size_chart_seq, emp_dscnt_yn, order_mnfct_yn, dprc_except_yn, store_pickup_psblt_yn, free_dlvy_yn, stock_intgr_yn, stock_un_intgr_rsn_code, stock_mgmt_yn, buy_limit_yn, min_buy_psblt_qty, day_max_buy_psblt_qty, max_buy_psblt_qty, item_code, gender_gbn_code, disp_flag_text, srch_psblt_yn, srch_key_word_text, wrhs_alert_yn, sell_start_dtm, sell_end_dtm, rsv_prdt_yn, rsv_dlvy_ymd, afflts_send_yn, aconnect_disp_yn, disp_yn, igrmall_disp_except_yn, vndr_suspd_yn, aprv_stat_code, sell_stat_code, use_yn, rgster_no, rgst_dtm, aprver_no, aprver_dtm, moder_no, mod_dtm )
		VALUES
			( #{prdtNo, jdbcType=VARCHAR}, #{prdtTypeCode, jdbcType=VARCHAR}, #{siteNo, jdbcType=VARCHAR}, #{chnnlNo, jdbcType=VARCHAR}, #{prdtName, jdbcType=VARCHAR}, #{engPrdtName, jdbcType=VARCHAR}, #{vndrNo, jdbcType=VARCHAR}, #{vndrPrdtNoText, jdbcType=VARCHAR}, #{mmnyPrdtYn, jdbcType=CHAR}, #{brandNo, jdbcType=VARCHAR}, #{brandSortSeq, jdbcType=INTEGER}, #{orgPlaceCode, jdbcType=VARCHAR}, #{styleInfo, jdbcType=VARCHAR}, #{prdtColorInfo, jdbcType=VARCHAR}, #{mnftrName, jdbcType=VARCHAR}, #{stdCtgrNo, jdbcType=VARCHAR}, #{stdrCtgrNo, jdbcType=VARCHAR}, #{cntcPrdtSetupYn, jdbcType=CHAR}, #{rltnGoodsSetupYn, jdbcType=CHAR}, #{addOptnSetupYn, jdbcType=CHAR}, #{sizeChartDispYn, jdbcType=CHAR}, #{sizeChartSeq, jdbcType=INTEGER}, #{empDscntYn, jdbcType=CHAR}, #{orderMnfctYn, jdbcType=CHAR}, #{dprcExceptYn, jdbcType=CHAR}, #{storePickupPsbltYn, jdbcType=CHAR}, #{freeDlvyYn, jdbcType=CHAR}, #{stockIntgrYn, jdbcType=CHAR}, #{stockUnIntgrRsnCode, jdbcType=VARCHAR}, #{stockMgmtYn, jdbcType=CHAR}, #{buyLimitYn, jdbcType=CHAR}, #{minBuyPsbltQty, jdbcType=INTEGER}, #{dayMaxBuyPsbltQty, jdbcType=INTEGER}, #{maxBuyPsbltQty, jdbcType=INTEGER}, #{itemCode, jdbcType=VARCHAR}, #{genderGbnCode, jdbcType=VARCHAR}, #{dispFlagText, jdbcType=VARCHAR}, #{srchPsbltYn, jdbcType=CHAR}, #{srchKeyWordText, jdbcType=VARCHAR}, #{wrhsAlertYn, jdbcType=CHAR}, <choose><when test="sellStartDtm != null">#{sellStartDtm, jdbcType=TIMESTAMP}</when><otherwise>getdate()</otherwise></choose>, <choose><when test="sellEndDtm != null">#{sellEndDtm, jdbcType=TIMESTAMP}</when><otherwise>getdate()</otherwise></choose>, #{rsvPrdtYn, jdbcType=CHAR}, <choose><when test="rsvDlvyYmd != null">#{rsvDlvyYmd, jdbcType=DATE}</when><otherwise>getdate()</otherwise></choose>, #{affltsSendYn, jdbcType=CHAR}, #{aconnectDispYn, jdbcType=CHAR}, #{dispYn, jdbcType=CHAR}, #{igrmallDispExceptYn, jdbcType=CHAR}, #{vndrSuspdYn, jdbcType=CHAR}, #{aprvStatCode, jdbcType=VARCHAR}, #{sellStatCode, jdbcType=VARCHAR}, #{useYn, jdbcType=CHAR}, #{rgsterNo, jdbcType=VARCHAR}, <choose><when test="rgstDtm != null">#{rgstDtm, jdbcType=TIMESTAMP}</when><otherwise>getdate()</otherwise></choose>, #{aprverNo, jdbcType=VARCHAR}, <choose><when test="aprverDtm != null">#{aprverDtm, jdbcType=TIMESTAMP}</when><otherwise>getdate()</otherwise></choose>, #{moderNo, jdbcType=VARCHAR}, <choose><when test="modDtm != null">#{modDtm, jdbcType=TIMESTAMP}</when><otherwise>getdate()</otherwise></choose> )
    </insert>

    <select id="selectFreeGift" parameterType="pageable" resultType="kr.co.abcmart.bo.product.model.master.PdFreeGift">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectFreeGift [사은품 다건 조회 쿼리] [황성준] */
		SELECT
			  A.prdt_no, A.prdt_name, A.disp_yn, A.mod_dtm, A.rgster_no, A.moder_no
			, PO.use_yn, PO.total_stock_qty, PO.total_order_qty, PO.order_psblt_qty
			, B.admin_name AS rgster_name
			, B.login_id AS rgster_id
			, C.admin_name AS moder_name
			, C.login_id AS moder_id
		FROM pd_product A WITH(NOLOCK)
		JOIN pd_product_option PO WITH(NOLOCK)
		ON A.prdt_no = PO.prdt_no
		AND PO.prdt_optn_no = '001'
		AND PO.optn_name = '사은품'
		JOIN sy_admin B WITH(NOLOCK)
		ON A.rgster_no = B.admin_no
		JOIN sy_admin C WITH(NOLOCK)
		ON A.moder_no = C.admin_no
		<where>
			<!-- 사은품ID -->
			<if test="bean.prdtNo != null and bean.prdtNo != ''">
				AND A.prdt_no LIKE #{bean.prdtNo, jdbcType=VARCHAR} + '%'
			</if>
			<!-- 사은품명 -->
			<if test="bean.prdtName != null and bean.prdtName != ''">
				AND A.prdt_name LIKE #{bean.prdtName, jdbcType=VARCHAR} + '%'
			</if>
			<!-- 사용여부 -->
			<if test='bean.useYn != null and bean.useYn != ""'>
				AND PO.use_yn =  #{bean.useYn, jdbcType=VARCHAR}
			</if>
			<!-- 전시여부 -->
			<if test="bean.dispYn != null and bean.dispYn != ''">
				AND A.disp_yn = #{bean.dispYn, jdbcType=CHAR}
			</if>
				AND A.prdt_type_code = '10003'
		</where>
		ORDER BY
    	<choose>
			 <when test='sortColumn != null and sortColumn != ""'>
			 	<if test='sortColumn == "prdtName"'>
			 		A.prdt_name
			 	</if>
			 	<if test='sortColumn == "totalStockQty"'>
			 		PO.total_stock_qty
			 	</if>
			 	<if test='sortColumn == "modDtm"'>
			 		A.mod_dtm
			 	</if>
			 	<if test='sortType == "DESC"'>
			 		DESC
			 	</if>
			 </when>
			 <otherwise>
			 	A.prdt_no DESC
			 </otherwise>
		</choose>
		<include refid="Paging.mssql" />
    </select>

     <select id="selectFreeGiftCount" parameterType="pageable" resultType="java.lang.Integer">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectFreeGiftCount [사은품 갯수 조회 쿼리] [황성준] */
		SELECT
			<include refid="Paging.totalCount" />
		FROM pd_product A WITH(NOLOCK)
		JOIN pd_product_option PO WITH(NOLOCK)
		ON A.prdt_no = PO.prdt_no
		AND PO.prdt_optn_no = '001'
		AND PO.optn_name = '사은품'
		JOIN sy_admin B WITH(NOLOCK)
		ON A.rgster_no = B.admin_no
		JOIN sy_admin C WITH(NOLOCK)
		ON A.moder_no = C.admin_no
		<where>
			<!-- 사은품ID -->
			<if test="bean.prdtNo != null and bean.prdtNo != ''">
				AND A.prdt_no LIKE #{bean.prdtNo, jdbcType=VARCHAR} + '%'
			</if>
			<!-- 사은품명 -->
			<if test="bean.prdtName != null and bean.prdtName != ''">
				AND A.prdt_name LIKE #{bean.prdtName, jdbcType=VARCHAR} + '%'
			</if>
			<!-- 사용여부 -->
			<if test='bean.useYn != null and bean.useYn != ""'>
				AND PO.use_yn =  #{bean.useYn, jdbcType=VARCHAR}
			</if>
			<!-- 전시여부 -->
			<if test="bean.dispYn != null and bean.dispYn != ''">
				AND A.disp_yn = #{bean.dispYn, jdbcType=CHAR}
			</if>
				AND A.prdt_type_code = '10003'
		</where>
    </select>

    <select id="selectRelationProduct" parameterType="pageable" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectRelationProduct [관련용품 조회 쿼리] [김세훈] */
		SELECT
			<include refid="select-columns-alias-a" />
		FROM
			pd_relation_product B WITH(NOLOCK)
			INNER JOIN pd_product A WITH(NOLOCK) ON B.prdt_no = A.prdt_no
		<where>
			<if test="bean.prdtNo != null">
				 B.prdt_no = #{bean.prdtNo, jdbcType=VARCHAR}
			</if>
			<if test="bean.rltnPrdtTypeCode != null">
				 AND B.rltn_prdt_type_code = #{bean.rltnPrdtTypeCode, jdbcType=VARCHAR}
			</if>
			<if test="bean.rltnPrdtNo != null">
				 AND B.rltn_prdt_no = #{bean.rltnPrdtNo, jdbcType=VARCHAR}
			</if>
			<if test="bean.sortSeq != null">
				 AND B.sort_seq = #{bean.sortSeq, jdbcType=INTEGER}
			</if>
			<if test="bean.rgsterNo != null">
				 AND B.rgster_no = #{bean.rgsterNo, jdbcType=VARCHAR}
			</if>
			<if test="bean.rgstDtm != null">
				 AND B.rgst_dtm = #{bean.rgstDtm, jdbcType=TIMESTAMP}
			</if>
		</where>
		ORDER BY
			A.prdt_no DESC
		<include refid="Paging.mssql" />
    </select>

    <select id="selectRelationProductCount" parameterType="pageable" resultType="java.lang.Integer">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectRelationProductCount [관련용품 조회 쿼리] [김세훈] */
		SELECT
			<include refid="Paging.totalCount" />
		FROM
			pd_relation_product B WITH(NOLOCK)
			INNER JOIN pd_product A WITH(NOLOCK) ON B.prdt_no = A.prdt_no
		<where>
			<if test="bean.prdtNo != null">
				 B.prdt_no = #{bean.prdtNo, jdbcType=VARCHAR}
			</if>
			<if test="bean.rltnPrdtTypeCode != null">
				 AND B.rltn_prdt_type_code = #{bean.rltnPrdtTypeCode, jdbcType=VARCHAR}
			</if>
			<if test="bean.rltnPrdtNo != null">
				 AND B.rltn_prdt_no = #{bean.rltnPrdtNo, jdbcType=VARCHAR}
			</if>
			<if test="bean.sortSeq != null">
				 AND B.sort_seq = #{bean.sortSeq, jdbcType=INTEGER}
			</if>
			<if test="bean.rgsterNo != null">
				 AND B.rgster_no = #{bean.rgsterNo, jdbcType=VARCHAR}
			</if>
			<if test="bean.rgstDtm != null">
				 AND B.rgst_dtm = #{bean.rgstDtm, jdbcType=TIMESTAMP}
			</if>
		</where>
    </select>

    <sql id="where-productApproval-search-vo-alias-a">
    	<where>
    		<if test='bean.atPO == "Y"'>
	    		AND A.aprv_stat_code != '10004'
    		</if>
    		<if test='bean.atPO == "N"'>
    			AND A.aprv_stat_code != '10000'
    		</if>
    		<!-- 자사/입점 구분 -->
    		<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn != ''">
    			AND A.mmny_prdt_yn = #{bean.mmnyPrdtYn, jdbcType=VARCHAR}
    		</if>
			<!-- 전시 채널 -->
			<if test='bean.chnnlNo != null and bean.chnnlNo != ""'>
				 AND A.chnnl_no = #{bean.chnnlNo, jdbcType=VARCHAR}
			</if>
			<!-- 사이트정보 -->
			<if test='bean.siteNo != null and bean.siteNo != ""'>
				 AND A.site_no = #{bean.siteNo, jdbcType=VARCHAR}
			</if>
			<!-- 상품코드 검색 -->
    		<if test="bean.prdtCodeType != null and bean.prdtCodeType != ''">
    			<if test="bean.prdtCodeList != null">
	    			<choose>
	    				<when test="bean.prdtCodeType == 'prdt-code-online'.toString()">
	    					AND A.prdt_no IN
				    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
				    			#{item}
				    		</foreach>
	    				</when>
	    				<when test="bean.prdtCodeType == 'prdt-code-erp'.toString()">
	    					AND A.vndr_prdt_no_text IN
				    		<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
				    			#{item}
				    		</foreach>
	    				</when>
	    			</choose>
	    		</if>
    		</if>
			<!-- 브랜드 -->
			<if test='bean.brandNo != null and bean.brandNo != ""'>
				 AND A.brand_no = #{bean.brandNo, jdbcType=VARCHAR}
			</if>
			<if test='bean.brandName != null and bean.brandName != ""'>
				 AND A.brand_no IN ( SELECT brand_no FROM dp_brand WITH(NOLOCK) WHERE brand_name like #{bean.brandName, jdbcType=VARCHAR} + '%' OR brand_en_name like #{bean.brandName, jdbcType=VARCHAR} + '%' )
			</if>
			<!-- 승인 처리자 -->
			<if test='bean.aprverNo != null and bean.aprverNo != ""'>
				 AND A.aprver_no = #{bean.aprverNo, jdbcType=VARCHAR}
			</if>
			<!-- 기간조회 (상품등록일, 승인요청일, 반려처리일, 승인완료일) -->
    		<if test='bean.periodType != null and bean.periodType != ""'>
    			<if test='bean.periodStartDate != null and bean.periodEndDate != null'>
	    			<choose>
	    				<!-- 상품등록일 -->
	    				<when test='bean.periodType == "rgst-dtm"'>
							AND A.rgst_dtm
								BETWEEN CONVERT(DATETIME, CONCAT(#{bean.periodStartDate, jdbcType=VARCHAR}, ' 00:00:00'))
									AND CONVERT(DATETIME, CONCAT(#{bean.periodEndDate, jdbcType=VARCHAR}, ' 23:59:59'))
						</when>
						<!-- 승인요청일 -->
						<when test='bean.periodType == "aprver-request-dtm"'>
							AND A.prdt_no IN
								(SELECT DISTINCT H.prdt_no FROM pd_product_approval_history H WITH(NOLOCK)
									WHERE H.prdt_aprv_stat_code = '10000'
									AND H.aprver_dtm
										BETWEEN CONVERT(DATETIME, CONCAT(#{bean.periodStartDate, jdbcType=VARCHAR}, ' 00:00:00'))
										AND CONVERT(DATETIME, CONCAT(#{bean.periodEndDate, jdbcType=VARCHAR}, ' 23:59:59'))
								)
						</when>
						<!-- 반려처리일 -->
						<when test='bean.periodType == "aprver-return-dtm"'>
							AND A.prdt_no IN
								(SELECT DISTINCT H.prdt_no FROM pd_product_approval_history H WITH(NOLOCK)
									WHERE H.prdt_aprv_stat_code = '10002'
									AND H.aprver_dtm
										BETWEEN CONVERT(DATETIME, CONCAT(#{bean.periodStartDate, jdbcType=VARCHAR}, ' 00:00:00'))
										AND CONVERT(DATETIME, CONCAT(#{bean.periodEndDate, jdbcType=VARCHAR}, ' 23:59:59'))
								)
						</when>
						<!-- 상품완료일 -->
						<when test='bean.periodType == "aprver-complete-dtm"'>
							AND A.prdt_no IN
								(SELECT DISTINCT H.prdt_no FROM pd_product_approval_history H WITH(NOLOCK)
									WHERE H.prdt_aprv_stat_code = '10003'
									AND H.aprver_dtm
										BETWEEN CONVERT(DATETIME, CONCAT(#{bean.periodStartDate, jdbcType=VARCHAR}, ' 00:00:00'))
										AND CONVERT(DATETIME, CONCAT(#{bean.periodEndDate, jdbcType=VARCHAR}, ' 23:59:59'))
								)
						</when>
						<!-- 임시저장일 -->
						<when test='bean.periodType == "temporary-mod-dtm"'>
							AND A.aprv_stat_code = '${@kr.co.abcmart.constant.CommonCode@APRV_STAT_CODE_TEMPORARY}'<!-- 임시저장상태 -->
							AND A.mod_dtm BETWEEN CONVERT(DATETIME, CONCAT(#{bean.periodStartDate, jdbcType=VARCHAR}, ' 00:00:00')) AND CONVERT(DATETIME, CONCAT(#{bean.periodEndDate, jdbcType=VARCHAR}, ' 23:59:59'))
						</when>
	    			</choose>
    			</if>
    		</if>
    		<!-- 승인 구분 -->
    		<if test='bean.prdtAprvReqCode != null and bean.prdtAprvReqCode != ""'>
				AND A.prdt_no IN ( (SELECT DISTINCT prdt_no FROM pd_product_approval_history H WITH(NOLOCK) WHERE prdt_aprv_req_code = #{bean.prdtAprvReqCode, jdbcType=VARCHAR} AND prdt_aprv_hist_seq = (SELECT MAX(prdt_aprv_hist_seq) FROM pd_product_approval_history WHERE prdt_no = H.prdt_no) ) )
    		</if>
    		<if test='bean.searchKeywordType != null and bean.searchKeywordType != "" and bean.searchKeyword != null and bean.searchKeyword != ""'>
    			<choose>
    				<!-- 상품명 -->
	    			<when test='bean.searchKeywordType == "prdt-name"'>
	    				AND A.prdt_name LIKE '%'+#{bean.searchKeyword, jdbcType=VARCHAR}+'%'
	    			</when>
	    			<!-- 스타일 -->
	    			<when test='bean.searchKeywordType == "style-info"'>
	    				AND A.style_info LIKE '%'+#{bean.searchKeyword, jdbcType=VARCHAR}+'%'
	    			</when>
	    			<!-- 등록자명 -->
	    			<when test='bean.searchKeywordType == "rgster-name"'>
	    				AND A.rgster_no IN (SELECT admin_no FROM sy_admin WITH(NOLOCK) WHERE admin_name LIKE '%'+#{bean.searchKeyword, jdbcType=VARCHAR}+'%')
	    			</when>
	    			<!-- 등록자 아이디 -->
	    			<when test='bean.searchKeywordType == "rgster-id"'>
	    				AND A.rgster_no IN (SELECT admin_no FROM sy_admin WITH(NOLOCK) WHERE login_id LIKE '%'+#{bean.searchKeyword, jdbcType=VARCHAR}+'%')
	    			</when>
	    			<!-- 수정자명 -->
	    			<when test='bean.searchKeywordType == "moder-name"'>
	    				AND A.moder_no IN (SELECT admin_no FROM sy_admin WITH(NOLOCK) WHERE admin_name LIKE '%'+#{bean.searchKeyword, jdbcType=VARCHAR}+'%')
	    			</when>
	    			<!-- 수정자 ID -->
	    			<when test='bean.searchKeywordType == "moder-id"'>
	    				AND A.moder_no IN (SELECT admin_no FROM sy_admin WITH(NOLOCK) WHERE login_id LIKE '%'+#{bean.searchKeyword, jdbcType=VARCHAR}+'%')
	    			</when>
	    			<!-- 승인처리자명 -->
	    			<when test='bean.searchKeywordType == "aprver-name"'>
	    				AND A.aprver_no IN (SELECT admin_no FROM sy_admin WITH(NOLOCK) WHERE admin_name LIKE '%'+#{bean.searchKeyword, jdbcType=VARCHAR}+'%')
	    			</when>
	    			<!-- 승인처리자 ID -->
	    			<when test='bean.searchKeywordType == "aprver-id"'>
	    				AND A.aprver_no IN (SELECT admin_no FROM sy_admin WITH(NOLOCK) WHERE login_id LIKE '%'+#{bean.searchKeyword, jdbcType=VARCHAR}+'%')
	    			</when>
	    		</choose>
    		</if>
    		<if test='bean.aprvStatCodeArr != null'>
    			AND A.aprv_stat_code IN
	    		<foreach item="item" index="index" collection="bean.aprvStatCodeArr" open="(" separator="," close=")">
	    			#{item}
	    		</foreach>
    		</if>
    		<!-- 업체번호 -->
    		<if test='bean.vndrNo != null and bean.vndrNo != ""'>
    			AND A.vndr_no = #{bean.vndrNo, jdbcType=VARCHAR}
    		</if>
    		<if test='bean.vndrName != null and bean.vndrName != ""'>
				AND A.vndr_no IN ( SELECT vndr_no FROM VD_VENDOR WITH(NOLOCK) WHERE vndr_name Like #{bean.vndrName, jdbcType=VARCHAR}+'%' )
			</if>
		</where>
    </sql>

    <select id="selectProductApproval" parameterType="pageable" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductApproval [상품승인에서 상품 목록 조회 쿼리] [황성준] */
		<!-- 부가적인 정보를 조회함에 있어 외부조인을 사용함 -->
		SELECT
			<include refid="select-columns-alias-a" />
			, B.vndr_name
			, C.chnnl_name
			, D.brand_name
			, E.site_name
			, F.std_ctgr_name
			, G.prdt_aprv_req_code
			, G.return_rsn_text
			<include refid="select-columns-admin-info" />
		FROM
			pd_product A WITH(NOLOCK)
			<include refid="from-table-sy-admin"/>
			LEFT JOIN vd_vendor B WITH(NOLOCK) ON A.vndr_no = B.vndr_no
			LEFT JOIN sy_site_chnnl C WITH(NOLOCK) ON C.chnnl_no = A.chnnl_no
			LEFT JOIN dp_brand D WITH(NOLOCK) ON D.brand_no = A.brand_no
			LEFT JOIN sy_site E WITH(NOLOCK) ON E.site_no = A.site_no
			LEFT JOIN sy_standard_category F WITH(NOLOCK) ON F.std_ctgr_no = A.std_ctgr_no
			LEFT JOIN pd_product_approval_history G WITH(NOLOCK) ON A.prdt_no = G.prdt_no AND G.prdt_aprv_hist_seq = (SELECT MAX(prdt_aprv_hist_seq) FROM pd_product_approval_history WITH(NOLOCK) WHERE prdt_no = G.prdt_no)
		<include refid="where-productApproval-search-vo-alias-a"/>
		ORDER BY
			<choose>
				<when test='sortColumn != null and sortColumn != ""'>
				 	<if test='sortColumn == "prdtNo"'>
				 		A.prdt_no
				 	</if>
				 	<if test='sortColumn == "vndrPrdtNoText"'>
				 		A.vndr_prdt_no_text
				 	</if>
				 	<if test='sortColumn == "prdtName"'>
				 		A.prdt_name
				 	</if>
				 	<if test='sortColumn == "vndrName"'>
				 		B.vndr_name
				 	</if>
				 	<if test='sortColumn == "rgstDtm"'>
				 		A.rgst_dtm
				 	</if>
				 	<if test='sortColumn == "modDtm"'>
				 		A.mod_dtm
				 	</if>
				 	<if test='sortColumn == "aprverDtm"'>
				 		A.aprver_dtm
				 	</if>
					<if test='sortType == "DESC"'>
				 		DESC
				 	</if>
				 </when>
				<otherwise>
					A.mod_dtm DESC
				</otherwise>
			</choose>

		<include refid="Paging.mssql" />
    </select>

    <select id="selectProductApprovalCount" parameterType="pageable" resultType="java.lang.Integer">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductApprovalCount [상품승인에서 상품 갯수 조회 쿼리] [황성준] */
		<!-- 부가적인 정보를 조회함에 있어 외부조인을 사용함 -->
		SELECT
			<include refid="Paging.totalCount" />
		FROM
			pd_product A WITH(NOLOCK)
			<include refid="from-table-sy-admin"/>
			LEFT JOIN vd_vendor B WITH(NOLOCK) ON A.vndr_no = B.vndr_no
			LEFT JOIN sy_site_chnnl C WITH(NOLOCK) ON C.chnnl_no = A.chnnl_no
			LEFT JOIN dp_brand D WITH(NOLOCK) ON D.brand_no = A.brand_no
			LEFT JOIN sy_site E WITH(NOLOCK) ON E.site_no = A.site_no
			LEFT JOIN sy_standard_category F WITH(NOLOCK) ON F.std_ctgr_no = A.std_ctgr_no
			LEFT JOIN pd_product_approval_history G WITH(NOLOCK) ON A.prdt_no = G.prdt_no AND G.prdt_aprv_hist_seq = (SELECT MAX(prdt_aprv_hist_seq) FROM pd_product_approval_history WITH(NOLOCK) WHERE prdt_no = G.prdt_no)
		<include refid="where-productApproval-search-vo-alias-a"/>
    </select>

    <update id="updateByVndrStatCode" parameterType="kr.co.abcmart.bo.product.model.master.PdProduct">
    	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.updateByVndrStatCode [입점업체 상품정보 일시중지여부 일괄변경 쿼리] [김세훈] */
    	UPDATE
    		pd_product
		SET
			vndr_suspd_yn = #{vndrSuspdYn, jdbcType=VARCHAR}
		WHERE
			vndr_no =  #{vndrNo, jdbcType=VARCHAR}
    </update>

    <select id="selectDetail" parameterType="kr.co.abcmart.bo.product.model.master.PdProduct" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectDetail [상품 상세 조회 쿼리] [김세훈] */
		<!-- 부가적인 정보를 조회함에 있어 외부조인을 사용함 -->
		SELECT
			<include refid="select-columns-alias-a" />
			<include refid="select-columns-admin-info" />
		FROM
			pd_product A WITH(NOLOCK)
			<include refid="from-table-sy-admin" />
		WHERE
			A.prdt_no = #{prdtNo, jdbcType=VARCHAR}
			<if test="siteNo != null and siteNo != ''">
				AND A.site_no = #{siteNo, jdbcType=VARCHAR}
			</if>
			<if test="chnnlNo != null and chnnlNo != ''">
				AND A.chnnl_no = #{chnnlNo, jdbcType=VARCHAR}
			</if>
			<if test="vndrPrdtNoText != null and vndrPrdtNoText != ''">
				AND A.vndr_prdt_no_text = #{vndrPrdtNoText, jdbcType=VARCHAR}
			</if>
			<if test="vndrNo != null and vndrNo != ''">
				AND A.vndr_no = #{vndrNo, jdbcType=VARCHAR}
			</if>
			<if test="mmnyPrdtYn != null and mmnyPrdtYn != ''">
				AND A.mmny_prdt_yn = #{mmnyPrdtYn, jdbcType=VARCHAR}
			</if>
    </select>

    <select id="selectAprvAdminList" resultType="kr.co.abcmart.bo.system.model.master.SyAdmin">
    	SELECT A.admin_no, A.login_id, A.admin_name
    	FROM SY_ADMIN A WITH(NOLOCK)
    	WHERE A.admin_no IN ( (SELECT DISTINCT aprver_no FROM PD_PRODUCT WITH(NOLOCK) WHERE aprv_stat_code = '10004') )
    	ORDER BY admin_no
    </select>

    <select id="selectProductDashBoardCount" parameterType="Object" resultType="kr.co.abcmart.bo.product.model.master.BdDashboardProduct">
    /*+ kr.co.abcmart.bo.product.repository.master.DpBrandDao.selectProductDashBoardCount [대시보드 상품현황 카운트 조회 쿼리] [김영진] */
		WITH PROCCNT AS (
		SELECT
	           'all' AS TAB_CODE
	         , COUNT(*) AS ITEM_COUNT
	         , CASE
	            WHEN A.CHNNL_NO = '10000' THEN 'a-rt'
	            WHEN A.CHNNL_NO = '10001' THEN 'abc'
	            WHEN A.CHNNL_NO = '10002' THEN 'gs'
	            WHEN A.CHNNL_NO = '10003' THEN 'ots'
	           END AS SITE_NAME
	         , CASE
	            WHEN A.APRV_STAT_CODE = '10004' AND A.SELL_STAT_CODE = '10001' THEN '판매/전시중'
	            WHEN A.SELL_STAT_CODE = '10002' THEN '일시품절'
	            WHEN A.APRV_STAT_CODE = '10001' THEN '승인요청'
	            WHEN A.APRV_STAT_CODE = '10003' THEN '승인반려'
	           END AS ANAME
	      FROM PD_PRODUCT A WITH(NOLOCK)
	      WHERE 1 = 1
	         AND A.PRDT_TYPE_CODE NOT IN ('10003', '10004')
	         AND A.SELL_STAT_CODE IN ('10001', '10002')
	         AND A.APRV_STAT_CODE NOT IN ('10000', '10002')
	         AND A.SELL_START_DTM  BETWEEN CONVERT(DATETIME, CONCAT(
                                           CONVERT(CHAR(10), DATEADD(MM, -1, GETDATE()), 102), ' 00:00:00'))
                                       AND CONVERT(DATETIME, CONCAT(
                                           CONVERT(CHAR(10), GETDATE(), 102), ' 23:59:59'))
	      GROUP BY A.APRV_STAT_CODE, A.SELL_STAT_CODE, A.CHNNL_NO
	      UNION ALL
	      SELECT
	           'my' AS TAB_CODE
	         , COUNT(*) AS ITEM_COUNT
	         , CASE
	            WHEN A.CHNNL_NO = '10000' THEN 'a-rt'
	            WHEN A.CHNNL_NO = '10001' THEN 'abc'
	            WHEN A.CHNNL_NO = '10002' THEN 'gs'
	            WHEN A.CHNNL_NO = '10003' THEN 'ots'
	           END AS SITE_NAME
	         , CASE
	            WHEN A.APRV_STAT_CODE = '10004' AND A.SELL_STAT_CODE = '10001' THEN '판매/전시중'
	            WHEN A.SELL_STAT_CODE = '10002' THEN '일시품절'
	            WHEN A.APRV_STAT_CODE = '10001' THEN '승인요청'
	            WHEN A.APRV_STAT_CODE = '10003' THEN '승인반려'
	           END AS ANAME
	      FROM PD_PRODUCT A WITH(NOLOCK)
	      WHERE 1 = 1
	         AND A.PRDT_TYPE_CODE NOT IN ('10003', '10004')
	         AND A.SELL_STAT_CODE IN ('10001', '10002')
	         AND A.APRV_STAT_CODE NOT IN ('10000', '10002')
	         AND A.MMNY_PRDT_YN = 'Y'
	         AND A.SELL_START_DTM  BETWEEN CONVERT(DATETIME, CONCAT(
                                           CONVERT(CHAR(10), DATEADD(MM, -1, GETDATE()), 102), ' 00:00:00'))
                                       AND CONVERT(DATETIME, CONCAT(
                                           CONVERT(CHAR(10), GETDATE(), 102), ' 23:59:59'))
	      GROUP BY A.APRV_STAT_CODE, A.SELL_STAT_CODE, A.CHNNL_NO
	      UNION ALL
	      SELECT
	           'company' AS TAB_CODE
	         , COUNT(*) AS ITEM_COUNT
	         , CASE
	            WHEN A.CHNNL_NO = '10000' THEN 'a-rt'
	            WHEN A.CHNNL_NO = '10001' THEN 'abc'
	            WHEN A.CHNNL_NO = '10002' THEN 'gs'
	            WHEN A.CHNNL_NO = '10003' THEN 'ots'
	           END AS SITE_NAME
	         , CASE
	            WHEN A.APRV_STAT_CODE = '10004' AND A.SELL_STAT_CODE = '10001' THEN '판매/전시중'
	            WHEN A.SELL_STAT_CODE = '10002' THEN '일시품절'
	            WHEN A.APRV_STAT_CODE = '10001' THEN '승인요청'
	            WHEN A.APRV_STAT_CODE = '10003' THEN '승인반려'
	           END AS ANAME
	      FROM PD_PRODUCT A WITH(NOLOCK)
	      WHERE 1 = 1
	         AND A.PRDT_TYPE_CODE NOT IN ('10003', '10004')
	         AND A.SELL_STAT_CODE IN ('10001', '10002')
	         AND A.APRV_STAT_CODE NOT IN ('10000', '10002')
	         AND A.MMNY_PRDT_YN = 'N'
	         AND A.SELL_START_DTM  BETWEEN CONVERT(DATETIME, CONCAT(
                                           CONVERT(CHAR(10), DATEADD(MM, -1, GETDATE()), 102), ' 00:00:00'))
                                       AND CONVERT(DATETIME, CONCAT(
                                           CONVERT(CHAR(10), GETDATE(), 102), ' 23:59:59'))
	      GROUP BY A.APRV_STAT_CODE, A.SELL_STAT_CODE, A.CHNNL_NO
	   )
	   SELECT TAB_CODE, SITE_NAME, ISNULL(SUM([판매/전시중]), 0) AS DEPS1, ISNULL(SUM([일시품절]) , 0) AS DEPS2, ISNULL(SUM([승인요청]), 0) AS DEPS3, ISNULL(SUM([요청반려]), 0) AS DEPS4
	   FROM PROCCNT WITH(NOLOCK)
	   PIVOT (
	      SUM(ITEM_COUNT) FOR ANAME IN ([판매/전시중], [일시품절], [승인요청], [요청반려])
	   ) PC
	   GROUP BY TAB_CODE, SITE_NAME
	   ORDER BY TAB_CODE
    </select>

     <select id="selectProductPoDashBoardCount" parameterType="Object" resultType="kr.co.abcmart.bo.product.model.master.BdDashboardProduct">
	    /*+ kr.co.abcmart.bo.product.repository.master.DpBrandDao.selectProductPoDashBoardCount [대시보드 상품현황 카운트 조회 쿼리] [김영진] */
	    WITH PROCCNT AS (
	      SELECT
	           'company' AS TAB_CODE
	         , COUNT(*) AS ITEM_COUNT
	         , CASE
	            WHEN A.CHNNL_NO = '10000' THEN 'a-rt'
	            WHEN A.CHNNL_NO = '10003' THEN 'ots'
	           END AS SITE_NAME
	         , CASE
	            WHEN A.APRV_STAT_CODE = '10004' AND A.SELL_STAT_CODE = '10001' AND A.DISP_YN = 'Y' THEN '판매/전시중'
	            WHEN A.SELL_STAT_CODE = '10002' THEN '일시품절'
	            WHEN A.APRV_STAT_CODE = '10001' THEN '승인요청'
	            WHEN A.APRV_STAT_CODE = '10003' THEN '승인반려'
	           END AS ANAME
	      FROM PD_PRODUCT A WITH(NOLOCK)
	      WHERE 1 = 1
	         AND A.PRDT_TYPE_CODE NOT IN ('10003', '10004')
	         AND A.SELL_STAT_CODE IN ('10001', '10002')
	         AND A.APRV_STAT_CODE NOT IN ('10000', '10002')
			 AND A.CHNNL_NO IN ('10000','10003')
	         AND A.MMNY_PRDT_YN = 'N'
	         AND A.SELL_START_DTM  BETWEEN CONVERT(DATETIME, CONCAT(
                                           CONVERT(CHAR(10), DATEADD(MM, -1, GETDATE()), 102), ' 00:00:00'))
                                       AND CONVERT(DATETIME, CONCAT(
                                           CONVERT(CHAR(10), GETDATE(), 102), ' 23:59:59'))
		   <if test="vndrNo != null">
		  	 AND VNDR_NO = #{vndrNo, jdbcType=VARCHAR}
		   </if>
	      GROUP BY A.APRV_STAT_CODE, A.SELL_STAT_CODE, A.CHNNL_NO, A.DISP_YN
	   )
	   SELECT TAB_CODE, SITE_NAME, ISNULL(SUM([판매/전시중]), 0) AS DEPS1, ISNULL(SUM([일시품절]) , 0) AS DEPS2, ISNULL(SUM([승인요청]), 0) AS DEPS3, ISNULL(SUM([요청반려]), 0) AS DEPS4
	   FROM PROCCNT WITH(NOLOCK)
	   PIVOT (
	      SUM(ITEM_COUNT) FOR ANAME IN ([판매/전시중], [일시품절], [승인요청], [요청반려])
	   ) PC
	   GROUP BY TAB_CODE, SITE_NAME
	   ORDER BY TAB_CODE


    </select>

    <select id="selectProductDlvy" parameterType="java.lang.String" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
	/*+ kr.co.abcmart.bo.product.repository.master.DpBrandDao.selectProductDlvy [배송비 상품 조회 쿼리] [김태호] */
		SELECT A.PRDT_NO
			 , A.PRDT_TYPE_CODE
			 , A.SITE_NO
			 , A.CHNNL_NO
			 , A.PRDT_NAME
			 , A.ENG_PRDT_NAME
			 , A.MMNY_PRDT_YN
			 , A.STYLE_INFO
			 , A.PRDT_COLOR_INFO
			 , A.MNFTR_NAME
			 , A.ITEM_CODE
			 , A.GENDER_GBN_CODE
		FROM PD_PRODUCT A WITH(NOLOCK)
		<where>
			AND A.PRDT_TYPE_CODE = #{value}
		</where>
	</select>

	<update id="updateDisableByBrandNo" parameterType="java.lang.String">
		/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.updateDisableByBrandNo [브랜드 사용안함에 의한 상품 비활성화 처리 쿼리] [김세훈] */
		UPDATE
			pd_product
		SET
			sell_stat_code = '${@kr.co.abcmart.constant.CommonCode@SELL_STAT_CODE_STOP}',<!-- 판매중지 -->
			disp_yn = 'N'
		WHERE
			 brand_no = #{brandNo}
    </update>

    <select id="selectProductSiteInfo" parameterType="kr.co.abcmart.bo.product.model.master.PdProduct" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
    /*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductSiteInfo [업체 상품 코드 와 사이트 번호로 상품 조회] [김진성] */
		SELECT PRDT_NO, VNDR_PRDT_NO_TEXT, SITE_NO, CHNNL_NO
		  FROM PD_PRODUCT
		 WHERE VNDR_PRDT_NO_TEXT = #{vndrPrdtNoText, jdbcType=VARCHAR}
		   AND SITE_NO = #{siteNo, jdbcType=VARCHAR}
    </select>


    <select id="selectProductCountNew" parameterType="pageable" resultType="java.lang.Integer">
    /*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductCountNew [상품 리스트 개수 조회] [김진성] */
		              SELECT COUNT(A.PRDT_NO) AS TOTAL_COUNT
		                FROM PD_PRODUCT A WITH(NOLOCK)
		                JOIN PD_PRODUCT_PRICE_HISTORY B WITH(NOLOCK)
		                  ON A.PRDT_NO = B.PRDT_NO
		                JOIN DP_BRAND C WITH(NOLOCK)
		                  ON A.BRAND_NO = C.BRAND_NO
		                JOIN SY_SITE_CHNNL X WITH(NOLOCK)
		                  ON A.SITE_NO = X.SITE_NO
		                 AND A.CHNNL_NO = X.CHNNL_NO
		               WHERE GETDATE() BETWEEN B.APPLY_START_DTM AND B.APPLY_END_DTM
		                 AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
		                 AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION_STOCK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
		                 AND A.APRV_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@APRV_STAT_CODE_CONFIRM}'<!-- 승인상태 중 승인완료 -->
		                 AND A.PRDT_TYPE_CODE IN ('10000', '10001', '10002') <!-- 상품 유형 코드 ('공통', '온라인', '오프라인') -->
	/*
		2020.03.25 NOT IN 처리 안함
	<if test="bean.excludePrdtTypeCodeList != null">
		                 AND A.PRDT_TYPE_CODE NOT IN <!--  상품유형 중 조회하지 않아야 할 대상. (ex. 사은품,배송비) -->
		<foreach item="item" index="index" collection="bean.excludePrdtTypeCodeList" open="(" separator="," close=")">
		                 {item}
		</foreach>
	</if>
	*/
	<if test="bean.vndrNo != null and bean.vndrNo != ''">
		                 AND A.VNDR_NO = #{bean.vndrNo, jdbcType=VARCHAR}<!-- 업체번호 -->
	</if>
	<if test="bean.prdtTypeCode != null and bean.prdtTypeCode != ''">
		                 AND A.PRDT_TYPE_CODE = #{bean.prdtTypeCode, jdbcType=VARCHAR}<!-- 상품유형 -->
	</if>
	<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn != ''">
		                 AND A.MMNY_PRDT_YN = #{bean.mmnyPrdtYn, jdbcType=VARCHAR}<!-- 자사상품여부 -->
	</if>
	<if test="bean.siteNo != null and bean.siteNo != ''">
		                 AND A.SITE_NO = #{bean.siteNo, jdbcType=VARCHAR}<!-- 사이트번호 -->
	</if>
	<if test="bean.chnnlNo != null and bean.chnnlNo != ''">
		                 AND A.CHNNL_NO = #{bean.chnnlNo, jdbcType=VARCHAR}<!-- 채널번호 -->
	</if>
	<if test="bean.aconnectDispYn != null and bean.aconnectDispYn != ''">
		                 AND A.ACONNECT_DISP_YN = #{bean.aconnectDispYn, jdbcType=VARCHAR}<!-- A-Connect 전시여부 -->
	</if>
	<if test="bean.prdtName != null and bean.prdtName != '' and bean.engPrdtName != null and bean.engPrdtName != ''">
		                 AND A.PRDT_NO IN (
		                 	                 SELECT Z.PRDT_NO FROM PD_PRODUCT Z WITH(NOLOCK) WHERE Z.PRDT_NAME LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
		                 	                 UNION ALL
		                 	                 SELECT Z.PRDT_NO FROM PD_PRODUCT Z WITH(NOLOCK) WHERE Z.ENG_PRDT_NAME LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
		                                  )<!-- 상품명 검색 -->
	</if>
	<if test="bean.styleInfo != null and bean.styleInfo != ''">
		                 AND A.STYLE_INFO LIKE CONCAT('%', #{bean.styleInfo, jdbcType=VARCHAR}, '%')<!-- 스타일검색 -->
	</if>
	<if test="bean.prdtColorInfo != null and bean.prdtColorInfo != ''">
		                 AND A.PRDT_COLOR_INFO LIKE CONCAT('%', #{bean.prdtColorInfo, jdbcType=VARCHAR}, '%')<!-- 색상정보 검색 -->
	</if>
	<if test="bean.srchKeyWordText != null and bean.srchKeyWordText != ''">
		                 AND A.SRCH_KEY_WORD_TEXT LIKE CONCAT('%', #{bean.srchKeyWordText, jdbcType=VARCHAR}, '%')<!-- 상품검색어 검색 -->
	</if>
	<if test="bean.aprverId != null and bean.aprverId != ''">
		                 AND A.APRVER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.aprverId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
	</if>
	<if test="bean.aprverName != null and bean.aprverName != ''">
		                 AND A.APRVER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.aprverName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
	</if>
	<if test="bean.rgsterId != null and bean.rgsterId != ''">
		                 AND A.RGSTER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.rgsterId, jdbcType=VARCHAR} )<!-- 등록자ID 검색 -->
	</if>
	<if test="bean.rgsterName != null and bean.rgsterName != ''">
		                 AND A.RGSTER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.rgsterName, jdbcType=VARCHAR} )<!-- 등록자이름 검색 -->
	</if>
	<if test="bean.moderId != null and bean.moderId != ''">
		                 AND A.MODER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.moderId, jdbcType=VARCHAR} )<!-- 수정자ID 검색 -->
	</if>
	<if test="bean.moderName != null and bean.moderName != ''">
		                 AND A.MODER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.moderName, jdbcType=VARCHAR} )<!-- 수정자이름 검색 -->
	</if>

	<if test="bean.prdtCodeType != null and bean.prdtCodeType != '' and bean.prdtCodeList != null">
		<choose><!-- 상품코드 검색 -->
			<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ONLINE">
		                 AND A.PRDT_NO IN
				<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
		                 	                 #{item}<!-- 온라인상품코드 검색 -->
				</foreach>
			</when>
			<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ERP">
		                 AND A.VNDR_PRDT_NO_TEXT IN
				<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
		                 	                 #{item}<!-- 기간계상품코드 검색 -->
				</foreach>
			</when>
		</choose>
	</if>
	<if test="bean.brandNo != null and bean.brandNo != ''">
		                 AND A.BRAND_NO = #{bean.brandNo, jdbcType=VARCHAR}<!-- 브랜드번호 검색 -->
	</if>
	<if test="bean.brandName != null and bean.brandName != ''">
		                 AND A.BRAND_NO IN (<!-- 브랜드이름 검색 -->
		                 	                 SELECT Z.BRAND_NO FROM DP_BRAND Z WITH(NOLOCK) WHERE Z.BRAND_NAME LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
		                 	                 UNION ALL
		                 	                 SELECT Z.BRAND_NO FROM DP_BRAND Z WITH(NOLOCK) WHERE Z.BRAND_EN_NAME LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
		                 )
	</if>
	<if test="bean.sellStatCodes != null">
		                 AND A.SELL_STAT_CODE IN<!-- 판매상태 중 상품판매코드 -->
		<foreach item="item" index="index" collection="bean.sellStatCodes" open="(" separator="," close=")">
		                 	                 #{item}
		</foreach>
	</if>
	<if test="bean.dispYn != null and bean.dispYn != ''">
		                 AND A.DISP_YN = #{bean.dispYn, jdbcType=CHAR}<!-- 전시여부 검색 -->
	</if>
	<choose>
		<when test="bean.stdCtgrNo3 != null and bean.stdCtgrNo3 != ''">
		                 AND A.STD_CTGR_NO = #{bean.stdCtgrNo3, jdbcType=VARCHAR}<!-- 표준카테고리 중 소카테고리선택시 -->
		</when>
		<when test="bean.stdCtgrNo2 != null and bean.stdCtgrNo2 != ''">
		                 AND A.STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WITH(NOLOCK) WHERE UP_STD_CTGR_NO = #{bean.stdCtgrNo2, jdbcType=VARCHAR} )<!-- 표준카테고리 중 중카테고리선택시 -->
		</when>
		<when test="bean.stdCtgrNo1 != null and bean.stdCtgrNo1 != ''">
		                 AND A.STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WITH(NOLOCK) WHERE UP_STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WHERE UP_STD_CTGR_NO= #{bean.stdCtgrNo1, jdbcType=VARCHAR} ) )<!-- 표준카테고리 중 대카테고리선택시 --><!-- 표준카테고리 중 대카테고리선택시 -->
		</when>
	</choose>
	<if test='bean.ctgrNo != null and bean.ctgrNo != ""'>
		                 AND A.stdr_ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}<!-- 전시카테고리(기준카테고리) 검색 -->
	</if>
	<if test="bean.periodStartDate != null and bean.periodEndDate != null"><!-- 기간조회 (상품등록일, 상품승인완료일, 상품최종수정일, 판매시작일, 판매종료일, 예상출고일) -->
		<choose>
			<when test="bean.periodType == 'aprver-dtm'.toString()"><!-- 최종승인일 -->
		                 AND A.APRVER_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'sell-start-dtm'.toString()"><!-- 판매시작일 -->
		                 AND A.SELL_START_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'sell-end-dtm'.toString()"><!-- 판매종료일 -->
		                 AND A.SELL_END_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'rsv-dlvy-ymd'.toString()"><!-- 예상출고일 -->
		                 AND A.RSV_DLVY_YMD BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'mod_dtm'.toString()"><!-- 수정일 -->
		                 AND A.MOD_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'rgst_dtm'.toString()"><!-- 등록일 -->
		                 AND A.RGST_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
		</choose>
	</if>
	<if test="bean.useAdvancedSearch != null and bean.useAdvancedSearch == 'Y'.toString()"><!-- 추가검색 -->
		<if test="bean.genderGbnCode != null and bean.genderGbnCode != ''">
		                 AND A.GENDER_GBN_CODE = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마 -->
		</if>
		<if test="bean.rsvPrdtYn != null and bean.rsvPrdtYn != ''">
		                 AND A.RSV_PRDT_YN = #{bean.rsvPrdtYn, jdbcType=CHAR}<!-- 예약상품여부 -->
		</if>
		<if test="bean.freeDlvyYn != null and bean.freeDlvyYn != ''">
		                 AND A.FREE_DLVY_YN = #{bean.freeDlvyYn, jdbcType=CHAR}<!-- 무료배송상품여부 -->
		</if>
		<if test="bean.empDscntYn != null and bean.empDscntYn != ''">
		                 AND A.EMP_DSCNT_YN = #{bean.empDscntYn, jdbcType=CHAR}<!-- 임직원 할인제외여부 -->
		</if>
		<if test="bean.dprcExecptYn != null and bean.dprcExecptYn != ''">
		                 AND A.DPRC_EXECPT_YN = #{bean.dprcExecptYn, jdbcType=CHAR}<!-- 감가제외여부 -->
		</if>
		<if test="bean.stockIntgrYn != null and bean.stockIntgrYn != ''">
		                 AND A.STOCK_INTGR_YN = #{bean.stockIntgrYn, jdbcType=CHAR}<!-- 통합재고연동여부 -->
		</if>
		<if test="bean.dispFlag != null">
		                 AND DISP_FLAG_TEXT IN<!-- 매장등급 -->
			<foreach collection="bean.dispFlag" item="item" open="(" separator="," close=")">
		                 	                 #{item, jdbcType=VARCHAR}
			</foreach>
		</if>
		<if test="bean.storePickupPsbltYn != null and bean.storePickupPsbltYn != ''">
		                 AND A.STORE_PICKUP_PSBLT_YN = #{bean.storePickupPsbltYn, jdbcType=CHAR}<!-- 매장픽업 가능여부 -->
		</if>
		<if test="bean.affltsSendYn != null and bean.affltsSendYn != ''">
		                 AND A.AFFLTS_SEND_YN = #{bean.affltsSendYn, jdbcType=CHAR}<!-- 제휴사 전송대상 -->
		</if>
		<if test="bean.sabangnetSendYn != null and bean.sabangnetSendYn != ''">
		                 AND A.SABANGNET_SEND_YN = #{bean.sabangnetSendYn, jdbcType=CHAR}<!-- 사방넷 전송 여부 -->
		</if>
		<if test="bean.sellPriceStartWith != null and bean.sellPriceStartWith >= 0 and bean.sellPriceEndWith != null and bean.sellPriceEndWith >= 0">
		                 AND B.SELL_AMT BETWEEN #{bean.sellPriceStartWith, jdbcType=INTEGER} AND #{bean.sellPriceEndWith, jdbcType=INTEGER}<!-- 판매가 시작~종료 -->
		</if>
		<if test="bean.restockWithinDays != null and bean.restockMoreThanCount != null and bean.restockWithinDays != 0 and bean.restockMoreThanCount != 0"><!-- 재입고 상품조회를 위한 select절 -->
		                 AND A.LAST_WRHS_DAY BETWEEN CONVERT(DATE, DATEADD(DAY, -#{bean.restockWithinDays, jdbcType=INTEGER}, GETDATE())) AND CONVERT(DATE, GETDATE())
		                 AND A.PRDT_NO IN (
		                 	                 SELECT Z.PRDT_NO
		                 	                   FROM PD_PRODUCT_OPTION Z WITH(NOLOCK)
		                 	                  WHERE Z.PRDT_NO = A.PRDT_NO
		                 	                    AND Z.SELL_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@SELL_STAT_CODE_SALE}'<!-- 판매상태 중 판매중 -->
		                 	                    AND Z.USE_YN = 'Y'
		                 	                  GROUP BY Z.PRDT_NO
		                 	                 HAVING SUM(Z.ORDER_PSBLT_QTY) &gt; #{bean.restockMoreThanCount, jdbcType=INTEGER}
		                 	)
		</if>
	</if>

	<if test='bean.tierFlagCode != null'>
		                 AND ISNULL(disp_flag_text, '-') IN<!-- 매장등급 -->
		<foreach collection="bean.tierFlagCode" item="tierFlagCode" open="(" separator="," close=")">
		                 	                 #{tierFlagCode, jdbcType=VARCHAR}
		</foreach>
	</if>
    </select>

	<select id="selectProductNew" parameterType="pageable" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectProductNew [상품 리스트] [김진성] */
		SELECT PRODUCT.MMNY_PRDT_YN
		     , PRODUCT.VNDR_PRDT_NO_TEXT
		     , PRODUCT.CHNNL_NAME
		     , PRODUCT.PRDT_NO
		     , PRODUCT.PRDT_NAME
		     , PRODUCT.BRAND_NAME
		     , PRODUCT.ENG_PRDT_NAME
		     , PRODUCT.BRAND_EN_NAME
		     , PRODUCT.STYLE_INFO
		     , PRODUCT.PRDT_COLOR_INFO
		     , PRODUCT.SELL_STAT_CODE
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 4, '^') AS STOCK_AI_QTY
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 5, '^') AS STOCK_AW_QTY
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 6, '^') AS STOCK_AS_QTY
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 7, '^') AS STOCK_VD_QTY
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 3, '^') AS AVAIABLE_STOCK_QTY
		     , CONVERT(FLOAT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 2, '^')) AS USE_YN_QTY
		     , CONVERT(FLOAT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 1, '^')) AS TOTAL_OPTION_COUNT
		     , CASE WHEN CONVERT(FLOAT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 1, '^')) > 0 THEN CONVERT(FLOAT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 2, '^')) / CONVERT(FLOAT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 1, '^')) * 100 ELSE 0 END AS AVAILABILITY_RATE
		     , PRODUCT.DISP_YN
		     , PRODUCT.STOCK_INTGR_YN
		     , PRODUCT.STOCK_UN_INTGR_RSN_CODE
		     , PRODUCT.NORMAL_AMT
		     , ISNULL(DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 1, '^'), PRODUCT.ERP_SELL_AMT) AS DISPLAY_PRODUCT_PRICE
		     , FLOOR((PRODUCT.NORMAL_AMT - ISNULL(DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 1, '^'), PRODUCT.ERP_SELL_AMT)) / (PRODUCT.NORMAL_AMT * 1.0) * 100.0) AS DISPLAY_DISCOUNT_RATE
		     , PRODUCT.GENDER_GBN_CODE
		     , PRODUCT.STD_CTGR_NAME
		     , PRODUCT.STDR_CTGR_NAME
		     , PRODUCT.ERP_SELL_AMT
		     , PRODUCT.ERP_DSCNT_RATE
		     , ISNULL(DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 3, '^'), PRODUCT.NORMAL_AMT) AS ONLN_SELL_AMT
		     , CASE WHEN DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 3, '^') IS NOT NULL THEN FLOOR((PRODUCT.NORMAL_AMT - DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 3, '^')) / (PRODUCT.NORMAL_AMT * 1.0) * 100.0) ELSE 0 END AS ONLN_DSCNT_RATE
		     , PRODUCT.EMP_SELL_AMT
		     , PRODUCT.EMP_DSCNT_RATE
		     , PRODUCT.VNDR_NAME
		     , PRODUCT.RSV_PRDT_YN
		     , PRODUCT.SELL_START_DTM
		     , PRODUCT.SELL_END_DTM
		     , PRODUCT.APRVER_DTM
		     , PRODUCT.LAST_WRHS_DAY
		     , PRODUCT.TITLE_IMAGE_NAME
		     , PRODUCT.TITLE_IMAGE_PATH_TEXT
		     , PRODUCT.TITLE_IMAGE_URL
		     , PRODUCT.TITLE_IMAGE_ALTRN_TEXT
		     , CASE WHEN PRODUCT.MMNY_PRDT_YN = 'Y' THEN 0 ELSE PRODUCT.CMSN_RATE END AS VNDR_CMSN_RATE
		  FROM (
		              SELECT A.MMNY_PRDT_YN
		                   , A.VNDR_PRDT_NO_TEXT
		                   , X.CHNNL_NAME
		                   , A.PRDT_NO
		                   , A.PRDT_NAME
		                   , A.ENG_PRDT_NAME
		                   , C.BRAND_NAME
		                   , C.BRAND_EN_NAME
		                   , A.STYLE_INFO
		                   , A.PRDT_COLOR_INFO
		                   , SELL_STAT_CODE.CODE_DTL_NAME AS SELL_STAT_CODE
		                   , (
		                          SELECT CONCAT(
		                                       SUM(CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') THEN 1 ELSE 0 END ) / COUNT(DISTINCT Y.STOCK_GBN_CODE), '^', /*<!-- FO에 노출된 옵션 수 -->*/
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' THEN /* 자사 상품 */
		                                                     CASE WHEN Z.STOCK_INTGR_YN = 'Y' THEN /* 재고 통합 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE IN ('10000', '10001', '10002') AND (Y.STOCK_QTY - Y.ORDER_COUNT) > 0 THEN 1 ELSE 0 END
		                                                                                      ELSE /* 재고 미 통합 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE = '10000' AND (Y.STOCK_QTY - Y.ORDER_COUNT) > 0 THEN 1 ELSE 0 END
		                                                     END
		                                                WHEN Z.MMNY_PRDT_YN = 'N' THEN /* 입점 상품 */
		                                                     CASE WHEN Z.STOCK_MGMT_YN = 'Y' THEN /* 재고 관리 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE = '10003' AND (Y.STOCK_QTY - Y.ORDER_COUNT) > 0  THEN 1 ELSE 0 END
		                                                                                     ELSE /* 재고 미 관리 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') THEN 1 ELSE 0 END
		                                                     END
		                                           END) / COUNT(DISTINCT CASE WHEN Z.STOCK_INTGR_YN = 'Y' THEN Y.STOCK_GBN_CODE ELSE 1 END), '^',  /* <!-- 판매 가능 옵션 수 --> */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' THEN /* 자사 상품 */
		                                                     CASE WHEN Z.STOCK_INTGR_YN = 'Y' THEN /* 재고 통합 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE IN ('10000', '10001', '10002') THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END
		                                                                                      ELSE /* 재고 미 통합 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE = '10000' THEN (Y.STOCK_QTY - Y.ORDER_COUNT)  ELSE 0 END
		                                                     END
		                                                WHEN Z.MMNY_PRDT_YN = 'N' THEN /* 입점 상품 */
		                                                     CASE WHEN Z.STOCK_MGMT_YN = 'Y' THEN /* 재고 관리 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE = '10003' THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END
		                                                                                     ELSE /* 재고 미 관리 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') THEN 999 ELSE 0 END
		                                                     END
		                                           END), '^',  /* <!-- 판매 가능 재고 수 --> */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> AND Y.STOCK_GBN_CODE = '10000' THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END), '^', /* AI 재고 */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> AND Y.STOCK_GBN_CODE = '10001' THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END), '^', /* AW 재고 */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> AND Y.STOCK_GBN_CODE = '10002' THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END), '^', /* AS 재고 */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'N' AND Z.STOCK_MGMT_YN = 'Y' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> AND Y.STOCK_GBN_CODE = '10003' THEN (Y.STOCK_QTY - Y.ORDER_COUNT)
		                                                WHEN Z.MMNY_PRDT_YN = 'N' AND Z.STOCK_MGMT_YN = 'N' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> THEN 999
		                                                ELSE 0
		                                           END) /* 입점사 재고 */
		                                 ) AS OPTION_DISPLAY_CNT
		                            FROM PD_PRODUCT_OPTION X
		                            JOIN PD_PRODUCT_OPTION_STOCK Y
		                              ON X.PRDT_NO = Y.PRDT_NO
		                             AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
		                            JOIN PD_PRODUCT Z WITH(NOLOCK)
		                              ON Z.PRDT_NO = X.PRDT_NO
		                           WHERE A.PRDT_NO = Z.PRDT_NO
		                     ) AS DISPLAY_OPTION_INFO
		                   , A.DISP_YN
		                   , A.STOCK_INTGR_YN
		                   , CASE A.STOCK_INTGR_YN WHEN 'N' THEN STOCK_UN_INTGR_RSN_CODE.CODE_DTL_NAME ELSE '-' END AS STOCK_UN_INTGR_RSN_CODE
		                   , B.NORMAL_AMT
		                   , (
		                           SELECT TOP 1
		                                  CONCAT(X.DISCOUNT_AMT, '^', X.DISCOUNT_RATE, '^', X.ONLN_DISCOUNT_AMT, '^', X.ONLN_DISCOUNT_RATE)
		                             FROM DBO.VIEW_PROMOTION_PRICE X WITH(NOLOCK)
		                             JOIN PR_PROMOTION_TARGET_DEVICE Y WITH(NOLOCK)
		                               ON X.PROMO_NO = Y.PROMO_NO
		                             JOIN PR_PROMOTION_TARGET_CHANNEL Z WITH(NOLOCK)
		                               ON X.PROMO_NO = Z.PROMO_NO
		                            WHERE X.PROMO_TYPE_CODE IN ('10002', '10004')
		                              AND Y.DEVICE_CODE = '10000'
		                              AND Z.CHNNL_NO = A.CHNNL_NO
		                              AND X.PRDT_NO = A.PRDT_NO
		                            ORDER BY X.DISCOUNT_AMT DESC
		                       ) AS DISPLAY_PRODUCT_INFO /* -- 비회원 가격 정보 */
		                   , GENDER_GBN_CODE.CODE_DTL_NAME AS GENDER_GBN_CODE
		                   , Y.NAME AS STD_CTGR_NAME
		                   , Z.CTGR_NAME_PATH AS STDR_CTGR_NAME
		                   , B.SELL_AMT AS ERP_SELL_AMT
		                   , FLOOR((B.NORMAL_AMT - B.SELL_AMT) / (B.NORMAL_AMT * 1.0) * 100.0) AS ERP_DSCNT_RATE
		                   , B.EMP_DSCNT_RATE
		                   , CASE B.EMP_DSCNT_RATE WHEN 0 THEN B.SELL_AMT ELSE CEILING((B.NORMAL_AMT - (B.NORMAL_AMT * (B.EMP_DSCNT_RATE * 0.01))) / 100.0) * 100 END AS EMP_SELL_AMT
		                   , VENDOR.VNDR_NAME
		                   , A.RSV_PRDT_YN
		                   , A.SELL_START_DTM
		                   , A.SELL_END_DTM
		                   , A.APRVER_DTM
		                   , A.LAST_WRHS_DAY
		                   , ISNULL(PRODUCT_IMAGE.IMAGE_NAME, '') AS TITLE_IMAGE_NAME
		                   , ISNULL(PRODUCT_IMAGE.IMAGE_PATH_TEXT, '') AS TITLE_IMAGE_PATH_TEXT
		                   , ISNULL(PRODUCT_IMAGE.IMAGE_URL, '') AS TITLE_IMAGE_URL
		                   , ISNULL(PRODUCT_IMAGE.ALTRN_TEXT, '') AS TITLE_IMAGE_ALTRN_TEXT
		                   , ISNULL(VVEC.CMSN_RATE, VVDC.DFLT_CMSN_RATE) AS CMSN_RATE
		                FROM PD_PRODUCT A WITH(NOLOCK)
		                JOIN PD_PRODUCT_PRICE_HISTORY B WITH(NOLOCK)
		                  ON A.PRDT_NO = B.PRDT_NO
		                JOIN DP_BRAND C WITH(NOLOCK)
		                  ON A.BRAND_NO = C.BRAND_NO
		                JOIN SY_SITE_CHNNL X WITH(NOLOCK)
		                  ON A.SITE_NO = X.SITE_NO
		                 AND A.CHNNL_NO = X.CHNNL_NO
		           LEFT JOIN VIEW_STANDARD_CATEGORY Y WITH(NOLOCK)
		                  ON A.STD_CTGR_NO = Y.STD_CTGR_NO
		           LEFT JOIN VIEW_CATEGORY Z WITH(NOLOCK)
		                  ON A.STDR_CTGR_NO = Z.CTGR_NO

		           LEFT JOIN SY_CODE_DETAIL SELL_STAT_CODE WITH(NOLOCK)
		                  ON SELL_STAT_CODE.CODE_FIELD = 'SELL_STAT_CODE'
		                 AND SELL_STAT_CODE.CODE_DTL_NO = A.SELL_STAT_CODE

		           LEFT JOIN SY_CODE_DETAIL STOCK_UN_INTGR_RSN_CODE WITH(NOLOCK)
		                  ON STOCK_UN_INTGR_RSN_CODE.CODE_FIELD = 'STOCK_UN_INTGR_RSN_CODE'
		                 AND STOCK_UN_INTGR_RSN_CODE.CODE_DTL_NO = A.STOCK_UN_INTGR_RSN_CODE

		           LEFT JOIN SY_CODE_DETAIL GENDER_GBN_CODE WITH(NOLOCK)
		                  ON GENDER_GBN_CODE.CODE_FIELD = 'GENDER_GBN_CODE'
		                 AND GENDER_GBN_CODE.CODE_DTL_NO = A.GENDER_GBN_CODE

		           LEFT JOIN VD_VENDOR VENDOR WITH(NOLOCK)
		                  ON A.VNDR_NO = VENDOR.VNDR_NO
		                  
		           LEFT JOIN VD_VENDOR_DEFAULT_COMMISSION  VVDC WITH(NOLOCK)
                     ON A.VNDR_NO = VVDC.VNDR_NO
                    AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVDC.APPLY_START_YMD AND VVDC.APPLY_END_YMD
               	  LEFT JOIN VD_VENDOR_EXCEPTION_COMMISSION VVEC WITH(NOLOCK)
                     ON A.VNDR_NO = VVEC.VNDR_NO
                    AND A.STD_CTGR_NO = VVEC.STD_CTGR_NO
                    AND A.BRAND_NO = VVEC.BRAND_NO
                    AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVEC.APPLY_START_YMD AND VVEC.APPLY_END_YMD
		            AND VVEC.DEL_YN = 'N'
		           LEFT JOIN PD_PRODUCT_RELATION_FILE PRODUCT_IMAGE WITH(NOLOCK)
		                  ON A.PRDT_NO = PRODUCT_IMAGE.PRDT_NO
		                 AND PRODUCT_IMAGE.PRDT_RLTN_FILE_SEQ = 1
		                 AND PRODUCT_IMAGE.DISP_POSTN_TYPE = 'P'
		                 AND PRODUCT_IMAGE.FILE_TYPE = 'I'

		               WHERE GETDATE() BETWEEN B.APPLY_START_DTM AND B.APPLY_END_DTM
		                 AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
		                 AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION_STOCK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
		                 AND A.APRV_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@APRV_STAT_CODE_CONFIRM}'<!-- 승인상태 중 승인완료 -->
		                 AND A.PRDT_TYPE_CODE IN ('10000', '10001', '10002') <!-- 상품 유형 코드 ('공통', '온라인', '오프라인') -->
	/*
		2020.03.25 NOT IN 처리 안함
	<if test="bean.excludePrdtTypeCodeList != null">
		                 AND A.PRDT_TYPE_CODE NOT IN <!--  상품유형 중 조회하지 않아야 할 대상. (ex. 사은품,배송비) -->
		<foreach item="item" index="index" collection="bean.excludePrdtTypeCodeList" open="(" separator="," close=")">
		                 {item}
		</foreach>
	</if>
	*/
	<if test="bean.vndrNo != null and bean.vndrNo != ''">
		                 AND A.VNDR_NO = #{bean.vndrNo, jdbcType=VARCHAR}<!-- 업체번호 -->
	</if>
	<if test="bean.prdtTypeCode != null and bean.prdtTypeCode != ''">
		                 AND A.PRDT_TYPE_CODE = #{bean.prdtTypeCode, jdbcType=VARCHAR}<!-- 상품유형 -->
	</if>
	<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn != ''">
		                 AND A.MMNY_PRDT_YN = #{bean.mmnyPrdtYn, jdbcType=VARCHAR}<!-- 자사상품여부 -->
	</if>
	<if test="bean.siteNo != null and bean.siteNo != ''">
		                 AND A.SITE_NO = #{bean.siteNo, jdbcType=VARCHAR}<!-- 사이트번호 -->
	</if>
	<if test="bean.chnnlNo != null and bean.chnnlNo != ''">
		                 AND A.CHNNL_NO = #{bean.chnnlNo, jdbcType=VARCHAR}<!-- 채널번호 -->
	</if>
	<if test="bean.aconnectDispYn != null and bean.aconnectDispYn != ''">
		                 AND A.ACONNECT_DISP_YN = #{bean.aconnectDispYn, jdbcType=VARCHAR}<!-- A-Connect 전시여부 -->
	</if>
	<if test="bean.prdtName != null and bean.prdtName != '' and bean.engPrdtName != null and bean.engPrdtName != ''">
		                 AND A.PRDT_NO IN (
		                 	                 SELECT Z.PRDT_NO FROM PD_PRODUCT Z WITH(NOLOCK) WHERE Z.PRDT_NAME LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
		                 	                 UNION ALL
		                 	                 SELECT Z.PRDT_NO FROM PD_PRODUCT Z WITH(NOLOCK) WHERE Z.ENG_PRDT_NAME LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
		                                  )<!-- 상품명 검색 -->
	</if>
	<if test="bean.styleInfo != null and bean.styleInfo != ''">
		                 AND A.STYLE_INFO LIKE CONCAT('%', #{bean.styleInfo, jdbcType=VARCHAR}, '%')<!-- 스타일검색 -->
	</if>
	<if test="bean.prdtColorInfo != null and bean.prdtColorInfo != ''">
		                 AND A.PRDT_COLOR_INFO LIKE CONCAT('%', #{bean.prdtColorInfo, jdbcType=VARCHAR}, '%')<!-- 색상정보 검색 -->
	</if>
	<if test="bean.srchKeyWordText != null and bean.srchKeyWordText != ''">
		                 AND A.SRCH_KEY_WORD_TEXT LIKE CONCAT('%', #{bean.srchKeyWordText, jdbcType=VARCHAR}, '%')<!-- 상품검색어 검색 -->
	</if>
	<if test="bean.aprverId != null and bean.aprverId != ''">
		                 AND A.APRVER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.aprverId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
	</if>
	<if test="bean.aprverName != null and bean.aprverName != ''">
		                 AND A.APRVER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.aprverName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
	</if>
	<if test="bean.rgsterId != null and bean.rgsterId != ''">
		                 AND A.RGSTER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.rgsterId, jdbcType=VARCHAR} )<!-- 등록자ID 검색 -->
	</if>
	<if test="bean.rgsterName != null and bean.rgsterName != ''">
		                 AND A.RGSTER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.rgsterName, jdbcType=VARCHAR} )<!-- 등록자이름 검색 -->
	</if>
	<if test="bean.moderId != null and bean.moderId != ''">
		                 AND A.MODER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.moderId, jdbcType=VARCHAR} )<!-- 수정자ID 검색 -->
	</if>
	<if test="bean.moderName != null and bean.moderName != ''">
		                 AND A.MODER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.moderName, jdbcType=VARCHAR} )<!-- 수정자이름 검색 -->
	</if>

	<if test="bean.prdtCodeType != null and bean.prdtCodeType != '' and bean.prdtCodeList != null">
		<choose><!-- 상품코드 검색 -->
			<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ONLINE">
		                 AND A.PRDT_NO IN
				<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
		                 	                 #{item}<!-- 온라인상품코드 검색 -->
				</foreach>
			</when>
			<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ERP">
		                 AND A.VNDR_PRDT_NO_TEXT IN
				<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
		                 	                 #{item}<!-- 기간계상품코드 검색 -->
				</foreach>
			</when>
		</choose>
	</if>
	<if test="bean.brandNo != null and bean.brandNo != ''">
		                 AND A.BRAND_NO = #{bean.brandNo, jdbcType=VARCHAR}<!-- 브랜드번호 검색 -->
	</if>
	<if test="bean.brandName != null and bean.brandName != ''">
		                 AND A.BRAND_NO IN (<!-- 브랜드이름 검색 -->
		                 	                 SELECT Z.BRAND_NO FROM DP_BRAND Z WITH(NOLOCK) WHERE Z.BRAND_NAME LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
		                 	                 UNION ALL
		                 	                 SELECT Z.BRAND_NO FROM DP_BRAND Z WITH(NOLOCK) WHERE Z.BRAND_EN_NAME LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
		                 )
	</if>
	<if test="bean.sellStatCodes != null">
		                 AND A.SELL_STAT_CODE IN<!-- 판매상태 중 상품판매코드 -->
		<foreach item="item" index="index" collection="bean.sellStatCodes" open="(" separator="," close=")">
		                 	                 #{item}
		</foreach>
	</if>
	<if test="bean.dispYn != null and bean.dispYn != ''">
		                 AND A.DISP_YN = #{bean.dispYn, jdbcType=CHAR}<!-- 전시여부 검색 -->
	</if>
	<choose>
		<when test="bean.stdCtgrNo3 != null and bean.stdCtgrNo3 != ''">
		                 AND A.STD_CTGR_NO = #{bean.stdCtgrNo3, jdbcType=VARCHAR}<!-- 표준카테고리 중 소카테고리선택시 -->
		</when>
		<when test="bean.stdCtgrNo2 != null and bean.stdCtgrNo2 != ''">
		                 AND A.STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WITH(NOLOCK) WHERE UP_STD_CTGR_NO = #{bean.stdCtgrNo2, jdbcType=VARCHAR} )<!-- 표준카테고리 중 중카테고리선택시 -->
		</when>
		<when test="bean.stdCtgrNo1 != null and bean.stdCtgrNo1 != ''">
		                 AND A.STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WITH(NOLOCK) WHERE UP_STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WHERE UP_STD_CTGR_NO= #{bean.stdCtgrNo1, jdbcType=VARCHAR} ) )<!-- 표준카테고리 중 대카테고리선택시 --><!-- 표준카테고리 중 대카테고리선택시 -->
		</when>
	</choose>
	<if test='bean.ctgrNo != null and bean.ctgrNo != ""'>
		                 AND A.stdr_ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}<!-- 전시카테고리(기준카테고리) 검색 -->
	</if>
	<if test="bean.periodStartDate != null and bean.periodEndDate != null"><!-- 기간조회 (상품등록일, 상품승인완료일, 상품최종수정일, 판매시작일, 판매종료일, 예상출고일) -->
		<choose>
			<when test="bean.periodType == 'aprver-dtm'.toString()"><!-- 최종승인일 -->
		                 AND A.APRVER_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'sell-start-dtm'.toString()"><!-- 판매시작일 -->
		                 AND A.SELL_START_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'sell-end-dtm'.toString()"><!-- 판매종료일 -->
		                 AND A.SELL_END_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'rsv-dlvy-ymd'.toString()"><!-- 예상출고일 -->
		                 AND A.RSV_DLVY_YMD BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'mod_dtm'.toString()"><!-- 수정일 -->
		                 AND A.MOD_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'rgst_dtm'.toString()"><!-- 등록일 -->
		                 AND A.RGST_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
		</choose>
	</if>
	<if test="bean.useAdvancedSearch != null and bean.useAdvancedSearch == 'Y'.toString()"><!-- 추가검색 -->
		<if test="bean.genderGbnCode != null and bean.genderGbnCode != ''">
		                 AND A.GENDER_GBN_CODE = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마 -->
		</if>
		<if test="bean.rsvPrdtYn != null and bean.rsvPrdtYn != ''">
		                 AND A.RSV_PRDT_YN = #{bean.rsvPrdtYn, jdbcType=CHAR}<!-- 예약상품여부 -->
		</if>
		<if test="bean.freeDlvyYn != null and bean.freeDlvyYn != ''">
		                 AND A.FREE_DLVY_YN = #{bean.freeDlvyYn, jdbcType=CHAR}<!-- 무료배송상품여부 -->
		</if>
		<if test="bean.empDscntYn != null and bean.empDscntYn != ''">
		                 AND A.EMP_DSCNT_YN = #{bean.empDscntYn, jdbcType=CHAR}<!-- 임직원 할인제외여부 -->
		</if>
		<if test="bean.dprcExecptYn != null and bean.dprcExecptYn != ''">
		                 AND A.DPRC_EXECPT_YN = #{bean.dprcExecptYn, jdbcType=CHAR}<!-- 감가제외여부 -->
		</if>
		<if test="bean.stockIntgrYn != null and bean.stockIntgrYn != ''">
		                 AND A.STOCK_INTGR_YN = #{bean.stockIntgrYn, jdbcType=CHAR}<!-- 통합재고연동여부 -->
		</if>
		<if test="bean.dispFlag != null">
		                 AND DISP_FLAG_TEXT IN<!-- 매장등급 -->
			<foreach collection="bean.dispFlag" item="item" open="(" separator="," close=")">
		                 	                 #{item, jdbcType=VARCHAR}
			</foreach>
		</if>
		<if test="bean.storePickupPsbltYn != null and bean.storePickupPsbltYn != ''">
		                 AND A.STORE_PICKUP_PSBLT_YN = #{bean.storePickupPsbltYn, jdbcType=CHAR}<!-- 매장픽업 가능여부 -->
		</if>
		<if test="bean.affltsSendYn != null and bean.affltsSendYn != ''">
		                 AND A.AFFLTS_SEND_YN = #{bean.affltsSendYn, jdbcType=CHAR}<!-- 제휴사 전송대상 -->
		</if>
		<if test="bean.sabangnetSendYn != null and bean.sabangnetSendYn != ''">
		                 AND A.SABANGNET_SEND_YN = #{bean.sabangnetSendYn, jdbcType=CHAR}<!-- 사방넷 전송 여부 -->
		</if>
		<if test="bean.sellPriceStartWith != null and bean.sellPriceStartWith >= 0 and bean.sellPriceEndWith != null and bean.sellPriceEndWith >= 0">
		                 AND B.SELL_AMT BETWEEN #{bean.sellPriceStartWith, jdbcType=INTEGER} AND #{bean.sellPriceEndWith, jdbcType=INTEGER}<!-- 판매가 시작~종료 -->
		</if>
		<if test="bean.restockWithinDays != null and bean.restockMoreThanCount != null and bean.restockWithinDays != 0 and bean.restockMoreThanCount != 0"><!-- 재입고 상품조회를 위한 select절 -->
		                 AND A.LAST_WRHS_DAY BETWEEN CONVERT(DATE, DATEADD(DAY, -#{bean.restockWithinDays, jdbcType=INTEGER}, GETDATE())) AND CONVERT(DATE, GETDATE())
		                 AND A.PRDT_NO IN (
		                 	                 SELECT Z.PRDT_NO
		                 	                   FROM PD_PRODUCT_OPTION Z WITH(NOLOCK)
		                 	                  WHERE Z.PRDT_NO = A.PRDT_NO
		                 	                    AND Z.SELL_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@SELL_STAT_CODE_SALE}'<!-- 판매상태 중 판매중 -->
		                 	                    AND Z.USE_YN = 'Y'
		                 	                  GROUP BY Z.PRDT_NO
		                 	                 HAVING SUM(Z.ORDER_PSBLT_QTY) &gt; #{bean.restockMoreThanCount, jdbcType=INTEGER}
		                 	)
		</if>
	</if>

	<if test='bean.tierFlagCode != null'>
		                 AND ISNULL(disp_flag_text, '-') IN<!-- 매장등급 -->
		<foreach collection="bean.tierFlagCode" item="tierFlagCode" open="(" separator="," close=")">
		                 	                 #{tierFlagCode, jdbcType=VARCHAR}
		</foreach>
	</if>

		               ORDER BY
	<choose>
		<when test='sortColumn != null and sortColumn != ""'>
			<if test='sortColumn == "mmnyPrdtYn"'>
		                        A.MMNY_PRDT_YN
			</if>
			<if test='sortColumn == "vndrPrdtNoText"'>
		                        A.VNDR_PRDT_NO_TEXT
			</if>
			<if test='sortColumn == "prdtNo"'>
		                        A.PRDT_NO
			</if>
			<if test='sortColumn == "prdtName"'>
		                        A.PRDT_NAME
			</if>
			<if test='sortType == "DESC"'>
									 		DESC
			</if>
		</when>
		<otherwise>
		                        A.MOD_DTM  DESC
		</otherwise>
	</choose>
		               <include refid="Paging.mssql" />

		       ) PRODUCT
	</select>


    <select id="selectExcelDownloadProductList" parameterType="pageable" resultType="kr.co.abcmart.bo.product.model.master.PdProduct">
	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.selectExcelDownloadProductList [상품 리스트 ExcelDownload] [김진성] */
		SELECT PRODUCT.MMNY_PRDT_YN
		     , PRODUCT.VNDR_PRDT_NO_TEXT
		     , PRODUCT.CHNNL_NAME
		     , PRODUCT.PRDT_NO
		     , PRODUCT.PRDT_NAME
		     , PRODUCT.BRAND_NAME
		     , PRODUCT.ENG_PRDT_NAME
		     , PRODUCT.BRAND_EN_NAME
		     , PRODUCT.STYLE_INFO
		     , PRODUCT.PRDT_COLOR_INFO
		     , PRODUCT.SELL_STAT_CODE
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 4, '^') AS STOCK_AI_QTY
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 5, '^') AS STOCK_AW_QTY
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 6, '^') AS STOCK_AS_QTY
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 7, '^') AS STOCK_VD_QTY
		     , DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 3, '^') AS AVAIABLE_STOCK_QTY
		     , CASE WHEN CONVERT(FLOAT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 1, '^')) > 0 THEN CONVERT(FLOAT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 2, '^')) / CONVERT(FLOAT, DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_OPTION_INFO, 1, '^')) * 100 ELSE 0 END AS AVAILABILITY_RATE
		     , PRODUCT.DISP_YN
		     , PRODUCT.STOCK_INTGR_YN
		     , PRODUCT.STOCK_UN_INTGR_RSN_CODE
		     , PRODUCT.NORMAL_AMT
		     , ISNULL(DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 1, '^'), PRODUCT.ERP_SELL_AMT) AS DISPLAY_PRODUCT_PRICE
		     , FLOOR((PRODUCT.NORMAL_AMT - ISNULL(DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 1, '^'), PRODUCT.ERP_SELL_AMT)) / (PRODUCT.NORMAL_AMT * 1.0) * 100.0) AS DISPLAY_DISCOUNT_RATE
		     , PRODUCT.GENDER_GBN_CODE
		     , PRODUCT.STD_CTGR_NAME
		     , PRODUCT.STDR_CTGR_NAME
		     , PRODUCT.ERP_SELL_AMT
		     , PRODUCT.ERP_DSCNT_RATE
		     , ISNULL(DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 3, '^'), PRODUCT.NORMAL_AMT) AS ONLN_SELL_AMT
		     , CASE WHEN DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 3, '^') IS NOT NULL THEN FLOOR((PRODUCT.NORMAL_AMT - DBO.FN_GET_IDXDATA_LIKE_SPLIT(PRODUCT.DISPLAY_PRODUCT_INFO, 3, '^')) / (PRODUCT.NORMAL_AMT * 1.0) * 100.0) ELSE 0 END AS ONLN_DSCNT_RATE
		     , PRODUCT.EMP_SELL_AMT
		     , PRODUCT.EMP_DSCNT_RATE
		     , PRODUCT.VNDR_NAME
		     , PRODUCT.RSV_PRDT_YN
		     , PRODUCT.SELL_START_DTM
		     , PRODUCT.SELL_END_DTM
		     , PRODUCT.APRVER_DTM
		     , PRODUCT.LAST_WRHS_DAY
		     , CASE WHEN PRODUCT.PRDT_YN = 'Y' THEN 0 ELSE PRODUCT.CMSN_RATE END VNDR_CMSN_RATE
		  FROM (
		              SELECT CASE A.MMNY_PRDT_YN WHEN 'Y' THEN '자사' ELSE '입점' END AS MMNY_PRDT_YN
		                   , A.MMNY_PRDT_YN AS PRDT_YN
		                   , A.VNDR_PRDT_NO_TEXT
		                   , X.CHNNL_NAME
		                   , A.PRDT_NO
		                   , A.PRDT_NAME
		                   , A.ENG_PRDT_NAME
		                   , C.BRAND_NAME
		                   , C.BRAND_EN_NAME
		                   , A.STYLE_INFO
		                   , A.PRDT_COLOR_INFO
		                   , SELL_STAT_CODE.CODE_DTL_NAME AS SELL_STAT_CODE
		                   , (
		                          SELECT CONCAT(
		                                       SUM(CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') THEN 1 ELSE 0 END ) / COUNT(DISTINCT Y.STOCK_GBN_CODE), '^', /*<!-- FO에 노출된 옵션 수 -->*/
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' THEN /* 자사 상품 */
		                                                     CASE WHEN Z.STOCK_INTGR_YN = 'Y' THEN /* 재고 통합 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE IN ('10000', '10001', '10002') AND (Y.STOCK_QTY - Y.ORDER_COUNT) > 0 THEN 1 ELSE 0 END
		                                                                                      ELSE /* 재고 미 통합 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE = '10000' AND (Y.STOCK_QTY - Y.ORDER_COUNT) > 0 THEN 1 ELSE 0 END
		                                                     END
		                                                WHEN Z.MMNY_PRDT_YN = 'N' THEN /* 입점 상품 */
		                                                     CASE WHEN Z.STOCK_MGMT_YN = 'Y' THEN /* 재고 관리 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE = '10003' AND (Y.STOCK_QTY - Y.ORDER_COUNT) > 0  THEN 1 ELSE 0 END
		                                                                                     ELSE /* 재고 미 관리 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') THEN 1 ELSE 0 END
		                                                     END
		                                           END) / COUNT(DISTINCT Y.STOCK_GBN_CODE), '^',  /* <!-- 판매 가능 옵션 수 --> */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' THEN /* 자사 상품 */
		                                                     CASE WHEN Z.STOCK_INTGR_YN = 'Y' THEN /* 재고 통합 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE IN ('10000', '10001', '10002') THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END
		                                                                                      ELSE /* 재고 미 통합 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE = '10000' THEN (Y.STOCK_QTY - Y.ORDER_COUNT)  ELSE 0 END
		                                                     END
		                                                WHEN Z.MMNY_PRDT_YN = 'N' THEN /* 입점 상품 */
		                                                     CASE WHEN Z.STOCK_MGMT_YN = 'Y' THEN /* 재고 관리 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') AND Y.STOCK_GBN_CODE = '10003' THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END
		                                                                                     ELSE /* 재고 미 관리 */
		                                                               CASE WHEN X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') THEN 999 ELSE 0 END
		                                                     END
		                                           END), '^',  /* <!-- 판매 가능 재고 수 --> */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> AND Y.STOCK_GBN_CODE = '10000' THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END), '^', /* AI 재고 */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> AND Y.STOCK_GBN_CODE = '10001' THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END), '^', /* AW 재고 */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'Y' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> AND Y.STOCK_GBN_CODE = '10002' THEN (Y.STOCK_QTY - Y.ORDER_COUNT) ELSE 0 END), '^', /* AS 재고 */
		                                       SUM(CASE WHEN Z.MMNY_PRDT_YN = 'N' AND Z.STOCK_MGMT_YN = 'Y' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> AND Y.STOCK_GBN_CODE = '10003' THEN (Y.STOCK_QTY - Y.ORDER_COUNT)
		                                                WHEN Z.MMNY_PRDT_YN = 'N' AND Z.STOCK_MGMT_YN = 'N' <!-- AND X.USE_YN = 'Y' AND X.SELL_STAT_CODE IN ('10000', '10001', '10002') --> THEN 999
		                                                ELSE 0
		                                           END) /* 입점사 재고 */
		                                 ) AS OPTION_DISPLAY_CNT
		                            FROM PD_PRODUCT_OPTION X
		                            JOIN PD_PRODUCT_OPTION_STOCK Y
		                              ON X.PRDT_NO = Y.PRDT_NO
		                             AND X.PRDT_OPTN_NO = Y.PRDT_OPTN_NO
		                            JOIN PD_PRODUCT Z WITH(NOLOCK)
		                              ON Z.PRDT_NO = X.PRDT_NO
		                           WHERE A.PRDT_NO = Z.PRDT_NO
		                     ) AS DISPLAY_OPTION_INFO
		                    , CASE A.DISP_YN WHEN 'Y' THEN '전시' ELSE '전시안함' END AS DISP_YN
		                    , CASE A.STOCK_INTGR_YN WHEN 'Y' THEN '연동' ELSE '미연동' END AS STOCK_INTGR_YN
		                    , CASE A.STOCK_INTGR_YN WHEN 'N' THEN STOCK_UN_INTGR_RSN_CODE.CODE_DTL_NAME ELSE '-' END AS STOCK_UN_INTGR_RSN_CODE
		                    , B.NORMAL_AMT
		                     , (
		                           SELECT TOP 1
		                                  CONCAT(X.DISCOUNT_AMT, '^', X.DISCOUNT_RATE, '^', X.ONLN_DISCOUNT_AMT, '^', X.ONLN_DISCOUNT_RATE)
		                             FROM DBO.VIEW_PROMOTION_PRICE X WITH(NOLOCK)
		                             JOIN PR_PROMOTION_TARGET_DEVICE Y WITH(NOLOCK)
		                               ON X.PROMO_NO = Y.PROMO_NO
		                             JOIN PR_PROMOTION_TARGET_CHANNEL Z WITH(NOLOCK)
		                               ON X.PROMO_NO = Z.PROMO_NO
		                            WHERE X.PROMO_TYPE_CODE IN ('10002', '10004')
		                              AND Y.DEVICE_CODE = '10000'
		                              AND Z.CHNNL_NO = A.CHNNL_NO
		                              AND X.PRDT_NO = A.PRDT_NO
		                            ORDER BY X.DISCOUNT_AMT DESC
		                       ) AS DISPLAY_PRODUCT_INFO -- 비회원 가격 정보
		                    , CASE WHEN GENDER_GBN_CODE.CODE_DTL_NAME = 'KIDS'
                                   THEN '아동'
                                   ELSE GENDER_GBN_CODE.CODE_DTL_NAME
                              END AS GENDER_GBN_CODE
		                    , Y.NAME AS STD_CTGR_NAME
		                    , Z.CTGR_NAME_PATH AS STDR_CTGR_NAME
		                    , B.SELL_AMT AS ERP_SELL_AMT
		                    , FLOOR((B.NORMAL_AMT - B.SELL_AMT) / (B.NORMAL_AMT * 1.0) * 100.0) AS ERP_DSCNT_RATE
		                    , B.EMP_DSCNT_RATE
		                    , CASE B.EMP_DSCNT_RATE WHEN 0 THEN B.SELL_AMT ELSE CEILING((B.NORMAL_AMT - (B.NORMAL_AMT * (B.EMP_DSCNT_RATE * 0.01))) / 100.0) * 100 END AS EMP_SELL_AMT
		                    , VENDOR.VNDR_NAME
		                    , CASE A.RSV_PRDT_YN WHEN 'Y' THEN '예약' ELSE '일반' END RSV_PRDT_YN
		                    , A.SELL_START_DTM
		                    , A.SELL_END_DTM
		                    , A.APRVER_DTM
		                    , A.LAST_WRHS_DAY
		                    , ISNULL(VVEC.CMSN_RATE, VVDC.DFLT_CMSN_RATE) AS CMSN_RATE
		                    , ROW_NUMBER() OVER(ORDER BY A.MOD_DTM  DESC) AS RNUM
		                FROM PD_PRODUCT A WITH(NOLOCK)
		                JOIN PD_PRODUCT_PRICE_HISTORY B WITH(NOLOCK)
		                  ON A.PRDT_NO = B.PRDT_NO
		                JOIN DP_BRAND C WITH(NOLOCK)
		                  ON A.BRAND_NO = C.BRAND_NO
		                JOIN SY_SITE_CHNNL X WITH(NOLOCK)
		                  ON A.SITE_NO = X.SITE_NO
		                 AND A.CHNNL_NO = X.CHNNL_NO
		           LEFT JOIN VIEW_STANDARD_CATEGORY Y WITH(NOLOCK)
		                  ON A.STD_CTGR_NO = Y.STD_CTGR_NO
		           LEFT JOIN VIEW_CATEGORY Z WITH(NOLOCK)
		                  ON A.STDR_CTGR_NO = Z.CTGR_NO

		           LEFT JOIN SY_CODE_DETAIL SELL_STAT_CODE WITH(NOLOCK)
		                  ON SELL_STAT_CODE.CODE_FIELD = 'SELL_STAT_CODE'
		                 AND SELL_STAT_CODE.CODE_DTL_NO = A.SELL_STAT_CODE

		           LEFT JOIN SY_CODE_DETAIL STOCK_UN_INTGR_RSN_CODE WITH(NOLOCK)
		                  ON STOCK_UN_INTGR_RSN_CODE.CODE_FIELD = 'STOCK_UN_INTGR_RSN_CODE'
		                 AND STOCK_UN_INTGR_RSN_CODE.CODE_DTL_NO = A.STOCK_UN_INTGR_RSN_CODE

		           LEFT JOIN SY_CODE_DETAIL GENDER_GBN_CODE WITH(NOLOCK)
		                  ON GENDER_GBN_CODE.CODE_FIELD = 'GENDER_GBN_CODE'
		                 AND GENDER_GBN_CODE.CODE_DTL_NO = A.GENDER_GBN_CODE

		           LEFT JOIN VD_VENDOR VENDOR WITH(NOLOCK)
		                  ON A.VNDR_NO = VENDOR.VNDR_NO
				   LEFT JOIN VD_VENDOR_DEFAULT_COMMISSION  VVDC WITH(NOLOCK)
                     ON A.VNDR_NO = VVDC.VNDR_NO
                    AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVDC.APPLY_START_YMD AND VVDC.APPLY_END_YMD
               	   LEFT JOIN VD_VENDOR_EXCEPTION_COMMISSION VVEC WITH(NOLOCK)
                     ON A.VNDR_NO = VVEC.VNDR_NO
                    AND A.STD_CTGR_NO = VVEC.STD_CTGR_NO
                    AND A.BRAND_NO = VVEC.BRAND_NO
                    AND CONVERT(CHAR(8), GETDATE(), 112) BETWEEN VVEC.APPLY_START_YMD AND VVEC.APPLY_END_YMD
			        AND VVEC.DEL_YN = 'N'
				 WHERE GETDATE() BETWEEN B.APPLY_START_DTM AND B.APPLY_END_DTM
				   AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
				   AND EXISTS (SELECT 1 FROM PD_PRODUCT_OPTION_STOCK Z WITH(NOLOCK) WHERE Z.PRDT_NO = A.PRDT_NO)
				   AND A.APRV_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@APRV_STAT_CODE_CONFIRM}'<!-- 승인상태 중 승인완료 -->
				   AND A.PRDT_TYPE_CODE IN ('10000', '10001', '10002') <!-- 상품 유형 코드 ('공통', '온라인', '오프라인') -->
	/*
		2020.03.25 NOT IN 처리 안함
	<if test="bean.excludePrdtTypeCodeList != null">
		                 AND A.PRDT_TYPE_CODE NOT IN <!--  상품유형 중 조회하지 않아야 할 대상. (ex. 사은품,배송비) -->
		<foreach item="item" index="index" collection="bean.excludePrdtTypeCodeList" open="(" separator="," close=")">
		                 {item}
		</foreach>
	</if>
	*/
	<if test="bean.vndrNo != null and bean.vndrNo != ''">
		                 AND A.VNDR_NO = #{bean.vndrNo, jdbcType=VARCHAR}<!-- 업체번호 -->
	</if>
	<if test="bean.prdtTypeCode != null and bean.prdtTypeCode != ''">
		                 AND A.PRDT_TYPE_CODE = #{bean.prdtTypeCode, jdbcType=VARCHAR}<!-- 상품유형 -->
	</if>
	<if test="bean.mmnyPrdtYn != null and bean.mmnyPrdtYn != ''">
		                 AND A.MMNY_PRDT_YN = #{bean.mmnyPrdtYn, jdbcType=VARCHAR}<!-- 자사상품여부 -->
	</if>
	<if test="bean.siteNo != null and bean.siteNo != ''">
		                 AND A.SITE_NO = #{bean.siteNo, jdbcType=VARCHAR}<!-- 사이트번호 -->
	</if>
	<if test="bean.chnnlNo != null and bean.chnnlNo != ''">
		                 AND A.CHNNL_NO = #{bean.chnnlNo, jdbcType=VARCHAR}<!-- 채널번호 -->
	</if>
	<if test="bean.aconnectDispYn != null and bean.aconnectDispYn != ''">
		                 AND A.ACONNECT_DISP_YN = #{bean.aconnectDispYn, jdbcType=VARCHAR}<!-- A-Connect 전시여부 -->
	</if>
	<if test="bean.prdtName != null and bean.prdtName != '' and bean.engPrdtName != null and bean.engPrdtName != ''">
		                 AND A.PRDT_NO IN (
		                 	                 SELECT Z.PRDT_NO FROM PD_PRODUCT Z WITH(NOLOCK) WHERE Z.PRDT_NAME LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
		                 	                 UNION ALL
		                 	                 SELECT Z.PRDT_NO FROM PD_PRODUCT Z WITH(NOLOCK) WHERE Z.ENG_PRDT_NAME LIKE CONCAT('%', #{bean.prdtName, jdbcType=VARCHAR}, '%')
		                                  )<!-- 상품명 검색 -->
	</if>
	<if test="bean.styleInfo != null and bean.styleInfo != ''">
		                 AND A.STYLE_INFO LIKE CONCAT('%', #{bean.styleInfo, jdbcType=VARCHAR}, '%')<!-- 스타일검색 -->
	</if>
	<if test="bean.prdtColorInfo != null and bean.prdtColorInfo != ''">
		                 AND A.PRDT_COLOR_INFO LIKE CONCAT('%', #{bean.prdtColorInfo, jdbcType=VARCHAR}, '%')<!-- 색상정보 검색 -->
	</if>
	<if test="bean.srchKeyWordText != null and bean.srchKeyWordText != ''">
		                 AND A.SRCH_KEY_WORD_TEXT LIKE CONCAT('%', #{bean.srchKeyWordText, jdbcType=VARCHAR}, '%')<!-- 상품검색어 검색 -->
	</if>
	<if test="bean.aprverId != null and bean.aprverId != ''">
		                 AND A.APRVER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.aprverId, jdbcType=VARCHAR} )<!-- 승인자ID 검색 -->
	</if>
	<if test="bean.aprverName != null and bean.aprverName != ''">
		                 AND A.APRVER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.aprverName, jdbcType=VARCHAR} )<!-- 승인자이름 검색 -->
	</if>
	<if test="bean.rgsterId != null and bean.rgsterId != ''">
		                 AND A.RGSTER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.rgsterId, jdbcType=VARCHAR} )<!-- 등록자ID 검색 -->
	</if>
	<if test="bean.rgsterName != null and bean.rgsterName != ''">
		                 AND A.RGSTER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.rgsterName, jdbcType=VARCHAR} )<!-- 등록자이름 검색 -->
	</if>
	<if test="bean.moderId != null and bean.moderId != ''">
		                 AND A.MODER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.LOGIN_ID = #{bean.moderId, jdbcType=VARCHAR} )<!-- 수정자ID 검색 -->
	</if>
	<if test="bean.moderName != null and bean.moderName != ''">
		                 AND A.MODER_NO IN ( SELECT Z.ADMIN_NO FROM SY_ADMIN Z WITH(NOLOCK) WHERE Z.ADMIN_NAME = #{bean.moderName, jdbcType=VARCHAR} )<!-- 수정자이름 검색 -->
	</if>

	<if test="bean.prdtCodeType != null and bean.prdtCodeType != '' and bean.prdtCodeList != null">
		<choose><!-- 상품코드 검색 -->
			<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ONLINE">
		                 AND A.PRDT_NO IN
				<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
		                 	                 #{item}<!-- 온라인상품코드 검색 -->
				</foreach>
			</when>
			<when test="bean.prdtCodeType == @kr.co.abcmart.bo.product.vo.PdProductSearchVO@PRDT_CODE_TYPE_ERP">
		                 AND A.VNDR_PRDT_NO_TEXT IN
				<foreach item="item" index="index" collection="bean.prdtCodeList" open="(" separator="," close=")">
		                 	                 #{item}<!-- 기간계상품코드 검색 -->
				</foreach>
			</when>
		</choose>
	</if>
	<if test="bean.brandNo != null and bean.brandNo != ''">
		                 AND A.BRAND_NO = #{bean.brandNo, jdbcType=VARCHAR}<!-- 브랜드번호 검색 -->
	</if>
	<if test="bean.brandName != null and bean.brandName != ''">
		                 AND A.BRAND_NO IN (<!-- 브랜드이름 검색 -->
		                 	                 SELECT Z.BRAND_NO FROM DP_BRAND Z WITH(NOLOCK) WHERE Z.BRAND_NAME LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
		                 	                 UNION ALL
		                 	                 SELECT Z.BRAND_NO FROM DP_BRAND Z WITH(NOLOCK) WHERE Z.BRAND_EN_NAME LIKE CONCAT('%', #{bean.brandName, jdbcType=VARCHAR}, '%')
		                 )
	</if>
	<if test="bean.sellStatCodes != null">
		                 AND A.SELL_STAT_CODE IN<!-- 판매상태 중 상품판매코드 -->
		<foreach item="item" index="index" collection="bean.sellStatCodes" open="(" separator="," close=")">
		                 	                 #{item}
		</foreach>
	</if>
	<if test="bean.dispYn != null and bean.dispYn != ''">
		                 AND A.DISP_YN = #{bean.dispYn, jdbcType=CHAR}<!-- 전시여부 검색 -->
	</if>
	<choose>
		<when test="bean.stdCtgrNo3 != null and bean.stdCtgrNo3 != ''">
		                 AND A.STD_CTGR_NO = #{bean.stdCtgrNo3, jdbcType=VARCHAR}<!-- 표준카테고리 중 소카테고리선택시 -->
		</when>
		<when test="bean.stdCtgrNo2 != null and bean.stdCtgrNo2 != ''">
		                 AND A.STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WITH(NOLOCK) WHERE UP_STD_CTGR_NO = #{bean.stdCtgrNo2, jdbcType=VARCHAR} )<!-- 표준카테고리 중 중카테고리선택시 -->
		</when>
		<when test="bean.stdCtgrNo1 != null and bean.stdCtgrNo1 != ''">
		                 AND A.STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WITH(NOLOCK) WHERE UP_STD_CTGR_NO IN ( SELECT STD_CTGR_NO FROM SY_STANDARD_CATEGORY WHERE UP_STD_CTGR_NO= #{bean.stdCtgrNo1, jdbcType=VARCHAR} ) )<!-- 표준카테고리 중 대카테고리선택시 --><!-- 표준카테고리 중 대카테고리선택시 -->
		</when>
	</choose>
	<if test='bean.ctgrNo != null and bean.ctgrNo != ""'>
		                 AND A.stdr_ctgr_no = #{bean.ctgrNo, jdbcType=VARCHAR}<!-- 전시카테고리(기준카테고리) 검색 -->
	</if>
	<if test="bean.periodStartDate != null and bean.periodEndDate != null"><!-- 기간조회 (상품등록일, 상품승인완료일, 상품최종수정일, 판매시작일, 판매종료일, 예상출고일) -->
		<choose>
			<when test="bean.periodType == 'aprver-dtm'.toString()"><!-- 최종승인일 -->
		                 AND A.APRVER_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'sell-start-dtm'.toString()"><!-- 판매시작일 -->
		                 AND A.SELL_START_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'sell-end-dtm'.toString()"><!-- 판매종료일 -->
		                 AND A.SELL_END_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'rsv-dlvy-ymd'.toString()"><!-- 예상출고일 -->
		                 AND A.RSV_DLVY_YMD BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'mod_dtm'.toString()"><!-- 수정일 -->
		                 AND A.MOD_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
			<when test="bean.periodType == 'rgst_dtm'.toString()"><!-- 등록일 -->
		                 AND A.RGST_DTM BETWEEN CONVERT(DATETIME, #{bean.periodStartDate, jdbcType=VARCHAR}) AND CONVERT(DATETIME, #{bean.periodEndDate, jdbcType=VARCHAR})
			</when>
		</choose>
	</if>
	<if test="bean.useAdvancedSearch != null and bean.useAdvancedSearch == 'Y'.toString()"><!-- 추가검색 -->
		<if test="bean.genderGbnCode != null and bean.genderGbnCode != ''">
		                 AND A.GENDER_GBN_CODE = #{bean.genderGbnCode, jdbcType=CHAR}<!-- 테마 -->
		</if>
		<if test="bean.rsvPrdtYn != null and bean.rsvPrdtYn != ''">
		                 AND A.RSV_PRDT_YN = #{bean.rsvPrdtYn, jdbcType=CHAR}<!-- 예약상품여부 -->
		</if>
		<if test="bean.freeDlvyYn != null and bean.freeDlvyYn != ''">
		                 AND A.FREE_DLVY_YN = #{bean.freeDlvyYn, jdbcType=CHAR}<!-- 무료배송상품여부 -->
		</if>
		<if test="bean.empDscntYn != null and bean.empDscntYn != ''">
		                 AND A.EMP_DSCNT_YN = #{bean.empDscntYn, jdbcType=CHAR}<!-- 임직원 할인제외여부 -->
		</if>
		<if test="bean.dprcExecptYn != null and bean.dprcExecptYn != ''">
		                 AND A.DPRC_EXECPT_YN = #{bean.dprcExecptYn, jdbcType=CHAR}<!-- 감가제외여부 -->
		</if>
		<if test="bean.stockIntgrYn != null and bean.stockIntgrYn != ''">
		                 AND A.STOCK_INTGR_YN = #{bean.stockIntgrYn, jdbcType=CHAR}<!-- 통합재고연동여부 -->
		</if>
		<if test="bean.dispFlag != null">
		                 AND DISP_FLAG_TEXT IN<!-- 매장등급 -->
			<foreach collection="bean.dispFlag" item="item" open="(" separator="," close=")">
		                 	                 #{item, jdbcType=VARCHAR}
			</foreach>
		</if>
		<if test="bean.storePickupPsbltYn != null and bean.storePickupPsbltYn != ''">
		                 AND A.STORE_PICKUP_PSBLT_YN = #{bean.storePickupPsbltYn, jdbcType=CHAR}<!-- 매장픽업 가능여부 -->
		</if>
		<if test="bean.affltsSendYn != null and bean.affltsSendYn != ''">
		                 AND A.AFFLTS_SEND_YN = #{bean.affltsSendYn, jdbcType=CHAR}<!-- 제휴사 전송대상 -->
		</if>
		<if test="bean.sabangnetSendYn != null and bean.sabangnetSendYn != ''">
		                 AND A.SABANGNET_SEND_YN = #{bean.sabangnetSendYn, jdbcType=CHAR}<!-- 사방넷 전송 여부 -->
		</if>
		<if test="bean.sellPriceStartWith != null and bean.sellPriceStartWith >= 0 and bean.sellPriceEndWith != null and bean.sellPriceEndWith >= 0">
		                 AND B.SELL_AMT BETWEEN #{bean.sellPriceStartWith, jdbcType=INTEGER} AND #{bean.sellPriceEndWith, jdbcType=INTEGER}<!-- 판매가 시작~종료 -->
		</if>
		<if test="bean.restockWithinDays != null and bean.restockMoreThanCount != null and bean.restockWithinDays != 0 and bean.restockMoreThanCount != 0"><!-- 재입고 상품조회를 위한 select절 -->
		                 AND A.LAST_WRHS_DAY BETWEEN CONVERT(DATE, DATEADD(DAY, -#{bean.restockWithinDays, jdbcType=INTEGER}, GETDATE())) AND CONVERT(DATE, GETDATE())
		                 AND A.PRDT_NO IN (
		                 	                 SELECT Z.PRDT_NO
		                 	                   FROM PD_PRODUCT_OPTION Z WITH(NOLOCK)
		                 	                  WHERE Z.PRDT_NO = A.PRDT_NO
		                 	                    AND Z.SELL_STAT_CODE = '${@kr.co.abcmart.constant.CommonCode@SELL_STAT_CODE_SALE}'<!-- 판매상태 중 판매중 -->
		                 	                    AND Z.USE_YN = 'Y'
		                 	                  GROUP BY Z.PRDT_NO
		                 	                 HAVING SUM(Z.ORDER_PSBLT_QTY) &gt; #{bean.restockMoreThanCount, jdbcType=INTEGER}
		                 	)
		</if>
	</if>

	<if test='bean.tierFlagCode != null'>
		                 AND ISNULL(disp_flag_text, '-') IN<!-- 매장등급 -->
		<foreach collection="bean.tierFlagCode" item="tierFlagCode" open="(" separator="," close=")">
		                 	                 #{tierFlagCode, jdbcType=VARCHAR}
		</foreach>
	</if>
		       ) PRODUCT
    </select>
	
	<update id="updateCntcPrdtSetup" parameterType="kr.co.abcmart.bo.product.model.master.PdProduct">
	/*+ kr.co.abcmart.bo.product.repository.master.PdProductDao.updateCntcPrdtSetup [연계상품 역으로 등록시 해당상품의 연계 상품 여부 수정] [신인철] */
		UPDATE PD_PRODUCT
		   SET CNTC_PRDT_SETUP_YN = 'Y'
		 WHERE PRDT_NO = #{prdtNo, jdbcType=VARCHAR}
	
	</update>
	
</mapper>